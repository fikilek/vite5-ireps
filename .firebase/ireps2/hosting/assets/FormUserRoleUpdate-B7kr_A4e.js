import{r as n,a9 as N,k as E,J as O,j as e,ac as R,ae as I,af as M,ag as D,ai as P,ar as b,ak as G,l as T,B as U}from"./index-CHax9ClH.js";try{let o=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},r=new o.Error().stack;r&&(o._sentryDebugIds=o._sentryDebugIds||{},o._sentryDebugIds[r]="fdcf7418-c1fc-42a9-86bd-3003991c9e65",o._sentryDebugIdIdentifier="sentry-dbid-fdcf7418-c1fc-42a9-86bd-3003991c9e65")}catch{}const _=[{key:"guest",value:"Guest",roleCode:"GST"},{key:"fieldworker",value:"Fieldworker",roleCode:"FWR"},{key:"supervisor",value:"Supervisor",roleCode:"SPV"},{key:"manager",value:"Manager",roleCode:"MNG"},{key:"superuser",value:"Superuser",roleCode:"SPU"}],B=(o,r)=>{const i=JSON.stringify(o),d=JSON.stringify(r),c=i===d;let l={guest:{old:"",new:"",change:""},fieldworker:{old:"",new:"",change:""},supervisor:{old:"",new:"",change:""},manager:{old:"",new:"",change:""},superuser:{old:"",new:"",change:""}};for(const t in l)l[t].old=r[t],l[t].new=o[t],o[t]===r[t]?l[t].change=!1:l[t].change=!0;return{objectsEqual:c,changeSet:l}},q=o=>{const{formData:r}=o,[i,d]=n.useState(""),{customClaims:c,setCustomClaims:l}=n.useContext(N),t=E(),[v,g]=n.useState(null),[h,m]=n.useState({}),[y,k]=n.useState({}),{closeModal:j}=O();n.useEffect(()=>{var s;m((s=r==null?void 0:r.customClaims)==null?void 0:s.roles)},[]),n.useEffect(()=>{const{changeSet:s}=B(h,c.roles);k(s)},[c.roles,h]);const w=s=>{g(a=>!0),T(t,"updateUserRole")({roles:s,uid:r.uid,changeSet:y}).then(a=>{l(f=>{var p,C,x;return{...f,roles:(x=(C=(p=a==null?void 0:a.data)==null?void 0:p.userRecord)==null?void 0:C.customClaims)==null?void 0:x.roles}}),U(`Roles for user "${r.displayName}", updated succesfully`,{position:"bottom-left",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),j(),g(f=>!a.data.userRecord)}).catch(a=>{console.log("error updating role: ",a.message),d(a.message),g(!1)})},S=s=>{let u={};for(const a in s)if(s[a])return u;return u.roles="User must have at least ONE role",u},F=s=>{m({...h,[s.target.value]:s.target.checked})};return e.jsx("div",{className:"form-wrapper",children:e.jsx("div",{className:"form-container user-role-update ",children:e.jsx(R,{initialValues:r.customClaims.roles,onSubmit:w,validate:S,enableReinitialize:!0,children:s=>e.jsx(e.Fragment,{children:e.jsxs(I,{onChange:F,children:[e.jsx(M,{hl1:"User Role Updater Form",hr1:`${r.displayName}`,children:e.jsx(D,{})}),e.jsxs("div",{className:"user-role-update",children:[e.jsx("div",{className:"uru uru-sub-heading",children:e.jsxs("p",{children:["The user has the existing roles shown below. Click on the checkbox to either add a new role or remove the existig role and submit. Roles rules apply","."]})}),e.jsx("div",{className:"uru check-btns",children:e.jsxs("div",{className:"user-roles",children:[e.jsx(P,{control:"checkbox",label:"",name:"roles",roles:_,claims:r.customClaims.roles}),s.errors.roles&&e.jsx(b,{errorMsg:s.errors.roles}),i&&e.jsx(b,{errorMsg:i})]})})]}),e.jsx(G,{formik:s,signState:{isPending:v}})]})})})})})};export{q as default};
//# sourceMappingURL=FormUserRoleUpdate-B7kr_A4e.js.map
