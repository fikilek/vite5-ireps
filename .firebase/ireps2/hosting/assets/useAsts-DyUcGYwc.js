import{h as H,r as T,A as de,i as ne,u as se,w as ee,q as re,e as ie,o as oe,c as le,d as ce,f as me,k as O,l as te,j as b,m as ae,n as q,I as ue,p as he}from"./index-C7XevmkD.js";import{u as fe}from"./useTrns-CKgIQgUL.js";import{T as ye}from"./useErfs-uMxgUoe6.js";try{let p=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},U=new p.Error().stack;U&&(p._sentryDebugIds=p._sentryDebugIds||{},p._sentryDebugIds[U]="65e0faca-7a5e-47e7-aee5-73e85178bd46",p._sentryDebugIdIdentifier="sentry-dbid-65e0faca-7a5e-47e7-aee5-73e85178bd46")}catch{}const pe=()=>({getAstsUsersStats:t=>{var r;const d={};t==null||t.forEach(a=>{d[a.metadata.createdByUid]=1+(d[a.metadata.createdByUid]||0)});const e=[];for(const a in d){const n=t==null?void 0:t.find(o=>{var m;return((m=o==null?void 0:o.metadata)==null?void 0:m.createdByUid)===a}),u=(d[a]/(t==null?void 0:t.length)*100).toFixed(2);e.push({uid:a,displayName:(r=n==null?void 0:n.metadata)==null?void 0:r.createdByUser,quantity:d[a],percentage:u,fillColor:H()})}return{stats:e,total:t==null?void 0:t.length}},getMeterTypePerUserStats:t=>{var o,m;const d=t.filter(i=>i.astData.meter.type==="pre-paid"),e={};d==null||d.forEach(i=>{e[i.metadata.createdByUid]=1+(e[i.metadata.createdByUid]||0)});const r=[];for(const i in e){const y=d==null?void 0:d.find(s=>{var c;return((c=s==null?void 0:s.metadata)==null?void 0:c.createdByUid)===i}),l=(e[i]/(d==null?void 0:d.length)*100).toFixed(2);r.push({uid:i,displayName:(o=y==null?void 0:y.metadata)==null?void 0:o.createdByUser,quantity:e[i],percentage:l,fillColor:H()})}const a=t.filter(i=>i.astData.meter.type==="conventional"),n={};a==null||a.forEach(i=>{n[i.metadata.createdByUid]=1+(n[i.metadata.createdByUid]||0)});const u=[];for(const i in n){const y=a==null?void 0:a.find(s=>{var c;return((c=s==null?void 0:s.metadata)==null?void 0:c.createdByUid)===i}),l=(n[i]/(a==null?void 0:a.length)*100).toFixed(2);u.push({uid:i,displayName:(m=y==null?void 0:y.metadata)==null?void 0:m.createdByUser,quantity:n[i],percentage:l,fillColor:H()})}return[{meterTypeName:"pre-paid",stats:r,total:d==null?void 0:d.length},{meterTypeName:"conventional",stats:u,total:a.length}]},getAnomalyPerUserStats:t=>{const d={};t==null||t.forEach(a=>{var n,u;d[(n=a==null?void 0:a.anomalies)==null?void 0:n.anomaly]=1+(d[(u=a==null?void 0:a.anomalies)==null?void 0:u.anomaly]||0)});const e=Object.entries(d);let r=[];return e==null||e.forEach(a=>{var y;const n=a[0],u=a[1],o=t==null?void 0:t.filter(l=>{var s;return((s=l==null?void 0:l.anomalies)==null?void 0:s.anomaly)===n}),m={};o==null||o.forEach(l=>{var s,c;m[(s=l==null?void 0:l.anomalies)==null?void 0:s.anomalyDetail]=1+(m[(c=l==null?void 0:l.anomalies)==null?void 0:c.anomalyDetail]||0)});const i=[];for(const l in m){const s=t==null?void 0:t.filter(h=>{var f;return((f=h==null?void 0:h.anomalies)==null?void 0:f.anomalyDetail)===l}),c={};s==null||s.forEach(h=>{c[h.metadata.createdByUid]=1+(c[h.metadata.createdByUid]||0)});const N=[];for(const h in c){const f=s==null?void 0:s.find(D=>{var M;return((M=D==null?void 0:D.metadata)==null?void 0:M.createdByUid)===h}),S=(c[h]/(t==null?void 0:t.length)*100).toFixed(2);N.push({uid:h,displayName:(y=f==null?void 0:f.metadata)==null?void 0:y.createdByUser,quantity:c[h],percentage:S,fillColor:H()})}i.push({anomalyDetailName:l,anomalyDetailStats:s.length,updatedUserStats:N})}r.push({anomalyName:n,anomalyStats:u,anomalyDetailStatsArray:i})}),{stats:r,total:t.length}}}),Se=p=>{const{astsContext:U,setAstsContext:C}=T.useContext(de),{astsStatsContext:t,setAstsStatsContext:d}=T.useContext(ne),[e,r]=T.useState([]),[a,n]=T.useState(""),{getDocument:u}=fe("users"),{user:o}=se(),{getAstsUsersStats:m,getMeterTypePerUserStats:i,getAnomalyPerUserStats:y}=pe(),l=o==null?void 0:o.uid;return T.useEffect(()=>{u(l).then(s=>{const{workbase:c}=s==null?void 0:s.doc,N=ee("erf.address.lmMetro","==",c);if(!N)return;const h=re(le(ce,p),oe(N,ee("astData.astState.state","==","stores")),ie("metadata.updatedAtDatetime","desc"));n(""),me(h,f=>{const S=[];f.docs.forEach(g=>{S.push({id:g.id,...g.data()})}),r(S);const D=m(S),M=i(S),B=y(S);C({...U,asts:S}),d(g=>({...g,statsAstsUsers:D,meterTypePerUserStats:M,anomalyPerUserStats:B}))},f=>{console.log("firestore err",f.message),n(f.message)}),n("")})},[]),{asts:e,error:a}},x=(p,U)=>{const C=p==null?void 0:p.find(d=>(d==null?void 0:d.mediaCategory)===U);return C==null?void 0:C.url},ge=()=>{T.useContext(de);const{error:p}=Se("asts");return{astsTableFields:[{field:"id",headerName:"System Id",width:200,hide:!0},{headerName:"Created",children:[{field:"metadata.createdByUser",headerName:"Created By",width:150,hide:!1},{field:"metadata.createdAtDatetime",columnGroupShow:"open",headerName:"Date Created",width:160,cellRenderer:t=>{var r,a;const d=new O((r=t==null?void 0:t.value)==null?void 0:r.seconds,(a=t==null?void 0:t.value)==null?void 0:a.nanoseconds),e=d==null?void 0:d.toDate();return b.jsx(ae,{date:e,dateFormat:"yyyy-MMM-dd HH:mm"})},valueGetter:t=>{var d,e;return(e=(d=t.data)==null?void 0:d.metadata)==null?void 0:e.createdAtDatetime},hide:!1}]},{headerName:"Last Updated",children:[{field:"metadata.updatedByUser",headerName:"Updated By",width:150,hide:!1},{field:"metadata.updatedAtDatetime",columnGroupShow:"open",headerName:"Date Updated",width:160,cellRenderer:t=>{const e=new O(t.value.seconds,t.value.nanoseconds).toDate();return b.jsx(ae,{date:e,dateFormat:"yyyy-MMM-dd HH:mm"})},valueGetter:t=>t.data.metadata.updatedAtDatetime,hide:!1}]},{field:"erf.erfNo",headerName:"Erf No",width:100,tooltipField:"Erf the ast belong to",hide:!1},{field:"erf.address.ward",headerName:"Ward",width:100},{headerName:"Meter Description",children:[{field:"astData.astNo",headerName:"Meter No",width:170,columnGroupShow:"closed",cellRenderer:t=>b.jsx(q,{data:t,children:t.value}),cellRendererParams:{modalName:"meterReport",width:"8rem",irepsKeyItem:"asts",displayMode:"modal"},hide:!1},{field:"astData.astCatergory",headerName:"Catergory",columnGroupShow:"open",width:150,hide:!0},{field:"astData.astManufacturer",headerName:"Manufacturer (Brand)",columnGroupShow:"open",width:200,hide:!1},{field:"astData.astName",headerName:"Ast Technical Name",columnGroupShow:"open",width:150,hide:!1},{field:"astData.astState",headerName:"State",columnGroupShow:"open",width:150,hide:!1}]},{field:"",headerName:"Meter Media",width:150,cellRenderer:t=>b.jsx(q,{data:t,children:t.value}),cellRendererParams:{modalName:"mediaMobileAsts",width:"4rem",irepsKeyItem:"asts",displayMode:"modal"},valueGetter:t=>{var e,r,a,n;return(r=(e=t==null?void 0:t.data)==null?void 0:e.media)!=null&&r.length?(n=(a=t==null?void 0:t.data)==null?void 0:a.media)==null?void 0:n.length:0}},{field:"trns",headerName:"Trns On Meter",width:130,cellRenderer:ye,cellRendererParams:{columnName:"tidTrn"},hide:!1,valueGetter:t=>t.data,filter:!1},{field:"location.gps",columnGroupShow:"closed",headerName:"Meter on Map",cellRenderer:t=>b.jsx(q,{data:t,children:b.jsx(ue.Provider,{value:{color:"blue",fontSize:"1rem"},children:b.jsx(he,{})})}),cellRendererParams:{modalName:"showAstOnMap",width:"3rem"},valueGetter:t=>{var r,a,n,u,o,m;const d=Number((n=(a=(r=t.data)==null?void 0:r.location)==null?void 0:a.gps)==null?void 0:n.lat),e=Number((m=(o=(u=t.data)==null?void 0:u.location)==null?void 0:o.gps)==null?void 0:m.lng);return`${d.toFixed(3)} / ${e.toFixed(3)}`},width:140,filter:!1},{field:"astData.astState.state",headerName:"Meter State",width:250,valueGetter:t=>{var e,r,a,n,u,o,m,i,y,l,s,c,N,h,f,S,D,M,B,g,G,v,R,E,A,F,I,j,$,P;let d="";return((e=t.data)==null?void 0:e.astData.astState.state)==="stores"&&(d=`${(n=(a=(r=t.data)==null?void 0:r.astData)==null?void 0:a.astState)==null?void 0:n.state} : ${(m=(o=(u=t.data)==null?void 0:u.astData)==null?void 0:o.astState)==null?void 0:m.location}`),((i=t.data)==null?void 0:i.astData.astState.state)==="service"&&(d=`service : ${(s=(l=(y=t.data)==null?void 0:y.erf)==null?void 0:l.address)==null?void 0:s.lmMetro} - ${(c=t.data)==null?void 0:c.erf.erfNo}`),((f=(h=(N=t.data)==null?void 0:N.astData)==null?void 0:h.astState)==null?void 0:f.state)==="temper"&&(d=`temper : ${(S=t.data)==null?void 0:S.erf.address.lmMetro} - ${(D=t.data)==null?void 0:D.erf.erfNo}`),(((g=(B=(M=t.data)==null?void 0:M.astData)==null?void 0:B.astState)==null?void 0:g.state)==""||((R=(v=(G=t.data)==null?void 0:G.astData)==null?void 0:v.astState)==null?void 0:R.state)==null||((F=(A=(E=t.data)==null?void 0:E.astData)==null?void 0:A.astState)==null?void 0:F.state)==null)&&(d=`service : ${($=(j=(I=t.data)==null?void 0:I.erf)==null?void 0:j.address)==null?void 0:$.lmMetro} - ${(P=t.data)==null?void 0:P.erf.erfNo}`),d}},{field:"metadata.createdThrough.creatorTrnName",headerName:"Meter Creator",width:140},{headerName:"Meter Specific Data",children:[{field:"astData.meter.type",headerName:"Meter Type",width:150,hide:!1},{field:"astData.meter.phase",headerName:"Meter Phase",width:150,hide:!1}]},{headerName:"Anomalies",children:[{field:"anomalies.anomaly",headerName:"Anomaly",width:200},{field:"anomalies.anomalyDetail",columnGroupShow:"open",headerName:"Anomaly Detail",width:300}]},{headerName:"Meter Location",children:[{field:"location.address",columnGroupShow:"closed",headerName:"Ast Address",width:450},{field:"location.placement",columnGroupShow:"closed",headerName:"Placement",width:190}]},{headerName:"Circuit Breaker (CB)",children:[{field:"astData.meter.cb.size",columnGroupShow:"open",headerName:"CB (Amps)",width:150},{field:"astData.meter.cb.comment",columnGroupShow:"open",headerName:"CB Comment",width:300}]},{headerName:"Seal",children:[{field:"astData.meter.seal.sealNo",columnGroupShow:"open",headerName:"Seal No",width:150},{field:"astData.meter.seal.comment",columnGroupShow:"open",headerName:"Seal Comment",width:300}]},{field:"serviceConnection.configuration",headerName:"Service Connection",width:300},{field:"serviceConnection.offGridSupply",headerName:"Off Grid Supply",width:300},{field:"tid.status",headerName:"Tid Status",width:300},{field:"tid.statusComment",headerName:"Tid Status Comment",width:300}],createExportRowData:t=>(t==null?void 0:t.length)<1?void 0:t&&(t==null?void 0:t.map(e=>{var l,s,c,N,h,f,S,D,M,B,g,G,v,R,E,A,F,I,j,$,P,k,_,z,L,K,W,J,Q,V,X,Y,Z,w;const r=e==null?void 0:e.media,a=e.metadata.createdAtDatetime,n=new O(a==null?void 0:a.seconds,a==null?void 0:a.nanoseconds),u=n==null?void 0:n.toDate(),o=e.metadata.updatedAtDatetime,m=new O(o==null?void 0:o.seconds,o==null?void 0:o.nanoseconds),i=m==null?void 0:m.toDate();return{id:e.id,"Created By":e.metadata.createdByUser,"Created At":te(u,"yy-MM-dd HH:mm"),"Last Updated By":e.metadata.updatedByUser,"Last Updated At Datetime":te(i,"yy-MM-dd HH:mm"),"Meter No":(l=e==null?void 0:e.astData)==null?void 0:l.astNo,"Meter No picture":x(r,"astNo"),"Meter Manufacturer":(s=e==null?void 0:e.astData)==null?void 0:s.astManufacturer,"Meter Name":(c=e==null?void 0:e.astData)==null?void 0:c.astName,"Meter Type":(h=(N=e==null?void 0:e.astData)==null?void 0:N.meter)==null?void 0:h.type,"Meter Phase":(S=(f=e==null?void 0:e.astData)==null?void 0:f.meter)==null?void 0:S.phase,"CB Size":(B=(M=(D=e==null?void 0:e.astData)==null?void 0:D.meter)==null?void 0:M.cb)==null?void 0:B.size,"CB picture":x(r,"cb"),"CB Comment":(v=(G=(g=e==null?void 0:e.astData)==null?void 0:g.meter)==null?void 0:G.cb)==null?void 0:v.comment,"Seal Number":(A=(E=(R=e==null?void 0:e.astData)==null?void 0:R.meter)==null?void 0:E.seal)==null?void 0:A.sealNo,"Seal Number picture":x(r,"seal"),"Seal Comment":(j=(I=(F=e==null?void 0:e.astData)==null?void 0:F.meter)==null?void 0:I.seal)==null?void 0:j.comment,Anomaly:($=e==null?void 0:e.anomalies)==null?void 0:$.anomaly,"Anomaly picture":x(r,"anomaly"),"Anomaly Detail":(P=e==null?void 0:e.anomalies)==null?void 0:P.anomalyDetail,"Erf No":(k=e==null?void 0:e.erf)==null?void 0:k.erfNo,"Street Adr":(_=e==null?void 0:e.erf)==null?void 0:_.street,"Property Type":(L=(z=e==null?void 0:e.erf)==null?void 0:z.propertyType)==null?void 0:L.type,"Unit Name":(W=(K=e==null?void 0:e.erf)==null?void 0:K.propertyType)==null?void 0:W.unitName,"Unit No":(Q=(J=e==null?void 0:e.erf)==null?void 0:J.propertyType)==null?void 0:Q.unitNo,"Meter Placement":(V=e==null?void 0:e.location)==null?void 0:V.placement,"Meter Placement picture":x(r,"insideBox"),"Meter Address":(X=e==null?void 0:e.location)==null?void 0:X.address,"Service Connection Status":(Y=e==null?void 0:e.serviceConnection)==null?void 0:Y.configuration,"Off Grid Supply":(Z=e==null?void 0:e.serviceConnection)==null?void 0:Z.offGridSupply,"Off Grid picture":x(r,"offGridPhoto"),"TID Status":(w=e==null?void 0:e.tidStatus)==null?void 0:w.status,"TID Status picture":x(r,"tidStatus")}})),error:p}};export{pe as a,ge as u};
//# sourceMappingURL=useAsts-DyUcGYwc.js.map
