import{r as c,T as N,b as A,u as U,w as B,o as Q,q as V,c as X,d as Z,e as ee,f as te,F as L,j as e,a as se,g as re}from"./index-CkAsUE4W.js";import{u as ne,a as ae,b as z}from"./useTrns-UP8r97rG.js";import{F as oe,a as v,b as le,c as ie,d as ce,e as _}from"./FilterUpdatedAtDatetime-BT3qAGJw.js";import{F as de,u as F,w as he}from"./FilterBtn-BhmjWUgx.js";import{P as I}from"./PageTitle-DobOcEIM.js";import{M as y,C as M,A as ue,T as me}from"./ag-theme-quartz-BNE8F_QD.js";import{T as O,A as xe,C as $,S as w,a as pe,R as q}from"./Report-5loSCWLL.js";try{let t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new t.Error().stack;s&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[s]="669be912-9f76-4954-b343-3fa21672612d",t._sentryDebugIdIdentifier="sentry-dbid-669be912-9f76-4954-b343-3fa21672612d")}catch{}function je(){for(var t="0123456789ABCDEF",s="#",r=0;r<6;r++)s+=t[Math.floor(Math.random()*16)];return s}const fe=t=>{const{trnsContext:s,setTrnsContext:r}=c.useContext(N),{trnsStatsContext:a,setTrnsStatsContext:o}=c.useContext(A),[n,l]=c.useState([]),[i,h]=c.useState(""),{getDocument:u}=ne("users"),{user:d}=U(),{getTrnTypesStats:p,getTrnTypePerUserStats:j}=ae(),{uid:g}=d;return c.useEffect(()=>{u(g).then(T=>{const{workbase:f}=T==null?void 0:T.doc;l(f),h("")})},[]),{error:i,getTrns:T=>{console.log("constraints",T);let f=B("erf.address.lmMetro","==",n);T?f=[f,...T]:f=[Q(f,B("astData.trnstate.state","==","stores"))];const K=V(X(Z,t),...f,ee("metadata.updatedAtDatetime","desc"));h(""),te(K,C=>{var k;const x=[];C.docs.forEach(m=>{x.push({id:m.id,...m.data()})});const W=p(x),Y=j(x),b={};x==null||x.forEach(m=>{b[m.metadata.createdByUid]=1+(b[m.metadata.createdByUid]||0)});const P=[];for(const m in b){const R=x.find(S=>{var E;return((E=S==null?void 0:S.metadata)==null?void 0:E.createdByUid)===m}),J=(b[m]/(x==null?void 0:x.length)*100).toFixed(2);P.push({uid:m,displayName:(k=R==null?void 0:R.metadata)==null?void 0:k.createdByUser,quantity:b[m],percentage:J,fillColor:je()})}r({...s,trns:x,statsCreatedAtDatetimeByUser:P,newTrnsData:!0}),o(m=>({...m,statsTrnType:W,trnTypePerUserStats:Y}))},C=>{console.log("firestore err",C.message),h(C.message)})}}},Te=()=>{const{filtersContext:t,setFiltersContext:s}=c.useContext(L);c.useContext(N);const{trnType:r}=t==null?void 0:t.filterCondition,a=!r,o=n=>{s({...t,filterCondition:{...t.filterCondition,trnType:n.currentTarget.value}})};return e.jsx("div",{className:"filter-trn-type",children:e.jsxs("select",{className:"ftt-select",onChange:o,children:[e.jsx("option",{selected:a,value:"",children:"Select Filter"}),e.jsx("option",{value:"audit",children:"Audits"}),e.jsx("option",{value:"tid",children:"Tid"}),e.jsx("option",{value:"installation",children:"Installations"}),e.jsx("option",{value:"inspection",children:"Inspections"}),e.jsx("option",{value:"disconnection",children:"Disconnections"}),e.jsx("option",{value:"reconnection",children:"Reconnections"}),e.jsx("option",{value:"decommissioning",children:"Decommissioning"})]})})},be=()=>{const{filtersContext:t,setFiltersContext:s}=c.useContext(L);c.useContext(N);const{trnAccess:r}=t==null?void 0:t.filterCondition,a=!r,o=n=>{s({...t,filterCondition:{...t.filterCondition,trnAccess:n.currentTarget.value}})};return e.jsx("div",{className:"filter-trn-access",children:e.jsxs("select",{className:"fta-select",onChange:o,children:[e.jsx("option",{selected:a,value:"",children:"Select Filter"}),e.jsx("option",{value:"yes",children:"Yes"}),e.jsx("option",{value:"no",children:"No"})]})})},ye=t=>{const{irepsKeyItem:s}=t,[r,a]=c.useState("reportFilters"),{getTrns:o}=fe("trns");return e.jsxs("div",{className:"filters-trns",children:[e.jsx(oe,{active:r,setActive:a,irepsKeyItem:s}),e.jsxs("div",{className:"filters-body",children:[r==="reportFilters"?e.jsxs("div",{className:"filter-data-filter",children:[e.jsxs("div",{className:"filter-items",children:[e.jsx(v,{title:"CreatedAtDatetime",name:"dateRange",value:"created",children:e.jsx(le,{})}),e.jsx(v,{title:"UpdatedAtDatetime",name:"dateRange",value:"updated",children:e.jsx(ie,{})}),e.jsx(v,{title:"TrnType (audit, tid, etc)",name:"trnType",value:"trnType",children:e.jsx(Te,{})}),e.jsx(v,{title:"Access/No Access ",name:"trnAccess",value:"trnAccess",children:e.jsx(be,{})})]}),e.jsx(ce,{getData:o})]}):"",r==="reportStats"?e.jsx("div",{className:"filter-reports",children:e.jsxs("div",{className:"filter-report-body",children:[e.jsx(_,{title:"Trn Types Stats",name:"trnTypes"}),e.jsx(_,{title:"Trn Types Per Users Stats",name:"trnTypesPerUser"})]})}):""]})]})},Ce=t=>{const{phLl:s,phL2:r,phl3:a,trnsContext:o,setTrnsContext:n,tableRef:l}=t,{user:i}=U(),{createExportRowData:h}=z(),u=p=>{var f;const{rowData:j}=(f=l==null?void 0:l.current)==null?void 0:f.props,g=h(j),D=F.book_new(),T=F.json_to_sheet(g);F.book_append_sheet(D,T,"trns"),he(D,"Trns_Report.xlsx")},{userFromUsers:d}=se(i.uid);return e.jsxs("div",{className:"trns-header",children:[e.jsxs("div",{className:"ph ph-left",children:[e.jsxs("div",{className:"phLl",children:[e.jsx(de,{context:o,setContext:n}),e.jsx(I,{title:s}),e.jsx(I,{title:d.workbase})]}),e.jsx("div",{className:"phLr"})]}),e.jsxs("div",{className:"ph ph-right",children:[e.jsx("div",{className:"phRl"}),e.jsx("div",{className:"phRr",children:e.jsx("button",{className:"export-btn",onClick:u,children:"Export"})})]})]})};y.registerModules([M]);const ve=t=>{const{rowData:s,colDefs:r,tableRef:a}=t,o=c.useRef(),{user:n}=U(),l=n==null?void 0:n.email,i=n==null?void 0:n.displayName,h=c.useMemo(()=>({sortable:!0,filter:!0,resizable:!0,floatingFilter:!0,suppressMovable:!0}),[]),u=j=>j.data.id,d=async j=>{o.current=j.api},p=()=>{l==="fikilekentane@gmail.com"||l==="zamo@rsteutilities.com"||l==="sbu@isandisoipe.co.za"||o.current.setColumnFilterModel("metadata.createdByUser",{filterType:"text",type:"contains",filter:i}),o.current.onFilterChanged()};return e.jsx("div",{className:"ag-theme-quartz table table-trns",children:e.jsx(ue,{rowData:s,columnDefs:r,defaultColDef:h,pagination:!0,noRowsOverlayComponent:me,getRowId:u,reactiveCustomComponents:!0,onGridReady:d,onFirstDataRendered:p,ref:a})})},Ne=t=>{var n;const{trns:s,trnsTableFields:r,tableRef:a}=t,o=(n=r==null?void 0:r.all)==null?void 0:n.all;return e.jsx("div",{className:"trns-table table",children:e.jsx(ve,{rowData:s,colDefs:o,tableRef:a})})},H=t=>{var i;const s=(i=t==null?void 0:t.stats)==null?void 0:i.total,{title:r}=t,a=r,o=" ",n=" ",l=`Total: ${s}`;return e.jsxs("div",{className:"report-heading",children:[e.jsxs("div",{className:"rh rh-left",children:[e.jsx("p",{className:"rhl rh-element rhll",children:a}),e.jsx("p",{className:"rhl rh-element rhlr",children:o})]}),e.jsxs("div",{className:"rh rh-right",children:[e.jsxs("p",{className:"rhr rh-element rhrl",children:[n," "]}),e.jsx("p",{className:"rhr rh-element rhrr",children:l})]})]})},ge=t=>{const{children:s}=t;return e.jsx("div",{className:"stats-combo-50-50",children:s})},De=t=>{const{stats:s,tableRef:r}=t;let a=[{field:"trntype",headerName:"Trn Type",flex:4},{field:"quantity",flex:3},{field:"percentage",flex:3,valueFormatter:o=>`${o.value}%`}];return e.jsx("div",{className:"stats-combo-table-trn-type",children:e.jsx(O,{rowData:s,colDefs:a,tableRef:r})})},Re=t=>{const{stats:s,barChartSeries:r}=t==null?void 0:t.stats,a={title:{text:"Trn Types"},subtitle:{text:"Transaction Types"},data:s,series:r};return e.jsx("div",{className:"stats-combo-bar-chart",children:e.jsx(xe,{options:a})})};y.registerModules([M]);y.registerModules([$]);const Se=()=>{const{trnsStatsContext:t}=c.useContext(A),s=c.useRef(),{statsTrnType:r}=t,a=r==null?void 0:r.stats,o=[{type:"bar",xKey:"trntype",yKey:"quantity",yName:"Trn Type"}],n={stats:r==null?void 0:r.stats,total:r==null?void 0:r.total,barChartSeries:o},l="Trn Type Summary",i=u=>{var d,p;(p=(d=s.current)==null?void 0:d.api)==null||p.exportDataAsCsv()},h={hl1:"hl1",hl2:"",hr1:" ",hr2:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:i,className:"stats-btn stats-btn-export",children:"Export"})," ",e.jsx("button",{className:"stats-btn stats-btn-pdf",children:"Pdf"})]})};return e.jsxs("div",{className:"report-trn-types",children:[e.jsx(H,{title:"Trn Type Stats",stats:n}),e.jsx("div",{className:"rtt-body",children:e.jsxs(ge,{statsName:"Trn Types",children:[e.jsx(w,{statsName:`${l}`,stats:n,headerData:h,tableRef:s,children:e.jsx(De,{stats:a,tableRef:s})}),e.jsx(w,{statsName:`${l}`,stats:n,headerData:h,tableRef:s,children:e.jsx(Re,{stats:n})})]})})]})},Fe=t=>{var o;const{stats:s,tableRef:r}=t;let a=[{field:"trnType",headerName:"Trn Type Name",width:"200"}];return(o=s==null?void 0:s.stats)==null||o.forEach(n=>{const{usersObj:l}=n;for(const i in l)a.some(u=>{var d;return((d=u==null?void 0:u.valueGetterParam)==null?void 0:d.uid)===i})||a.push({field:`userObj.${i}.quantity`,headerName:re(l[i].displayName),width:"60",headerTooltip:l[i].displayName,valueGetter:u=>{var p,j;const d=(j=(p=u.data)==null?void 0:p.usersObj[i])==null?void 0:j.quantity;return d||0},valueGetterParam:{uid:i}})}),a.push({field:"total",headerName:"Total",width:"100",cellRenderer:n=>n.value?n.value:0}),e.jsx("div",{className:"stats-combo-table-trn-per-user",children:e.jsx(O,{rowData:s==null?void 0:s.stats,colDefs:a,tableRef:r})})};y.registerModules([M]);y.registerModules([$]);const we=()=>{const{trnsStatsContext:t}=c.useContext(A),s=c.useRef(),{trnTypePerUserStats:r}=t,a=l=>{s.current.api.exportDataAsCsv()},o="Trn Type Per User",n={hl1:"hl1",hl2:"",hr1:" ",hr2:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:a,className:"stats-btn stats-btn-export",children:"Export"})," ",e.jsx("button",{className:"stats-btn stats-btn-pdf",children:"Pdf"})]})};return e.jsxs("div",{className:"report-trn-types-per-user",children:[e.jsx(H,{title:"Trn Type Per User Stats",stats:r}),e.jsx("div",{className:"rttpu-body",children:e.jsx(pe,{statsName:o,children:e.jsx(w,{statsName:o,stats:r,headerData:n,children:e.jsx(Fe,{stats:r,tableRef:s})})})})]})},G=({trns:t,trnsTableFields:s,tableRef:r})=>e.jsxs("div",{className:"trns-main",children:[e.jsx(Ne,{trns:t,trnsTableFields:s,tableRef:r}),e.jsx(q,{reportName:"trnTypes",children:e.jsx(Se,{})}),e.jsx(q,{reportName:"trnTypesPerUser",children:e.jsx(we,{})})]}),_e=t=>{const{trnType:s,astCat:r}=t,a=c.useRef(),{trnsTableFields:o}=z(),{trnsContext:n,setTrnsContext:l}=c.useContext(N),{trns:i,filterBtn:h}=n;return e.jsxs("div",{className:"trns",children:[e.jsx(Ce,{phLl:"Trns",phL2:r,phL3:s,trnsContext:n,setTrnsContext:l,tableRef:a}),e.jsx("div",{className:"trns-body",children:h?e.jsxs(e.Fragment,{children:[e.jsx(ye,{}),e.jsx(G,{trns:i,trnsTableFields:o,tableRef:a})]}):e.jsx(G,{trns:i,trnsTableFields:o,tableRef:a})})]})};export{_e as default};
//# sourceMappingURL=Trns-ZYu2rWls.js.map
