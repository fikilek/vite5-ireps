import{r as n,a5 as N,a7 as E,B as O,j as e,ab as R,ad as I,ae as M,af as D,ah as P,aq as x,aj as B,a8 as G,a9 as T}from"./index-D5HP0Wxa.js";try{let o=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},r=new o.Error().stack;r&&(o._sentryDebugIds=o._sentryDebugIds||{},o._sentryDebugIds[r]="418f936a-cef9-4b1e-b705-20b526805548",o._sentryDebugIdIdentifier="sentry-dbid-418f936a-cef9-4b1e-b705-20b526805548")}catch{}const U=[{key:"guest",value:"Guest",roleCode:"GST"},{key:"fieldworker",value:"Fieldworker",roleCode:"FWR"},{key:"supervisor",value:"Supervisor",roleCode:"SPV"},{key:"manager",value:"Manager",roleCode:"MNG"},{key:"superuser",value:"Superuser",roleCode:"SPU"}],_=(o,r)=>{const i=JSON.stringify(o),d=JSON.stringify(r),u=i===d;let l={guest:{old:"",new:"",change:""},fieldworker:{old:"",new:"",change:""},supervisor:{old:"",new:"",change:""},manager:{old:"",new:"",change:""},superuser:{old:"",new:"",change:""}};for(const a in l)l[a].old=r[a],l[a].new=o[a],o[a]===r[a]?l[a].change=!1:l[a].change=!0;return{objectsEqual:u,changeSet:l}},H=o=>{const{formData:r}=o,[i,d]=n.useState(""),{customClaims:u,setCustomClaims:l}=n.useContext(N),a=E(),[v,g]=n.useState(null),[h,m]=n.useState({}),[y,j]=n.useState({}),{closeModal:w}=O();n.useEffect(()=>{var s;m((s=r==null?void 0:r.customClaims)==null?void 0:s.roles)},[]),n.useEffect(()=>{const{changeSet:s}=_(h,u.roles);j(s)},[u.roles,h]);const S=s=>{g(t=>!0),G(a,"updateUserRole")({roles:s,uid:r.uid,changeSet:y}).then(t=>{l(f=>{var p,b,C;return{...f,roles:(C=(b=(p=t==null?void 0:t.data)==null?void 0:p.userRecord)==null?void 0:b.customClaims)==null?void 0:C.roles}}),T(`Roles for user "${r.displayName}", updated succesfully`,{position:"bottom-left",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),w(),g(f=>!t.data.userRecord)}).catch(t=>{console.log("error updating role: ",t.message),d(t.message),g(!1)})},k=s=>{let c={};for(const t in s)if(s[t])return c;return c.roles="User must have at least ONE role",c},F=s=>{m({...h,[s.target.value]:s.target.checked})};return e.jsx("div",{className:"form-wrapper",children:e.jsx("div",{className:"form-container user-role-update ",children:e.jsx(R,{initialValues:r.customClaims.roles,onSubmit:S,validate:k,enableReinitialize:!0,children:s=>e.jsx(e.Fragment,{children:e.jsxs(I,{onChange:F,children:[e.jsx(M,{hl1:"User Role Updater Form",hr1:`${r.displayName}`,children:e.jsx(D,{})}),e.jsxs("div",{className:"user-role-update",children:[e.jsx("div",{className:"uru uru-sub-heading",children:e.jsxs("p",{children:["The user has the existing roles shown below. Click on the checkbox to either add a new role or remove the existig role and submit. Roles rules apply","."]})}),e.jsx("div",{className:"uru check-btns",children:e.jsxs("div",{className:"user-roles",children:[e.jsx(P,{control:"checkbox",label:"",name:"roles",roles:U,claims:r.customClaims.roles}),s.errors.roles&&e.jsx(x,{errorMsg:s.errors.roles}),i&&e.jsx(x,{errorMsg:i})]})})]}),e.jsx(B,{formik:s,signState:{isPending:v}})]})})})})})};export{H as default};
//# sourceMappingURL=FormUserRoleUpdate-CQpqD5M4.js.map
