import{r as b,j as n,a5 as g,D as R,u as C,a6 as w,a7 as y,a8 as x,a9 as v,Y as D,n as E,m as N}from"./index-2DC40iBv.js";import{M,C as j,A as U,T}from"./ag-theme-quartz-r68l7Kj_.js";M.registerModules([j]);const S=a=>{const{rowData:c,colDefs:t}=a,i=b.useMemo(()=>({sortable:!0,filter:!0,resizable:!0,floatingFilter:!0,suppressMovable:!0}),[]),s=d=>d.data.id,o={"row-disabled":d=>{var l;return(l=d==null?void 0:d.data)==null?void 0:l.disabled}};return n.jsx("div",{className:"ag-theme-quartz table table-users",children:n.jsx(U,{rowData:c,columnDefs:t,defaultColDef:i,pagination:!0,noRowsOverlayComponent:T,getRowId:s,rowClassRules:o,reactiveCustomComponents:!0})})},p=a=>{var h;const{roles:c}=(h=a==null?void 0:a.data)==null?void 0:h.customClaims;console.log("roles_",c);const{customClaims:t,setCustomClaims:i}=b.useContext(g);console.log("customClaims",t);const[s,o]=b.useState({}),{uid:d}=a==null?void 0:a.data,l=t==null?void 0:t.uid;b.useEffect(()=>{d===l&&t.roles?o(t.roles):o(c)},[t]);const{openModal:e}=R(),{user:r}=C();d===r.uid||a.data.disabled;const u=m=>{i({uid:d,roles:s}),e({modalName:"editUserRoles",payload:a.data})};return n.jsx("div",{className:"table-users-roles",children:w&&w.map(m=>{console.log("role",m);const f=s[m.key]?"hasRole":"";return n.jsx("button",{className:`table-btn ${f}`,title:m.name,onClick:u,children:m.abbreviation},m.name)})})},A=a=>{const{value:c,options:t,onValueChange:i}=a,s=y(),o=x(s,"disableUserAcc"),d=l=>{i(l.target.value),a.api.redrawRows(),o({uid:a.data.uid,action:l.target.value==="disabled"}).then(e=>{v.success(`User acc [${a.data.displayName}] succesfully ${l.target.value==="disabled"?"DISABLED":"ENABLED"}  `,{position:"bottom-left"})}).catch(e=>{console.log("Error:",e.message)})};return n.jsx("div",{className:"table-user-acc-disable-select",children:n.jsx("select",{value:c,className:"table-btn",onChange:d,children:t&&t.map(l=>n.jsx("option",{value:l,children:l},l))})})},k=a=>{const[c,t]=b.useState([]),{user:i}=C(),{data:s}=D("users",null),o=y(),d=x(o,"listAllUsers");return b.useEffect(()=>{i&&d().then(e=>{var u;let r=[];(u=e==null?void 0:e.data)==null||u.forEach(h=>{const m=s.find(f=>h.uid===f.id);m&&r.push({...h,companyName:m.companyName,workbase:m.workbase,phoneNumber:m.phoneNumber})}),t(r)})},[s,i]),{usersTableFields:[{field:"uid",headerName:"users Id",width:250,hide:!0},{field:"disabled",headerName:"Acc Status?",width:150,editable:!0,cellEditor:A,cellEditorParams:{options:["enabled","disabled"]},valueGetter:e=>e.data.disabled?"disabled":"enabled",valueSetter:e=>(e.data.disabled=e.newValue==="disabled",!0),cellStyle:e=>{const{uid:r}=e.data;return r===i.uid?{color:"grey",fontWeight:"700",pointerEvents:"none",cursor:"none",borderLeft:"0.3rem solid grey"}:""}},{field:"workbase",headerName:"Workbase",width:180,cellRenderer:e=>n.jsx(E,{data:e,children:e.value}),cellRendererParams:{modalName:"workbases",width:"8rem"}},{field:"metadata.creationTime",headerName:"Date Created",width:180,cellRenderer:e=>{var u;const r=new Date((u=e.data.metadata)==null?void 0:u.creationTime);return n.jsx(N,{date:r,dateFormat:"yyyy-MMM-dd HH:mm"})}},{field:"metadata.lastSignInTime",headerName:"Last Signin",width:180,cellRenderer:e=>{var u;const r=new Date((u=e.data.metadata)==null?void 0:u.lastSignInTime);return n.jsx(N,{date:r,dateFormat:"yyyy-MMM-dd HH:mm"})}},{field:"displayName",headerName:"Display Name",width:170},{field:"email",headerName:"Email Adr",width:200},{field:"emailVerified",headerName:"Email Verified",width:150,cellRenderer:e=>n.jsx("p",{children:e.data.emailVerified?"Yes":"No"})},{field:"customClaims.roles",headerName:"Roles",width:220,cellRenderer:p,valueGetter:e=>e.value},{field:"phoneNumber",headerName:"Phone Number",width:150},{field:"companyName",headerName:"Company Name",width:170}],users:c}},V=()=>{const{usersTableFields:a,users:c}=k(),[t,i]=b.useState([]),{customClaims:s}=b.useContext(g);return b.useEffect(()=>{i(c)},[c]),b.useEffect(()=>{if(!s)return;const o=t.find(r=>r.uid===(s==null?void 0:s.uid)),d={...o,customClaims:{...o==null?void 0:o.customClaims,roles:s==null?void 0:s.roles}},l=t.findIndex(r=>r.uid===(s==null?void 0:s.uid));if(l===-1)return;const e=t==null?void 0:t.with(l,d);i(e)},[s]),n.jsx("div",{className:"table",children:n.jsx(S,{rowData:t,colDefs:a})})};export{V as default};
