import{r as c,T as N,b as D,u as R,w,o as W,q as Y,c as J,d as Q,e as V,f as X,F as G,j as e,a as Z,g as ee}from"./index-Dyq_Y629.js";import{u as te,a as se,b as re}from"./useTrns-BqU6BRGX.js";import{F as ae,a as b,b as ne,c as oe,d as le,e as B}from"./FilterUpdatedAtDatetime-DVoBCqWs.js";import{P as k}from"./PageTitle-CEEYCQfL.js";import{F as ie}from"./FilterBtn-Cs4qzQNw.js";import{M as y,C as A,A as ce,T as de}from"./ag-theme-quartz-Aqy0TGCY.js";import{T as L,A as he,C as I,S as F,a as me,R as E}from"./Report-4QFs920h.js";function ue(){for(var t="0123456789ABCDEF",s="#",r=0;r<6;r++)s+=t[Math.floor(Math.random()*16)];return s}const xe=t=>{const{trnsContext:s,setTrnsContext:r}=c.useContext(N),{trnsStatsContext:n,setTrnsStatsContext:a}=c.useContext(D),[o,i]=c.useState([]),[l,p]=c.useState(""),{getDocument:x}=te("users"),{user:d}=R(),{getTrnTypesStats:m,getTrnTypePerUserStats:C}=se(),{uid:O}=d;return c.useEffect(()=>{x(O).then(j=>{const{workbase:T}=j==null?void 0:j.doc;i(T),p("")})},[]),{error:l,getTrns:j=>{console.log("constraints",j);let T=w("erf.address.lmMetro","==",o);j?T=[T,...j]:T=[W(T,w("astData.trnstate.state","==","stores"))];const $=Y(J(Q,t),...T,V("metadata.updatedAtDatetime","desc"));p(""),X($,v=>{var M;const u=[];v.docs.forEach(h=>{u.push({id:h.id,...h.data()})});const H=m(u),K=C(u),f={};u==null||u.forEach(h=>{f[h.metadata.createdByUid]=1+(f[h.metadata.createdByUid]||0)});const U=[];for(const h in f){const g=u.find(S=>{var P;return((P=S==null?void 0:S.metadata)==null?void 0:P.createdByUid)===h}),_=(f[h]/(u==null?void 0:u.length)*100).toFixed(2);U.push({uid:h,displayName:(M=g==null?void 0:g.metadata)==null?void 0:M.createdByUser,quantity:f[h],percentage:_,fillColor:ue()})}r({...s,trns:u,statsCreatedAtDatetimeByUser:U,newTrnsData:!0}),a(h=>({...h,statsTrnType:H,trnTypePerUserStats:K}))},v=>{console.log("firestore err",v.message),p(v.message)})}}},pe=()=>{const{filtersContext:t,setFiltersContext:s}=c.useContext(G);c.useContext(N);const{trnType:r}=t==null?void 0:t.filterCondition,n=!r,a=o=>{s({...t,filterCondition:{...t.filterCondition,trnType:o.currentTarget.value}})};return e.jsx("div",{className:"filter-trn-type",children:e.jsxs("select",{className:"ftt-select",onChange:a,children:[e.jsx("option",{selected:n,value:"",children:"Select Filter"}),e.jsx("option",{value:"audit",children:"Audits"}),e.jsx("option",{value:"tid",children:"Tid"}),e.jsx("option",{value:"installation",children:"Installations"}),e.jsx("option",{value:"inspection",children:"Inspections"}),e.jsx("option",{value:"disconnection",children:"Disconnections"}),e.jsx("option",{value:"reconnection",children:"Reconnections"}),e.jsx("option",{value:"decommissioning",children:"Decommissioning"})]})})},je=()=>{const{filtersContext:t,setFiltersContext:s}=c.useContext(G);c.useContext(N);const{trnAccess:r}=t==null?void 0:t.filterCondition,n=!r,a=o=>{s({...t,filterCondition:{...t.filterCondition,trnAccess:o.currentTarget.value}})};return e.jsx("div",{className:"filter-trn-access",children:e.jsxs("select",{className:"fta-select",onChange:a,children:[e.jsx("option",{selected:n,value:"",children:"Select Filter"}),e.jsx("option",{value:"yes",children:"Yes"}),e.jsx("option",{value:"no",children:"No"})]})})},Te=t=>{const{irepsKeyItem:s}=t,[r,n]=c.useState("reportFilters"),{getTrns:a}=xe("trns");return e.jsxs("div",{className:"filters-trns",children:[e.jsx(ae,{active:r,setActive:n,irepsKeyItem:s}),e.jsxs("div",{className:"filters-body",children:[r==="reportFilters"?e.jsxs("div",{className:"filter-data-filter",children:[e.jsxs("div",{className:"filter-items",children:[e.jsx(b,{title:"CreatedAtDatetime",name:"dateRange",value:"created",children:e.jsx(ne,{})}),e.jsx(b,{title:"UpdatedAtDatetime",name:"dateRange",value:"updated",children:e.jsx(oe,{})}),e.jsx(b,{title:"TrnType (audit, tid, etc)",name:"trnType",value:"trnType",children:e.jsx(pe,{})}),e.jsx(b,{title:"Access/No Access ",name:"trnAccess",value:"trnAccess",children:e.jsx(je,{})})]}),e.jsx(le,{getData:a})]}):"",r==="reportStats"?e.jsx("div",{className:"filter-reports",children:e.jsxs("div",{className:"filter-report-body",children:[e.jsx(B,{title:"Trn Types Stats",name:"trnTypes"}),e.jsx(B,{title:"Trn Types Per Users Stats",name:"trnTypesPerUser"})]})}):""]})]})},fe=t=>{const{phLl:s,phL2:r,phl3:n,trnsContext:a,setTrnsContext:o}=t,{user:i}=R(),{userFromUsers:l}=Z(i.uid);return e.jsxs("div",{className:"trns-header",children:[e.jsxs("div",{className:"ph ph-left",children:[e.jsxs("div",{className:"phLl",children:[e.jsx(ie,{context:a,setContext:o}),e.jsx(k,{title:s}),e.jsx(k,{title:l.workbase})]}),e.jsx("div",{className:"phLr"})]}),e.jsxs("div",{className:"ph ph-right",children:[e.jsx("div",{className:"phRl"}),e.jsx("div",{className:"phRr"})]})]})};y.registerModules([A]);const ye=t=>{const{rowData:s,colDefs:r}=t,n=c.useRef(),{user:a}=R(),o=a==null?void 0:a.email,i=a==null?void 0:a.displayName,l=c.useMemo(()=>({sortable:!0,filter:!0,resizable:!0,floatingFilter:!0,suppressMovable:!0}),[]),p=m=>m.data.id,x=async m=>{n.current=m.api},d=()=>{o==="fikilekentane@gmail.com"||o==="zamo@rsteutilities.com"||o==="sbu@isandisoipe.co.za"||n.current.setColumnFilterModel("metadata.createdByUser",{filterType:"text",type:"contains",filter:i}),n.current.onFilterChanged()};return e.jsx("div",{className:"ag-theme-quartz table table-trns",children:e.jsx(ce,{rowData:s,columnDefs:r,defaultColDef:l,pagination:!0,noRowsOverlayComponent:de,getRowId:p,reactiveCustomComponents:!0,onGridReady:x,onFirstDataRendered:d})})},Ce=t=>{var a;const{trns:s,trnsTableFields:r}=t,n=(a=r==null?void 0:r.all)==null?void 0:a.all;return e.jsx("div",{className:"trns-table table",children:e.jsx(ye,{rowData:s,colDefs:n})})},z=t=>{var l;const s=(l=t==null?void 0:t.stats)==null?void 0:l.total,{title:r}=t,n=r,a=" ",o=" ",i=`Total: ${s}`;return e.jsxs("div",{className:"report-heading",children:[e.jsxs("div",{className:"rh rh-left",children:[e.jsx("p",{className:"rhl rh-element rhll",children:n}),e.jsx("p",{className:"rhl rh-element rhlr",children:a})]}),e.jsxs("div",{className:"rh rh-right",children:[e.jsxs("p",{className:"rhr rh-element rhrl",children:[o," "]}),e.jsx("p",{className:"rhr rh-element rhrr",children:i})]})]})},ve=t=>{const{children:s}=t;return e.jsx("div",{className:"stats-combo-50-50",children:s})},be=t=>{const{stats:s,tableRef:r}=t;let n=[{field:"trntype",headerName:"Trn Type",flex:4},{field:"quantity",flex:3},{field:"percentage",flex:3,valueFormatter:a=>`${a.value}%`}];return e.jsx("div",{className:"stats-combo-table-trn-type",children:e.jsx(L,{rowData:s,colDefs:n,tableRef:r})})},Ne=t=>{const{stats:s,barChartSeries:r}=t==null?void 0:t.stats,n={title:{text:"Trn Types"},subtitle:{text:"Transaction Types"},data:s,series:r};return e.jsx("div",{className:"stats-combo-bar-chart",children:e.jsx(he,{options:n})})};y.registerModules([A]);y.registerModules([I]);const ge=()=>{const{trnsStatsContext:t}=c.useContext(D),s=c.useRef(),{statsTrnType:r}=t,n=r==null?void 0:r.stats,a=[{type:"bar",xKey:"trntype",yKey:"quantity",yName:"Trn Type"}],o={stats:r==null?void 0:r.stats,total:r==null?void 0:r.total,barChartSeries:a},i="Trn Type Summary",l=x=>{var d,m;(m=(d=s.current)==null?void 0:d.api)==null||m.exportDataAsCsv()},p={hl1:"hl1",hl2:"",hr1:" ",hr2:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:l,className:"stats-btn stats-btn-export",children:"Export"})," ",e.jsx("button",{className:"stats-btn stats-btn-pdf",children:"Pdf"})]})};return e.jsxs("div",{className:"report-trn-types",children:[e.jsx(z,{title:"Trn Type Stats",stats:o}),e.jsx("div",{className:"rtt-body",children:e.jsxs(ve,{statsName:"Trn Types",children:[e.jsx(F,{statsName:`${i}`,stats:o,headerData:p,tableRef:s,children:e.jsx(be,{stats:n,tableRef:s})}),e.jsx(F,{statsName:`${i}`,stats:o,headerData:p,tableRef:s,children:e.jsx(Ne,{stats:o})})]})})]})},Se=t=>{var a;const{stats:s,tableRef:r}=t;let n=[{field:"trnType",headerName:"Trn Type Name",width:"200"}];return(a=s==null?void 0:s.stats)==null||a.forEach(o=>{const{usersObj:i}=o;for(const l in i)n.some(x=>{var d;return((d=x==null?void 0:x.valueGetterParam)==null?void 0:d.uid)===l})||n.push({field:`userObj.${l}.quantity`,headerName:ee(i[l].displayName),width:"60",headerTooltip:i[l].displayName,valueGetter:x=>{var m,C;const d=(C=(m=x.data)==null?void 0:m.usersObj[l])==null?void 0:C.quantity;return d||0},valueGetterParam:{uid:l}})}),n.push({field:"total",headerName:"Total",width:"100",cellRenderer:o=>o.value?o.value:0}),e.jsx("div",{className:"stats-combo-table-trn-per-user",children:e.jsx(L,{rowData:s==null?void 0:s.stats,colDefs:n,tableRef:r})})};y.registerModules([A]);y.registerModules([I]);const Fe=()=>{const{trnsStatsContext:t}=c.useContext(D),s=c.useRef(),{trnTypePerUserStats:r}=t,n=i=>{s.current.api.exportDataAsCsv()},a="Trn Type Per User",o={hl1:"hl1",hl2:"",hr1:" ",hr2:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:n,className:"stats-btn stats-btn-export",children:"Export"})," ",e.jsx("button",{className:"stats-btn stats-btn-pdf",children:"Pdf"})]})};return e.jsxs("div",{className:"report-trn-types-per-user",children:[e.jsx(z,{title:"Trn Type Per User Stats",stats:r}),e.jsx("div",{className:"rttpu-body",children:e.jsx(me,{statsName:a,children:e.jsx(F,{statsName:a,stats:r,headerData:o,children:e.jsx(Se,{stats:r,tableRef:s})})})})]})},q=({trns:t,trnsTableFields:s})=>e.jsxs("div",{className:"trns-main",children:[e.jsx(Ce,{trns:t,trnsTableFields:s}),e.jsx(E,{reportName:"trnTypes",children:e.jsx(ge,{})}),e.jsx(E,{reportName:"trnTypesPerUser",children:e.jsx(Fe,{})})]}),ke=t=>{const{trnType:s,astCat:r}=t,{trnsTableFields:n}=re(),{trnsContext:a,setTrnsContext:o}=c.useContext(N),{trns:i,filterBtn:l}=a;return e.jsxs("div",{className:"trns",children:[e.jsx(fe,{phLl:"Trns",phL2:r,phL3:s,trnsContext:a,setTrnsContext:o}),e.jsx("div",{className:"trns-body",children:l?e.jsxs(e.Fragment,{children:[e.jsx(Te,{}),e.jsx(q,{trns:i,trnsTableFields:n})]}):e.jsx(q,{trns:i,trnsTableFields:n})})]})};export{ke as default};
