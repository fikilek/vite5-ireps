import{r as c,E as g,s as M,j as s,M as N,C,t as E,v as y,S as k,x as L,u as F,a as D}from"./index-D5HP0Wxa.js";import{u as _}from"./useAstsMap-W_Vr5JQm.js";import{u as I}from"./useErfs-BdV2Y9Xx.js";import{u as S,A as W}from"./useIrepsMap-CHbE4fY6.js";import{M as A}from"./index.esm-DxCoFhVD.js";import O from"./FormErf-CIdLTmk0.js";import{P as v}from"./PageTitle-CFt4pY-w.js";import"./useTrns-CcwdEWrT.js";import"./IwTrnsOnAst-CZ8Q-khj.js";import"./ag-theme-quartz-4EG4JaG4.js";import"./IrepsInfoWindow-BWdrxPlR.js";import"./za_kzn_umgungundlovu_mpofana_w1-CZ0tBZXl.js";try{let o=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},e=new o.Error().stack;e&&(o._sentryDebugIds=o._sentryDebugIds||{},o._sentryDebugIds[e]="9d3762b3-c68d-495a-ad84-46079ec44f8e",o._sentryDebugIdIdentifier="sentry-dbid-9d3762b3-c68d-495a-ad84-46079ec44f8e")}catch{}const R=()=>{const{erfsContext:o,setErfsContext:e}=c.useContext(g),a=M(),{displayLMWardBoundaries:p,state:i,fitWardBoundary:f,displayLmBoundary:h}=S(),{lmWardBoundaries:d,lmBoundary:b}=i;c.useEffect(()=>{a&&p(a)},[p,a]);const l=t=>{var x,u;const n=(x=t.currentTarget)==null?void 0:x.value;try{const r=d==null?void 0:d.find(m=>Number(m==null?void 0:m.ward)===Number(n));a.data.forEach(m=>{a.data.remove(m)}),n==="All Wards"?(h(a),f(a,b),e({...o,ward:null})):(f(a,r==null?void 0:r.wardBoundary,r==null?void 0:r.ward),e({...o,ward:Number(r==null?void 0:r.ward)}),(u=a==null?void 0:a.data)==null||u.loadGeoJson(r==null?void 0:r.erfBoundary))}catch(r){console.log("Error in MapLmWardBoundaries : ",r.message)}};return s.jsx(N,{position:C.TOP_LEFT,style:{margin:"1.6rem"},children:s.jsx("div",{className:"map-lm-ward-boundaries",children:s.jsxs("select",{onChange:l,className:"map-control-select",children:[s.jsx("option",{value:"All Wards",children:"All Wards"},"All Wards"),d&&(d==null?void 0:d.map(t=>s.jsx("option",{value:t==null?void 0:t.ward,children:t==null?void 0:t.ward},t==null?void 0:t.ward)))]})})})},B=()=>{const o=M(),{displayLmBoundary:e,state:a}=S(),{lmBoundary:p}=a;return c.useEffect(()=>{o&&e(o)},[p]),null},P=o=>{var d,b,l,t;const{erf:e,onClick:a,setMarkerRef:p}=o;c.useCallback(()=>a(e),[a,e]);const i=c.useCallback(n=>p(n,e.id),[p,e==null?void 0:e.id]),{asts:f}=e,h=(f==null?void 0:f.length)||"";return s.jsxs(E,{position:{lat:(b=(d=e==null?void 0:e.address)==null?void 0:d.gps)==null?void 0:b.latitude,lng:(t=(l=e==null?void 0:e.address)==null?void 0:l.gps)==null?void 0:t.longitude},ref:i,children:[h&&s.jsx("button",{className:"erf-asts",children:h}),s.jsx("button",{className:"erf-no-btn",children:s.jsx("span",{className:"erf-no",children:e==null?void 0:e.erfNo})})]})},K=()=>{const{erfsContext:o,setErfsContext:e}=c.useContext(g),{erfs:a,ward:p}=c.useMemo(()=>o,[o]),i=a&&(a==null?void 0:a.filter(u=>{var r;return Number((r=u==null?void 0:u.address)==null?void 0:r.ward)===Number(p)})),[f,h]=c.useState({}),[d,b]=c.useState(null),l=c.useMemo(()=>i&&d?i.find(u=>u.id===d):null,[i,d]),t=M(),n=c.useMemo(()=>t?new A({map:t,zoom:10}):null,[t]);c.useEffect(()=>()=>{e({...o,ward:null})},[]),c.useEffect(()=>{if(n)try{n==null||n.clearMarkers(),n==null||n.addMarkers(Object==null?void 0:Object.values(f))}catch(u){console.log("Error in ClusteredErfMarkers: ",u.message)}},[n,f]);const x=c.useCallback((u,r)=>{h(m=>{if(u&&m[r]||!u&&!m[r])return m;if(u)return{...m,[r]:u};{const{[r]:j,...w}=m;return w}})},[]);return s.jsxs("div",{className:"clustered-erf-markers",children:[i.map((u,r)=>s.jsx(P,{erf:u,setMarkerRef:x},u.id)),d&&s.jsx(y,{anchor:f[d],disableAutoPan:!0,headerDisabled:!0,maxWidth:"100vw",children:s.jsx("div",{className:"iw-erf-form",children:s.jsx(O,{data:{data:l}})})})]})},V=o=>{var l,t;const{ast:e,onClick:a,setMarkerRef:p}=o,{lat:i,lng:f}=(l=e==null?void 0:e.location)==null?void 0:l.gps;c.useCallback(()=>a(e),[a,e]);const h=c.useCallback(n=>{if(p)return p(n,e.id)},[p,e.id]),{trns:d}=e,b=(d==null?void 0:d.length)||"";return s.jsxs(E,{position:{lat:Number(i),lng:Number(f)},ref:h,children:[b&&s.jsx("button",{className:"ast-asts",children:b}),s.jsx("button",{className:"ast-no-btn",children:s.jsx("span",{className:"ast-no",children:(t=e==null?void 0:e.astData)==null?void 0:t.astNo})})]})},z=o=>{var u;const{asts:e}=o,{erfsContext:a}=c.useContext(g),{ward:p}=c.useMemo(()=>a,[a]),i=e==null?void 0:e.filter(r=>{var m,j;return Number((j=(m=r==null?void 0:r.erf)==null?void 0:m.address)==null?void 0:j.ward)===Number(p)}),[f,h]=c.useState({}),[d,b]=c.useState(null),l=c.useMemo(()=>i&&d?i.find(r=>r.id===d):null,[i,d]),t=M(),n=c.useMemo(()=>t?new A({map:t,zoom:10}):null,[t]);c.useEffect(()=>{if(n)try{n.clearMarkers(),n.addMarkers(Object.values(f))}catch(r){console.log("Error in ClusteredAstMarkers: ",r.message)}},[n,f]);const x=c.useCallback((r,m)=>{h(j=>{if(r&&j[m]||!r&&!j[m])return j;if(r)return{...j,[m]:r};{const{[m]:w,...T}=j;return T}})},[]);return s.jsxs(s.Fragment,{children:[i==null?void 0:i.map((r,m)=>s.jsx(V,{ast:r,setMarkerRef:x},r.id)),d&&s.jsx(y,{anchor:f[d],onClose:()=>b(null),headerContent:`Meter No: ${(u=l==null?void 0:l.astData)==null?void 0:u.astNo}`,headerDisabled:!0,children:s.jsx("div",{children:s.jsx(W,{data:{data:l}})})})]})},U=o=>{const{asts:e}=o,{erfsContext:a}=c.useContext(g),{ward:p}=c.useMemo(()=>a,[a]),i=e==null?void 0:e.filter(t=>{var n,x;return Number((x=(n=t==null?void 0:t.erf)==null?void 0:n.address)==null?void 0:x.ward)===Number(p)}),f=M(),h=i&&(i==null?void 0:i.map(t=>{var n,x;return{value:(n=t==null?void 0:t.astData)==null?void 0:n.astNo,label:(x=t==null?void 0:t.astData)==null?void 0:x.astNo,data:t}})),d=t=>{var n,x,u,r,m,j;f&&t&&(f.panTo({lat:Number((u=(x=(n=t.data)==null?void 0:n.location)==null?void 0:x.gps)==null?void 0:u.lat),lng:Number((j=(m=(r=t.data)==null?void 0:r.location)==null?void 0:m.gps)==null?void 0:j.lng)}),f.setZoom(20))},b=t=>null,l={control:t=>({...t,backgroundColor:"lightgray",padding:"0.11rem"}),option:(t,n)=>({...t,borderBottom:"1px dotted pink",color:n.isSelected?"white":"black",backgroundColor:n.isSelected?"hotpink":"white"})};return s.jsx(N,{position:C.LEFT_TOP,style:{margin:"1.6rem"},children:s.jsxs("div",{className:"map-ast-filter",children:[s.jsx("div",{className:"maf",children:s.jsx("h2",{children:"Mn"})}),s.jsx(k,{defaultValue:"Meter No",options:h,isClearable:!0,onChange:d,clearValue:b,styles:l})]})})},Z=()=>{const o=M(),{erfsContext:e}=c.useContext(g),{erfs:a,ward:p}=c.useMemo(()=>e,[e]),i=a&&(a==null?void 0:a.filter(l=>{var t;return Number((t=l==null?void 0:l.address)==null?void 0:t.ward)===Number(p)})),f=i&&i.map(l=>({value:l.erfNo,label:l.erfNo,data:l})),h=l=>{var t,n,x,u,r,m;o&&l&&(o.panTo({lat:Number((x=(n=(t=l.data)==null?void 0:t.address)==null?void 0:n.gps)==null?void 0:x.latitude),lng:Number((m=(r=(u=l.data)==null?void 0:u.address)==null?void 0:r.gps)==null?void 0:m.longitude)}),o.setZoom(20))},d=l=>(console.log("clearing selected value",l),null),b={control:l=>({...l,backgroundColor:"lightgray",padding:"0.15rem"}),option:(l,t)=>({...l,borderBottom:"1px dotted pink",color:t.isSelected?"white":"black",backgroundColor:t.isSelected?"hotpink":"white"})};return s.jsx(N,{position:C.LEFT_TOP,style:{margin:"1.6rem"},children:s.jsxs("div",{className:"map-erf-filter",children:[s.jsx("div",{className:"mef",children:s.jsx("h2",{children:"Erf"})}),s.jsx(k,{defaultValue:"Erf No",options:f,isClearable:!0,onChange:h,clearValue:d,styles:b})]})})},$=o=>{const{asts:e,astsTableFields:a}=o,{erfsContext:p}=c.useContext(g),{ward:i}=c.useMemo(()=>p,[p]);return s.jsx("div",{className:"map-main",children:s.jsxs(L,{children:[s.jsx(B,{}),s.jsx(R,{}),s.jsx(z,{asts:e,astsTableFields:a}),s.jsx(K,{}),i?s.jsxs(s.Fragment,{children:[s.jsx(U,{asts:e,astsTableFields:a}),s.jsx(Z,{})]}):""]})})},G=o=>{const{phLl:e}=o,{user:a}=F(),{userFromUsers:p}=D(a==null?void 0:a.uid);return s.jsxs("div",{className:"map-header",children:[s.jsx("div",{className:"ph ph-left",children:s.jsxs("div",{className:"phLl",children:[s.jsx(v,{title:e}),s.jsx(v,{title:p.workbase})]})}),s.jsxs("div",{className:"ph ph-right",children:[s.jsx("div",{className:"phRl"}),s.jsx("div",{className:"phRr"})]})]})},oe=()=>{I();const{asts:o,astsTableFields:e,error:a}=_();return s.jsxs("div",{className:"map",children:[s.jsx(G,{phLl:"Map"}),s.jsx("div",{className:"map-body",children:s.jsx($,{asts:o,astsTableFields:e})})]})};export{oe as default};
//# sourceMappingURL=Map-D8DbEfAW.js.map
