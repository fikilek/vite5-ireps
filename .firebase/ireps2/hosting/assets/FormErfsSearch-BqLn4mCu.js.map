{"version":3,"file":"FormErfsSearch-BqLn4mCu.js","sources":["../../src/hooks/useGetCollectionInfo.jsx","../../src/components/forms/formErf/FormErfsSearch.jsx"],"sourcesContent":["import { useReducer } from \"react\";\nimport { db } from \"@/firebaseConfig/fbConfig\";\nimport {\n\tcollection,\n\tgetCountFromServer,\n\tquery,\n\twhere,\n} from \"firebase/firestore\";\n\nconst initData = {\n\tdata: [],\n\terror: null,\n\tisPending: null,\n\tsuccess: null,\n};\n\nconst colReducer = (state, action) => {\n\t// console.log(`state`, state);\n\t// console.log(`action`, action);\n\tswitch (action.type) {\n\t\tdefault:\n\t\t\treturn state;\n\t\tcase \"IS_PENDING\":\n\t\t\t// console.log(`action.type`, action.type);\n\t\t\treturn {\n\t\t\t\tdata: [],\n\t\t\t\tisPending: true,\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"\",\n\t\t\t};\n\t\tcase \"SUCCESS\":\n\t\t\treturn {\n\t\t\t\tdata: action.payload,\n\t\t\t\terror: false,\n\t\t\t\tisPending: false,\n\t\t\t\tsuccess: true,\n\t\t\t};\n\t\tcase \"ERROR\":\n\t\t\treturn {\n\t\t\t\tdata: [],\n\t\t\t\tisPending: false,\n\t\t\t\tsuccess: false,\n\t\t\t\terror: action.payoad,\n\t\t\t};\n\t}\n};\n\nconst useGetCollectionInfo = col => {\n\t// console.log(`col`, col);\n\t// console.log(`_query`, _query);\n\n\t// const { erfsContext, setErfsContext } = useContext(ErfsContext);\n\t// // console.log(`erfsContext`, erfsContext);\n\n\tconst [state, dispatch] = useReducer(colReducer, initData);\n\t// console.log(`state`, state);\n\n\t// useEffect(() => {\n\t// \tif (state.data.length > 0) {\n\t// \t\tsetErfsContext({\n\t// \t\t\t...erfsContext,\n\t// \t\t\terfs: state.data,\n\t// \t\t});\n\t// \t}\n\t// }, [state, state.data, setErfsContext]);\n\n\tlet colRef = collection(db, col);\n\n\t// const getCollectionInfo = _query => {\n\t// \t// console.log(`..._query`, ..._query);\n\t// \tlet newQuery;\n\n\t// \tif (_query) {\n\t// \t\tnewQuery = query(\n\t// \t\t\tcolRef,\n\t// \t\t\torderBy(\"metadata.updatedAtDatetime\", \"desc\"),\n\t// \t\t\twhere(..._query),\n\t// \t\t\tlimit(500)\n\t// \t\t);\n\t// \t} else {\n\t// \t\tnewQuery = query(colRef, orderBy(\"metadata.updatedAtDatetime\", \"desc\"));\n\t// \t}\n\n\t// \tdispatch({ type: \"IS_PENDING\" });\n\n\t// \tonSnapshot(\n\t// \t\tnewQuery,\n\t// \t\tsnapShot => {\n\t// \t\t\tconst results = [];\n\t// \t\t\tconsole.log(`snapShot`, snapShot);\n\t// \t\t\tsnapShot.docs.forEach(doc => {\n\t// \t\t\t\tresults.push({ id: doc.id, ...doc.data() });\n\t// \t\t\t});\n\t// \t\t\tdispatch({ type: \"SUCCESS\", payload: results });\n\t// \t\t\tif (results?.length > 0) {\n\t// \t\t\t\t// setErfsContext({\n\t// \t\t\t\t// \t...erfsContext,\n\t// \t\t\t\t// \terfs: results,\n\t// \t\t\t\t// });\n\t// \t\t\t}\n\t// \t\t},\n\t// \t\terror => {\n\t// \t\t\tconsole.log(`firestore err`, error.message);\n\t// \t\t\tdispatch({ type: \"ERROR\", payload: error.message });\n\t// \t\t}\n\t// \t);\n\t// };\n\n\tconst getCollectionCount = async _query => {\n\t\t// console.log(`..._query`, ..._query);\n\t\tlet newQuery;\n\n\t\tif (_query) {\n\t\t\tnewQuery = query(colRef, where(..._query));\n\t\t} else {\n\t\t\tnewQuery = query(colRef);\n\t\t}\n\n\t\tdispatch({ type: \"IS_PENDING\" });\n\n\t\tgetCountFromServer(newQuery)\n\t\t\t.then(snapshot => {\n\t\t\t\tconst count = snapshot.data().count;\n\t\t\t\tconsole.log(`count`, count);\n\t\t\t\tdispatch({ type: \"SUCCESS\", payload: count });\n\t\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tconsole.log(`firestore err`, error.message);\n\t\t\t\tdispatch({ type: \"ERROR\", payload: error.message });\n\t\t\t});\n\t};\n\n\treturn { state, getCollectionCount };\n};\n\nexport default useGetCollectionInfo;\n","import { Formik, Form } from \"formik\";\nimport { object, string } from \"yup\";\nimport { useEffect, useState } from \"react\";\nimport { toast } from \"react-toastify\";\n\nimport \"@/components/forms/Form.css\";\n\nimport FormikControl from \"@/components/forms/formik/FormikControl\";\nimport FormFooter from \"@/components/forms/formFooter/FormFooter\";\nimport FormMsg from \"@/components/forms/formMsg/FormMsg\";\nimport FormError from \"@/components/forms/formError/FormError\";\nimport useModal from \"@/hooks/useModal\";\nimport useGetCollection from \"@/hooks/useGetCollectionInfo\";\nimport HeaderGeneric from \"@/components/header/HeaderGeneric\";\n\nconst ErfsSearch = () => {\n\tconst { closeModal } = useModal();\n\n\tconst [erfNo, setErfNo] = useState(null);\n\tconsole.log(`erfNo`, erfNo);\n\n\tconst { state, getCollection } = useGetCollection(\"erfs\");\n\t// console.log(`state`);\n\n\tconst onSubmit = values => {\n\t\tgetCollection([\"erfNo\", \"==\", values.erfNo.trim()]);\n\t};\n\n\tconst validationSchema = object({\n\t\terfNo: string().required(\"Ast No is required.\"),\n\t});\n\n\tuseEffect(() => {\n\t\tif (state.success && state.data.length > 0) {\n\t\t\tcloseModal();\n\t\t\ttoast.success(`Erf No \"${erfNo}\", succesfully found`, {\n\t\t\t\tposition: \"bottom-left\",\n\t\t\t});\n\t\t}\n\t\tif (state.success && state.data.length === 0) {\n\t\t\tcloseModal();\n\t\t\ttoast.warn(`Erf No \"${erfNo}\", NOT found`, {\n\t\t\t\tposition: \"top-left\",\n\t\t\t});\n\t\t\tgetCollection();\n\t\t}\n\t}, [state.success, closeModal]);\n\n\tuseEffect(() => {\n\t\tif (state.error) {\n\t\t\tconsole.log(`state.error`, state.error);\n\t\t}\n\t}, [state.error]);\n\n\treturn (\n\t\t<div className=\"form-wrapper\">\n\t\t\t<div className=\"form-container erfs-search\">\n\t\t\t\t<Formik\n\t\t\t\t\tinitialValues={{\n\t\t\t\t\t\terfNo: \"\",\n\t\t\t\t\t}}\n\t\t\t\t\tonSubmit={onSubmit}\n\t\t\t\t\tvalidationSchema={validationSchema}\n\t\t\t\t>\n\t\t\t\t\t{formik => {\n\t\t\t\t\t\t// console.log(`formik`, formik);\n\t\t\t\t\t\tsetErfNo(formik.values.erfNo);\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<Form>\n\t\t\t\t\t\t\t\t\t<HeaderGeneric hl1=\"Erfs Search\" />\n\t\t\t\t\t\t\t\t\t<FormMsg msg=\"Enter the Erf No to search for.\" />\n\t\t\t\t\t\t\t\t\t<div className=\"search-erfs-form\">\n\t\t\t\t\t\t\t\t\t\t<FormikControl\n\t\t\t\t\t\t\t\t\t\t\tcontrol=\"input\"\n\t\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\t\tlabel=\"Erf NO\"\n\t\t\t\t\t\t\t\t\t\t\tname={\"erfNo\"}\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"\"\n\t\t\t\t\t\t\t\t\t\t\tautoFocus={true}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{state.error && <FormError errorMsg={state.error} />}\n\t\t\t\t\t\t\t\t\t<FormFooter formik={formik} signState={state} />\n\t\t\t\t\t\t\t\t</Form>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t);\n\t\t\t\t\t}}\n\t\t\t\t</Formik>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n\nexport default ErfsSearch;\n"],"names":["initData","colReducer","state","action","useGetCollectionInfo","col","dispatch","useReducer","colRef","collection","db","_query","newQuery","query","where","getCountFromServer","snapshot","count","error","ErfsSearch","closeModal","useModal","erfNo","setErfNo","useState","getCollection","useGetCollection","onSubmit","values","validationSchema","object","string","useEffect","toast","jsx","Formik","formik","Fragment","Form","HeaderGeneric","FormMsg","FormikControl","FormError","FormFooter"],"mappings":"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"}