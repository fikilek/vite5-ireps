import{r as c,T as N,b as w,u as U,w as E,o as Q,q as V,c as X,d as Z,e as tt,f as et,F as I,j as t,a as st,g as rt}from"./index-BVpXZ-6-.js";import{u as nt,a as at,b as z}from"./useTrns-DpaN4G00.js";import{F as ot,a as v,b as lt,c as it,d as ct,e as q}from"./FilterUpdatedAtDatetime-rSckXrhS.js";import{F as dt,u as F,w as ht}from"./FilterBtn-Dy4j4oUD.js";import{P as _}from"./PageTitle-CPMRYOdd.js";import{M as b,C as M,A as ut,T as mt}from"./ag-theme-quartz-BoQ7dcrN.js";import{T as O,A as xt,C as $,S as A,a as pt,R as G}from"./Report-KNixMOvq.js";function jt(){for(var e="0123456789ABCDEF",r="#",s=0;s<6;s++)r+=e[Math.floor(Math.random()*16)];return r}const Tt=e=>{const{trnsContext:r,setTrnsContext:s}=c.useContext(N),{trnsStatsContext:a,setTrnsStatsContext:o}=c.useContext(w),[n,l]=c.useState([]),[i,h]=c.useState(""),{getDocument:u}=nt("users"),{user:d}=U(),{getTrnTypesStats:p,getTrnTypePerUserStats:j}=at(),{uid:g}=d;return c.useEffect(()=>{u(g).then(f=>{const{workbase:T}=f==null?void 0:f.doc;l(T),h("")})},[]),{error:i,getTrns:f=>{console.log("constraints",f);let T=E("erf.address.lmMetro","==",n);f?T=[T,...f]:T=[Q(T,E("astData.trnstate.state","==","stores"))];const K=V(X(Z,e),...T,tt("metadata.updatedAtDatetime","desc"));h(""),et(K,C=>{var k;const x=[];C.docs.forEach(m=>{x.push({id:m.id,...m.data()})});const W=p(x),Y=j(x),y={};x==null||x.forEach(m=>{y[m.metadata.createdByUid]=1+(y[m.metadata.createdByUid]||0)});const P=[];for(const m in y){const S=x.find(D=>{var B;return((B=D==null?void 0:D.metadata)==null?void 0:B.createdByUid)===m}),J=(y[m]/(x==null?void 0:x.length)*100).toFixed(2);P.push({uid:m,displayName:(k=S==null?void 0:S.metadata)==null?void 0:k.createdByUser,quantity:y[m],percentage:J,fillColor:jt()})}s({...r,trns:x,statsCreatedAtDatetimeByUser:P,newTrnsData:!0}),o(m=>({...m,statsTrnType:W,trnTypePerUserStats:Y}))},C=>{console.log("firestore err",C.message),h(C.message)})}}},ft=()=>{const{filtersContext:e,setFiltersContext:r}=c.useContext(I);c.useContext(N);const{trnType:s}=e==null?void 0:e.filterCondition,a=!s,o=n=>{r({...e,filterCondition:{...e.filterCondition,trnType:n.currentTarget.value}})};return t.jsx("div",{className:"filter-trn-type",children:t.jsxs("select",{className:"ftt-select",onChange:o,children:[t.jsx("option",{selected:a,value:"",children:"Select Filter"}),t.jsx("option",{value:"audit",children:"Audits"}),t.jsx("option",{value:"tid",children:"Tid"}),t.jsx("option",{value:"installation",children:"Installations"}),t.jsx("option",{value:"inspection",children:"Inspections"}),t.jsx("option",{value:"disconnection",children:"Disconnections"}),t.jsx("option",{value:"reconnection",children:"Reconnections"}),t.jsx("option",{value:"decommissioning",children:"Decommissioning"})]})})},yt=()=>{const{filtersContext:e,setFiltersContext:r}=c.useContext(I);c.useContext(N);const{trnAccess:s}=e==null?void 0:e.filterCondition,a=!s,o=n=>{r({...e,filterCondition:{...e.filterCondition,trnAccess:n.currentTarget.value}})};return t.jsx("div",{className:"filter-trn-access",children:t.jsxs("select",{className:"fta-select",onChange:o,children:[t.jsx("option",{selected:a,value:"",children:"Select Filter"}),t.jsx("option",{value:"yes",children:"Yes"}),t.jsx("option",{value:"no",children:"No"})]})})},bt=e=>{const{irepsKeyItem:r}=e,[s,a]=c.useState("reportFilters"),{getTrns:o}=Tt("trns");return t.jsxs("div",{className:"filters-trns",children:[t.jsx(ot,{active:s,setActive:a,irepsKeyItem:r}),t.jsxs("div",{className:"filters-body",children:[s==="reportFilters"?t.jsxs("div",{className:"filter-data-filter",children:[t.jsxs("div",{className:"filter-items",children:[t.jsx(v,{title:"CreatedAtDatetime",name:"dateRange",value:"created",children:t.jsx(lt,{})}),t.jsx(v,{title:"UpdatedAtDatetime",name:"dateRange",value:"updated",children:t.jsx(it,{})}),t.jsx(v,{title:"TrnType (audit, tid, etc)",name:"trnType",value:"trnType",children:t.jsx(ft,{})}),t.jsx(v,{title:"Access/No Access ",name:"trnAccess",value:"trnAccess",children:t.jsx(yt,{})})]}),t.jsx(ct,{getData:o})]}):"",s==="reportStats"?t.jsx("div",{className:"filter-reports",children:t.jsxs("div",{className:"filter-report-body",children:[t.jsx(q,{title:"Trn Types Stats",name:"trnTypes"}),t.jsx(q,{title:"Trn Types Per Users Stats",name:"trnTypesPerUser"})]})}):""]})]})},Ct=e=>{const{phLl:r,phL2:s,phl3:a,trnsContext:o,setTrnsContext:n,tableRef:l}=e,{user:i}=U(),{createExportRowData:h}=z(),u=p=>{var T;const{rowData:j}=(T=l==null?void 0:l.current)==null?void 0:T.props,g=h(j),R=F.book_new(),f=F.json_to_sheet(g);F.book_append_sheet(R,f,"trns"),ht(R,"Trns_Report.xlsx")},{userFromUsers:d}=st(i.uid);return t.jsxs("div",{className:"trns-header",children:[t.jsxs("div",{className:"ph ph-left",children:[t.jsxs("div",{className:"phLl",children:[t.jsx(dt,{context:o,setContext:n}),t.jsx(_,{title:r}),t.jsx(_,{title:d.workbase})]}),t.jsx("div",{className:"phLr"})]}),t.jsxs("div",{className:"ph ph-right",children:[t.jsx("div",{className:"phRl"}),t.jsx("div",{className:"phRr",children:t.jsx("button",{className:"export-btn",onClick:u,children:"Export"})})]})]})};b.registerModules([M]);const vt=e=>{const{rowData:r,colDefs:s,tableRef:a}=e,o=c.useRef(),{user:n}=U(),l=n==null?void 0:n.email,i=n==null?void 0:n.displayName,h=c.useMemo(()=>({sortable:!0,filter:!0,resizable:!0,floatingFilter:!0,suppressMovable:!0}),[]),u=j=>j.data.id,d=async j=>{o.current=j.api},p=()=>{l==="fikilekentane@gmail.com"||l==="zamo@rsteutilities.com"||l==="sbu@isandisoipe.co.za"||o.current.setColumnFilterModel("metadata.createdByUser",{filterType:"text",type:"contains",filter:i}),o.current.onFilterChanged()};return t.jsx("div",{className:"ag-theme-quartz table table-trns",children:t.jsx(ut,{rowData:r,columnDefs:s,defaultColDef:h,pagination:!0,noRowsOverlayComponent:mt,getRowId:u,reactiveCustomComponents:!0,onGridReady:d,onFirstDataRendered:p,ref:a})})},Nt=e=>{var n;const{trns:r,trnsTableFields:s,tableRef:a}=e,o=(n=s==null?void 0:s.all)==null?void 0:n.all;return t.jsx("div",{className:"trns-table table",children:t.jsx(vt,{rowData:r,colDefs:o,tableRef:a})})},H=e=>{var i;const r=(i=e==null?void 0:e.stats)==null?void 0:i.total,{title:s}=e,a=s,o=" ",n=" ",l=`Total: ${r}`;return t.jsxs("div",{className:"report-heading",children:[t.jsxs("div",{className:"rh rh-left",children:[t.jsx("p",{className:"rhl rh-element rhll",children:a}),t.jsx("p",{className:"rhl rh-element rhlr",children:o})]}),t.jsxs("div",{className:"rh rh-right",children:[t.jsxs("p",{className:"rhr rh-element rhrl",children:[n," "]}),t.jsx("p",{className:"rhr rh-element rhrr",children:l})]})]})},gt=e=>{const{children:r}=e;return t.jsx("div",{className:"stats-combo-50-50",children:r})},Rt=e=>{const{stats:r,tableRef:s}=e;let a=[{field:"trntype",headerName:"Trn Type",flex:4},{field:"quantity",flex:3},{field:"percentage",flex:3,valueFormatter:o=>`${o.value}%`}];return t.jsx("div",{className:"stats-combo-table-trn-type",children:t.jsx(O,{rowData:r,colDefs:a,tableRef:s})})},St=e=>{const{stats:r,barChartSeries:s}=e==null?void 0:e.stats,a={title:{text:"Trn Types"},subtitle:{text:"Transaction Types"},data:r,series:s};return t.jsx("div",{className:"stats-combo-bar-chart",children:t.jsx(xt,{options:a})})};b.registerModules([M]);b.registerModules([$]);const Dt=()=>{const{trnsStatsContext:e}=c.useContext(w),r=c.useRef(),{statsTrnType:s}=e,a=s==null?void 0:s.stats,o=[{type:"bar",xKey:"trntype",yKey:"quantity",yName:"Trn Type"}],n={stats:s==null?void 0:s.stats,total:s==null?void 0:s.total,barChartSeries:o},l="Trn Type Summary",i=u=>{var d,p;(p=(d=r.current)==null?void 0:d.api)==null||p.exportDataAsCsv()},h={hl1:"hl1",hl2:"",hr1:" ",hr2:t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:i,className:"stats-btn stats-btn-export",children:"Export"})," ",t.jsx("button",{className:"stats-btn stats-btn-pdf",children:"Pdf"})]})};return t.jsxs("div",{className:"report-trn-types",children:[t.jsx(H,{title:"Trn Type Stats",stats:n}),t.jsx("div",{className:"rtt-body",children:t.jsxs(gt,{statsName:"Trn Types",children:[t.jsx(A,{statsName:`${l}`,stats:n,headerData:h,tableRef:r,children:t.jsx(Rt,{stats:a,tableRef:r})}),t.jsx(A,{statsName:`${l}`,stats:n,headerData:h,tableRef:r,children:t.jsx(St,{stats:n})})]})})]})},Ft=e=>{var o;const{stats:r,tableRef:s}=e;let a=[{field:"trnType",headerName:"Trn Type Name",width:"200"}];return(o=r==null?void 0:r.stats)==null||o.forEach(n=>{const{usersObj:l}=n;for(const i in l)a.some(u=>{var d;return((d=u==null?void 0:u.valueGetterParam)==null?void 0:d.uid)===i})||a.push({field:`userObj.${i}.quantity`,headerName:rt(l[i].displayName),width:"60",headerTooltip:l[i].displayName,valueGetter:u=>{var p,j;const d=(j=(p=u.data)==null?void 0:p.usersObj[i])==null?void 0:j.quantity;return d||0},valueGetterParam:{uid:i}})}),a.push({field:"total",headerName:"Total",width:"100",cellRenderer:n=>n.value?n.value:0}),t.jsx("div",{className:"stats-combo-table-trn-per-user",children:t.jsx(O,{rowData:r==null?void 0:r.stats,colDefs:a,tableRef:s})})};b.registerModules([M]);b.registerModules([$]);const At=()=>{const{trnsStatsContext:e}=c.useContext(w),r=c.useRef(),{trnTypePerUserStats:s}=e,a=l=>{r.current.api.exportDataAsCsv()},o="Trn Type Per User",n={hl1:"hl1",hl2:"",hr1:" ",hr2:t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:a,className:"stats-btn stats-btn-export",children:"Export"})," ",t.jsx("button",{className:"stats-btn stats-btn-pdf",children:"Pdf"})]})};return t.jsxs("div",{className:"report-trn-types-per-user",children:[t.jsx(H,{title:"Trn Type Per User Stats",stats:s}),t.jsx("div",{className:"rttpu-body",children:t.jsx(pt,{statsName:o,children:t.jsx(A,{statsName:o,stats:s,headerData:n,children:t.jsx(Ft,{stats:s,tableRef:r})})})})]})},L=({trns:e,trnsTableFields:r,tableRef:s})=>t.jsxs("div",{className:"trns-main",children:[t.jsx(Nt,{trns:e,trnsTableFields:r,tableRef:s}),t.jsx(G,{reportName:"trnTypes",children:t.jsx(Dt,{})}),t.jsx(G,{reportName:"trnTypesPerUser",children:t.jsx(At,{})})]}),qt=e=>{const{trnType:r,astCat:s}=e,a=c.useRef(),{trnsTableFields:o}=z(),{trnsContext:n,setTrnsContext:l}=c.useContext(N),{trns:i,filterBtn:h}=n;return t.jsxs("div",{className:"trns",children:[t.jsx(Ct,{phLl:"Trns",phL2:s,phL3:r,trnsContext:n,setTrnsContext:l,tableRef:a}),t.jsx("div",{className:"trns-body",children:h?t.jsxs(t.Fragment,{children:[t.jsx(bt,{}),t.jsx(L,{trns:i,trnsTableFields:o,tableRef:a})]}):t.jsx(L,{trns:i,trnsTableFields:o,tableRef:a})})]})};export{qt as default};
