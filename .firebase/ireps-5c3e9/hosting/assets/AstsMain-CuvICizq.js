import{r as b,u as L,j as t,F as V,A as W,l as k,a1 as I,i as T,g as S}from"./index-CTrsszhs.js";import{M as N,C as A,A as P,T as X}from"./ag-theme-quartz-D9AA-i26.js";import{l as Y}from"./useErfs-Do9Wfvlc.js";import{A as O,T as z,C as $,a as B,S as M,R}from"./Report-CCkm6UtY.js";import"./useTrns-B_NpY6rq.js";try{let a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},e=new a.Error().stack;e&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[e]="c381de26-5073-4b31-b45d-6aebaf67a31a",a._sentryDebugIdIdentifier="sentry-dbid-c381de26-5073-4b31-b45d-6aebaf67a31a")}catch{}N.registerModules([A]);const Z=a=>{const{rowData:e,colDefs:r,tableRef:d}=a,n=b.useRef(),{user:s}=L(),m=s==null?void 0:s.email,u=s==null?void 0:s.displayName,i=b.useMemo(()=>({sortable:!0,filter:!0,resizable:!0,floatingFilter:!0,suppressMovable:!0}),[]),p=h=>h.data.id,o=async h=>{n.current=h.api},l=()=>{m==="fikilekentane@gmail.com"||m==="zamo@rsteutilities.com"||m==="sbu@isandisoipe.co.za"||n.current.setColumnFilterModel("metadata.createdByUser",{filterType:"text",type:"contains",filter:u}),n.current.onFilterChanged()};return t.jsx("div",{className:"ag-theme-quartz table table-asts",children:t.jsx(P,{rowData:e,columnDefs:r,defaultColDef:i,pagination:!0,noRowsOverlayComponent:X,getRowId:p,reactiveCustomComponents:!0,onGridReady:o,onFirstDataRendered:l,ref:d})})},tt=({asts:a,astsTableFields:e,tableRef:r})=>t.jsx("div",{className:"asts-table table",children:t.jsx(Z,{rowData:a,colDefs:e,tableRef:r})}),K=a=>{var x,y,j,D,w,E;const e=a==null?void 0:a.stats,r=e==null?void 0:e.total,{filtersContext:d}=b.useContext(V),{createdAtDatetimeRange:n,updatedAtDatetimeRange:s,filterCondition:m}=d,{astsContext:u}=b.useContext(W),i=!(n[0]==null||n[0]==null||n[1]==null||n[1]==null),p=!(s[0]==null||s[0]==null||s[1]==null||s[1]==null);let o=[];if(i||p)i&&(o=n),p&&(o=s);else{const v=u==null?void 0:u.asts;if(!v)return;(y=(x=v==null?void 0:v[0])==null?void 0:x.metadata)==null||y.createdAtDatetime;const f=Y.cloneDeep(v);f==null||f.sort((_,H)=>{var F,G,q,U;const Q=(G=(F=_.metadata)==null?void 0:F.createdAtDatetime)==null?void 0:G.toMillis(),J=(U=(q=H.metadata)==null?void 0:q.createdAtDatetime)==null?void 0:U.toMillis();return Q-J});const C=(D=(j=f==null?void 0:f[0])==null?void 0:j.metadata)==null?void 0:D.createdAtDatetime,g=(E=(w=f==null?void 0:f[(f==null?void 0:f.length)-1])==null?void 0:w.metadata)==null?void 0:E.createdAtDatetime;o=[C==null?void 0:C.toDate(),g==null?void 0:g.toDate()]}const l=o==null?void 0:o[0],h=o==null?void 0:o[1];k(new Date(l||0),I.dateFormat3),k(new Date(h||0),I.dateFormat3);const{title:c}=a;return t.jsxs("div",{className:"report-heading",children:[t.jsxs("div",{className:"rh rh-left",children:[t.jsx("p",{className:"rhl rh-element rhll",children:c}),t.jsx("p",{className:"rhr rh-element rhlr"})]}),t.jsxs("div",{className:"rh rh-right",children:[t.jsx("p",{className:"rhr rh-element rhrl"}),t.jsxs("p",{className:"rhr rh-element rhrr",children:["Total: ",r]})]})]})};N.registerModules([A]);const et=a=>{const{rowData:e,colDefs:r}=a;return t.jsx("div",{className:"ag-theme-quartz table table-trns",children:t.jsx(P,{rowData:e,columnDefs:r})})},at=a=>{const{data:e}=a,r=[{field:"uid",headerName:"System Id",hide:!0},{field:"displayName",headerName:"User Name",flex:.5},{field:"quantity",headerName:"Quantities",flex:.3},{field:"percentage",headerName:"%",flex:.2}];return t.jsx("div",{className:"report-asts-users-table",children:t.jsx(et,{rowData:e,colDefs:r})})},st=a=>{const{data:e}=a,[r,d]=b.useState({data:e,series:[{type:"bar",xKey:"displayName",yKey:"quantity",itemStyler:n=>({fill:n.datum.fillColor})}],title:{text:"Meters Created Per Fieldworker"}});return b.useEffect(()=>{d({...r,data:e})},[e]),t.jsx("div",{className:"report-asts-users-barchart",children:t.jsx(O,{options:r})})},rt=()=>{const{astsStatsContext:a}=b.useContext(T),e=a==null?void 0:a.statsAstsUsers;return t.jsxs("div",{className:"report-asts-users",children:[t.jsx(K,{title:"Users Stats",stats:e}),t.jsxs("div",{className:"rau-body",children:[t.jsx(at,{data:e==null?void 0:e.stats}),t.jsx(st,{data:e==null?void 0:e.stats})]})]})},lt=a=>{const{stats:e,tableRef:r}=a;let d=[{field:"anomalyName",headerName:"Anomaly - Anomaly Detail",width:"220"}],n=[];return e==null||e.forEach(s=>{const m=s.anomalyDetailStatsArray;m==null||m.forEach(u=>{const i=u.updatedUserStats,p=`${s.anomalyName}-${u.anomalyDetailName}`;let o={};i==null||i.forEach(l=>{o[l.uid]={user:l},d.some(c=>{var x;return((x=c==null?void 0:c.valueGetterParam)==null?void 0:x.uid)===l.uid})||d.push({field:`userObj.${l.uid}.user.quantity`,headerName:S(l.displayName),width:"58",headerTooltip:l.displayName,valueGetter:c=>{var y,j,D;const x=(D=(j=(y=c.data)==null?void 0:y.userObj[l==null?void 0:l.uid])==null?void 0:j.user)==null?void 0:D.quantity;return x||0},valueGetterParams:{uid:l.uid}})}),n.push({anomalyName:p,anomalyDetailStats:u.anomalyDetailStats,userObj:o})})}),d.push({field:"anomalyDetailStats",headerName:"Total",width:"100",cellRenderer:s=>s.value?s.value:0}),t.jsx("div",{className:"stats-combo-table-anomalies",children:t.jsx(z,{rowData:n,colDefs:d,tableRef:r})})};N.registerModules([A]);N.registerModules([$]);const ot=()=>{const{astsStatsContext:a}=b.useContext(T),e=b.useRef(),{anomalyPerUserStats:r}=a,d=m=>{e.current.api.exportDataAsCsv()},n="Anomaly Summary",s={hl1:"hl1",hl2:"",hr1:" ",hr2:t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:d,className:"stats-btn stats-btn-export",children:"Export"})," ",t.jsx("button",{className:"stats-btn stats-btn-pdf",children:"Pdf"})]})};return t.jsxs("div",{className:"report-asts-anomalies",children:[t.jsx(K,{title:"Meters Anomalies Per User Stats",stats:r}),t.jsx("div",{className:"raa-body",children:t.jsx(B,{statsName:"Anomaly Summary",children:t.jsx(M,{statsName:n,stats:r,headerData:s,children:t.jsx(lt,{stats:r==null?void 0:r.stats,tableRef:e})})})})]})},nt=a=>{const{stats:e,tableRef:r}=a;let d=[{field:"meterTypeName",headerName:"Meter Type",width:"110"}],n=[];return e==null||e.forEach(s=>{var u;let m={};(u=s==null?void 0:s.stats)==null||u.forEach(i=>{const p=d.some(o=>{var l;return((l=o==null?void 0:o.valueGetterParam)==null?void 0:l.uid)===i.uid});m[i.uid]={user:i},p||d.push({field:`users.${i.uid}.user.quantity`,headerName:S(i.displayName),width:"58",headerTooltip:i.displayName,valueGetter:o=>{var h,c,x;const l=(x=(c=(h=o.data)==null?void 0:h.users[i==null?void 0:i.uid])==null?void 0:c.user)==null?void 0:x.quantity;return l||0},valueGetterParam:{uid:i.uid}})}),n.push({meterTypeName:s.meterTypeName,total:s.total,users:m})}),d.push({field:"total",headerName:"Total",width:"100",cellRenderer:s=>s.value?s.value:0}),t.jsx("div",{className:"stats-combo-table-meter-type",children:t.jsx(z,{rowData:n,colDefs:d,tableRef:r})})},it=a=>{const{userData:e,barChartSeries:r}=a==null?void 0:a.stats,d={title:{text:"Meter Type Per User"},subtitle:{text:"Pre-paid/Conventional"},data:e,series:r};return t.jsx("div",{className:"stats-combo-bar-chart",children:t.jsx(O,{options:d})})};N.registerModules([A]);N.registerModules([$]);const dt=()=>{const{astsStatsContext:a}=b.useContext(T),e=b.useRef(),{meterTypePerUserStats:r,anomaliesStats:d}=a,n=[];let s=[];r==null||r.forEach(o=>{var h;let l={meterTypeName:o.meterTypeName};(h=o==null?void 0:o.stats)==null||h.forEach(c=>{if(!n.some(y=>y.uid===c.uid)){const y={type:"bar",xKey:"meterTypeName",yKey:c.uid,yName:S(c.displayName),uid:c.uid};n.push(y)}l={...l,[c.uid]:c.quantity}}),s.push(l)});const m={userData:s,barChartSeries:n},u="Meter Type Summary",i=o=>{var l,h;(h=(l=e.current)==null?void 0:l.api)==null||h.exportDataAsCsv()},p={hl1:"hl1",hl2:"",hr1:" ",hr2:t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:i,className:"stats-btn stats-btn-export",children:"Export"})," ",t.jsx("button",{className:"stats-btn stats-btn-pdf",children:"Pdf"})]})};return t.jsx("div",{className:"report-asts-meter-type",children:t.jsx("div",{className:"ramt-body",children:t.jsxs(B,{statsName:"Meter Type Summary",children:[t.jsx(M,{statsName:`${u}`,stats:m,headerData:p,children:t.jsx(nt,{stats:r,tableRef:e})}),t.jsx(M,{statsName:`${u} Bar Chart`,stats:m,headerData:p,children:t.jsx(it,{stats:m})})]})})})},ft=({asts:a,astsTableFields:e,tableRef:r})=>t.jsxs("div",{className:"asts-main",children:[t.jsx(tt,{asts:a,astsTableFields:e,tableRef:r}),t.jsx(R,{reportName:"users",children:t.jsx(rt,{})}),t.jsx(R,{reportName:"anomalies",children:t.jsx(ot,{})}),t.jsx(R,{reportName:"meterType",children:t.jsx(dt,{})})]});export{ft as default};
//# sourceMappingURL=AstsMain-CuvICizq.js.map
