import{aD as fe,r as c,aF as $,D as me,G as he,bb as ce,j as e,I as ge,bF as pe,bu as q,u as K,bt as z,V as J,l as Q,a9 as T,bG as P,bH as F,bI as X,bJ as Y,a1 as Z,bK as te}from"./index-Ckqn-BEY.js";try{let f=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new f.Error().stack;s&&(f._sentryDebugIds=f._sentryDebugIds||{},f._sentryDebugIds[s]="355208c3-c2cd-4f86-9154-4166be7fa7e6",f._sentryDebugIdIdentifier="sentry-dbid-355208c3-c2cd-4f86-9154-4166be7fa7e6")}catch{}var V=function(){return V=Object.assign||function(f){for(var s,x=1,m=arguments.length;x<m;x++){s=arguments[x];for(var h in s)Object.prototype.hasOwnProperty.call(s,h)&&(f[h]=s[h])}return f},V.apply(this,arguments)},ve=function(f,s){var x={};for(var m in f)Object.prototype.hasOwnProperty.call(f,m)&&s.indexOf(m)<0&&(x[m]=f[m]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function")for(var h=0,m=Object.getOwnPropertySymbols(f);h<m.length;h++)s.indexOf(m[h])<0&&Object.prototype.propertyIsEnumerable.call(f,m[h])&&(x[m[h]]=f[m[h]]);return x},be=fe("ScaleLoader","0% {transform: scaley(1.0)} 50% {transform: scaley(0.4)} 100% {transform: scaley(1.0)}","scale");function re(f){var s=f.loading,x=s===void 0?!0:s,m=f.color,h=m===void 0?"#000000":m,v=f.speedMultiplier,i=v===void 0?1:v,r=f.cssOverride,l=r===void 0?{}:r,y=f.height,S=y===void 0?35:y,C=f.width,b=C===void 0?4:C,d=f.radius,t=d===void 0?2:d,a=f.margin,o=a===void 0?2:a,n=ve(f,["loading","color","speedMultiplier","cssOverride","height","width","radius","margin"]),w=V({display:"inherit"},l),g=function(p){return{backgroundColor:h,width:$(b),height:$(S),margin:$(o),borderRadius:$(t),display:"inline-block",animation:"".concat(be," ").concat(1/i,"s ").concat(p*.1,"s infinite cubic-bezier(0.2, 0.68, 0.18, 1.08)"),animationFillMode:"both"}};return x?c.createElement("span",V({style:w},n),c.createElement("span",{style:g(1)}),c.createElement("span",{style:g(2)}),c.createElement("span",{style:g(3)}),c.createElement("span",{style:g(4)}),c.createElement("span",{style:g(5)})):null}var de={exports:{}};(function(f,s){(function(m,h){f.exports=h(c)})(me,function(x){return function(m){var h={};function v(i){if(h[i])return h[i].exports;var r=h[i]={i,l:!1,exports:{}};return m[i].call(r.exports,r,r.exports,v),r.l=!0,r.exports}return v.m=m,v.c=h,v.d=function(i,r,l){v.o(i,r)||Object.defineProperty(i,r,{enumerable:!0,get:l})},v.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},v.t=function(i,r){if(r&1&&(i=v(i)),r&8||r&4&&typeof i=="object"&&i&&i.__esModule)return i;var l=Object.create(null);if(v.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:i}),r&2&&typeof i!="string")for(var y in i)v.d(l,y,(function(S){return i[S]}).bind(null,y));return l},v.n=function(i){var r=i&&i.__esModule?function(){return i.default}:function(){return i};return v.d(r,"a",r),r},v.o=function(i,r){return Object.prototype.hasOwnProperty.call(i,r)},v.p="",v(v.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(m,h,v){v.r(h);var i=v("react"),r=function(){var b=function(d,t){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,o){a.__proto__=o}||function(a,o){for(var n in o)o.hasOwnProperty(n)&&(a[n]=o[n])},b(d,t)};return function(d,t){b(d,t);function a(){this.constructor=d}d.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)}}(),l=function(){return l=Object.assign||function(b){for(var d,t=1,a=arguments.length;t<a;t++){d=arguments[t];for(var o in d)Object.prototype.hasOwnProperty.call(d,o)&&(b[o]=d[o])}return b},l.apply(this,arguments)},y=function(b,d){var t={};for(var a in b)Object.prototype.hasOwnProperty.call(b,a)&&d.indexOf(a)<0&&(t[a]=b[a]);if(b!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,a=Object.getOwnPropertySymbols(b);o<a.length;o++)d.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(b,a[o])&&(t[a[o]]=b[a[o]]);return t};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(d){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t?new Promise(function(a,o){t.call(navigator,d,a,o)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function S(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var C=function(b){r(d,b);function d(t){var a=b.call(this,t)||this;return a.canvas=null,a.ctx=null,a.requestUserMediaId=0,a.unmounted=!1,a.state={hasUserMedia:!1},a}return d.prototype.componentDidMount=function(){var t=this,a=t.state,o=t.props;if(this.unmounted=!1,!S()){o.onUserMediaError("getUserMedia not supported");return}a.hasUserMedia||this.requestUserMedia(),o.children&&typeof o.children!="function"&&console.warn("children must be a function")},d.prototype.componentDidUpdate=function(t){var a=this.props;if(!S()){a.onUserMediaError("getUserMedia not supported");return}var o=JSON.stringify(t.audioConstraints)!==JSON.stringify(a.audioConstraints),n=JSON.stringify(t.videoConstraints)!==JSON.stringify(a.videoConstraints),w=t.minScreenshotWidth!==a.minScreenshotWidth,g=t.minScreenshotHeight!==a.minScreenshotHeight;(n||w||g)&&(this.canvas=null,this.ctx=null),(o||n)&&(this.stopAndCleanup(),this.requestUserMedia())},d.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},d.stopMediaStream=function(t){t&&(t.getVideoTracks&&t.getAudioTracks?(t.getVideoTracks().map(function(a){t.removeTrack(a),a.stop()}),t.getAudioTracks().map(function(a){t.removeTrack(a),a.stop()})):t.stop())},d.prototype.stopAndCleanup=function(){var t=this.state;t.hasUserMedia&&(d.stopMediaStream(this.stream),t.src&&window.URL.revokeObjectURL(t.src))},d.prototype.getScreenshot=function(t){var a=this,o=a.state,n=a.props;if(!o.hasUserMedia)return null;var w=this.getCanvas(t);return w&&w.toDataURL(n.screenshotFormat,n.screenshotQuality)},d.prototype.getCanvas=function(t){var a=this,o=a.state,n=a.props;if(!this.video||!o.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var w=this.video.videoWidth,g=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var p=w/g;w=n.minScreenshotWidth||this.video.clientWidth,g=w/p,n.minScreenshotHeight&&g<n.minScreenshotHeight&&(g=n.minScreenshotHeight,w=g*p)}this.canvas=document.createElement("canvas"),this.canvas.width=(t==null?void 0:t.width)||w,this.canvas.height=(t==null?void 0:t.height)||g,this.ctx=this.canvas.getContext("2d")}var N=this,M=N.ctx,u=N.canvas;return M&&u&&(u.width=(t==null?void 0:t.width)||u.width,u.height=(t==null?void 0:t.height)||u.height,n.mirrored&&(M.translate(u.width,0),M.scale(-1,1)),M.imageSmoothingEnabled=n.imageSmoothing,M.drawImage(this.video,0,0,(t==null?void 0:t.width)||u.width,(t==null?void 0:t.height)||u.height),n.mirrored&&(M.scale(-1,1),M.translate(-u.width,0))),u},d.prototype.requestUserMedia=function(){var t=this,a=this.props,o=function(g,p){var N={video:typeof p<"u"?p:!0};a.audio&&(N.audio=typeof g<"u"?g:!0),t.requestUserMediaId++;var M=t.requestUserMediaId;navigator.mediaDevices.getUserMedia(N).then(function(u){t.unmounted||M!==t.requestUserMediaId?d.stopMediaStream(u):t.handleUserMedia(null,u)}).catch(function(u){t.handleUserMedia(u)})};if("mediaDevices"in navigator)o(a.audioConstraints,a.videoConstraints);else{var n=function(g){return{optional:[{sourceId:g}]}},w=function(g){var p=g.deviceId;return typeof p=="string"?p:Array.isArray(p)&&p.length>0?p[0]:typeof p=="object"&&p.ideal?p.ideal:null};MediaStreamTrack.getSources(function(g){var p=null,N=null;g.forEach(function(j){j.kind==="audio"?p=j.id:j.kind==="video"&&(N=j.id)});var M=w(a.audioConstraints);M&&(p=M);var u=w(a.videoConstraints);u&&(N=u),o(n(p),n(N))})}},d.prototype.handleUserMedia=function(t,a){var o=this.props;if(t||!a){this.setState({hasUserMedia:!1}),o.onUserMediaError(t);return}this.stream=a;try{this.video&&(this.video.srcObject=a),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(a)})}o.onUserMedia(a)},d.prototype.render=function(){var t=this,a=this,o=a.state,n=a.props,w=n.audio;n.forceScreenshotSourceSize;var g=n.disablePictureInPicture;n.onUserMedia,n.onUserMediaError,n.screenshotFormat,n.screenshotQuality,n.minScreenshotWidth,n.minScreenshotHeight,n.audioConstraints,n.videoConstraints,n.imageSmoothing;var p=n.mirrored,N=n.style,M=N===void 0?{}:N,u=n.children,j=y(n,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),A=p?l(l({},M),{transform:(M.transform||"")+" scaleX(-1)"}):M,k={getScreenshot:this.getScreenshot.bind(this)};return i.createElement(i.Fragment,null,i.createElement("video",l({autoPlay:!0,disablePictureInPicture:g,src:o.src,muted:!w,playsInline:!0,ref:function(B){t.video=B},style:A},j)),u&&u(k))},d.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},d}(i.Component);h.default=C},react:function(m,h){m.exports=x}}).default})})(de);var ye=de.exports;const le=he(ye),ue=()=>{function f(i){const r=new Image;return r.src=i,r}function s(i,r){let l=i.split("%2F").pop();return l=`${r}${l}`,`${i.split("%2F").slice(0,-1).join("%2F")}%2F${l}`}function x(i,r){let l=0,y=0,S=500,C=500;return i.naturalWidth>i.naturalHeight?i.naturalWidth>r&&(S=r,C=r*i.naturalHeight/i.naturalWidth):i.naturalHeight>r&&(C=r,S=r*i.naturalWidth/i.naturalHeight),console.log(l,y,S,C),[l,y,S,C]}function m(i,r){let l=0,y=0,S=r,C=r;return i.naturalWidth>i.naturalHeight?(S=r*i.naturalWidth/i.naturalHeight,l=-Math.abs(S-r)/2):(C=r*i.naturalHeight/i.naturalWidth,y=-Math.abs(C-r)/2),[l,y,S,C]}async function h(i){if(!i||!i.type.startsWith("image/"))throw new Error("Only images are accepted (jpeg, gif, png)");const r=new FileReader;return r.readAsDataURL(i),new Promise(l=>{r.onload=y=>{l(y.target.result)}})}function v(i,r,l=!1,y){const{mediaCategory:S,astNo:C,erfNo:b,createdAtDatetime:d,createdByUser:t,createdAtLocation:a}=y,o=document.createElement("canvas"),n=o.getContext("2d"),w=f(i),[g,p,N,M]=l?m(w,r):x(w,r);return o.width=l?r:N,o.height=l?r:M,n.drawImage(w,g,p,N,M),n.fillRect(10,10,420,260),n.fillStyle="white",n.font="30px sans-serif",n.fillText(ce.get(S),10,50),C&&n.fillText(`Ast No: ${C}`,10,250),b&&n.fillText(`Erf No: ${b}`,10,250),n.fillText(d,10,100),n.fillText(t,10,150),n.fillText(`(${Number(a==null?void 0:a.lat).toFixed(6).trim()}/${Number(a==null?void 0:a.lng).toFixed(6).trim()})`,10,200),new Promise(u=>{o.toBlob(j=>{u(j)},"image/jpeg")})}return{resizeImg:v,getBase64URL:h,prefixFileName:s}},ee=f=>{const{handleClose:s,color:x}=f,m=x||"#f2f";return e.jsx("div",{className:"window-close-btn",children:e.jsx("button",{onClick:s,className:"close-btn",children:e.jsx(ge.Provider,{value:{color:m},children:e.jsx(pe,{})})})})},xe=f=>{var I,R;const{data:s}=f,x={facingMode:{exact:"environment"}},{irepsKeyItem:m}=s;let h,v;m==="trns"&&(h="asts",v=s.data.astData.astId),m==="erfs"&&(h="erfs",v=s.data.id);const i=c.useRef(null),{uploadFile:r,url:l,error:y}=q(s),[S,C]=c.useState(null),[b,d]=c.useState(null),[t,a]=c.useState(null),[o,n]=c.useState({}),[w,g]=c.useState(x),{user:p}=K(),N=p==null?void 0:p.claims,{resizeImg:M,getBase64URL:u}=ue(),{mediaData:j,setMediaData:A}=c.useContext(z),{mediaCat:k,trnId:B}=j,{userLocation:O}=J(),E=c.useCallback(D=>{var ae,ie;const G=i.current.getScreenshot();C(we=>G);const L={mediaType:"image/jpeg",mediaCategory:k,createdByUser:p.displayName,createdByUid:p.uid,createdAtDatetime:Q(new Date,Z.dateFormat2),createdAtLocation:{lat:(ae=O==null?void 0:O.coordinates)==null?void 0:ae.lat,lng:(ie=O==null?void 0:O.coordinates)==null?void 0:ie.lng}};m==="erfs"?n({...L,erfId:s.data.id,erfNo:s.data.erfNo}):m==="trns"?n({...L,astId:s.data.astData.astId,astNo:s.data.astData.astNo,trnId:B}):console.log("throw error")},[s.erfNo,s.id,p.displayName,p.uid,(I=O==null?void 0:O.coordinates)==null?void 0:I.lat,(R=O==null?void 0:O.coordinates)==null?void 0:R.lng]),W=D=>{A({...j,activeMediaAction:null})};c.useEffect(()=>{M(S,1200,!0,o).then(D=>{S&&u(D).then(G=>{d(G)})})},[S,j,u,o,M]);const H=D=>{if(!o.createdAtLocation.lat)return T.error("Cannot upload without user Gps coordinates.",{position:"top-right"}),null;a(!0),r(b,h,v,o,"image")};c.useEffect(()=>((l||y)&&(a(!1),C(null),A({...j,activeMediaAction:null})),y&&T.error(`Storage Error : ${y}`,{position:"top-right"}),()=>{d(null)}),[l,y,j,A]);const U=()=>{C(""),d("")};c.useEffect(()=>()=>{g(x)},[]);const _=D=>{g({...w,facingMode:D.currentTarget.id==="front"?"user":{exact:"environment"}})};return e.jsxs("div",{className:"media-action-camera",children:[e.jsx("div",{className:"media-catergory",children:e.jsxs("p",{className:"media-cat",children:["Take ",ce.get(j.mediaCat)," Photo"]})}),b?e.jsx("div",{className:"macpp resized",children:b&&e.jsx(e.Fragment,{children:e.jsx("img",{className:"img-preview",width:150,height:150,src:b,alt:"resizedBase64URL"})})}):e.jsx("div",{className:"macpp original",children:e.jsx(le,{className:"webcam",width:400,height:400,ref:i,videoConstraints:w,screenshotFormat:"image/jpeg"})}),e.jsxs("div",{className:"mac mac-control-bar",children:[e.jsxs("div",{className:"maccb maccb-left",children:[!S&&e.jsx(P,{id:"",actionClassname:"",title:"click to take a photo",clickHanderFunction:E,actionIcon:F.ICON_CAMERA_SHOOT,color:"blue"}),S&&e.jsx(P,{id:"",actionClassname:"",title:"click to discard",clickHanderFunction:U,actionIcon:F.ICON_DELETE,color:"brown"}),e.jsxs(e.Fragment,{children:[e.jsx(P,{id:"selfie",actionClassname:"",title:"SELFIE photo",clickHanderFunction:_,actionIcon:F.ICON_CAMERA_SELFIE,color:"green"}),e.jsx(P,{id:"front",actionClassname:"",title:"FRONT photo",clickHanderFunction:_,actionIcon:F.ICON_CAMERA_FRONT2,color:"red"})]})]}),e.jsxs("div",{className:"maccb maccb-right",children:[b&&e.jsx(e.Fragment,{children:N.guest?"":e.jsx("button",{disabled:!S,className:"mab btn-submit-form",type:"button",onClick:H,children:t?e.jsx(X,{color:"#F86F03",loading:t<100,size:20,"aria-label":"Loading Spinner","data-testid":"loader"}):e.jsx(Y,{})})}),e.jsx(ee,{handleClose:W})]})]})]})},ne="audio/webm",je=f=>{const{data:s}=f,[x,m]=c.useState(!1),h=c.useRef(null),[v,i]=c.useState("inactive"),[r,l]=c.useState(null),[y,S]=c.useState([]),[C,b]=c.useState(null),[d,t]=c.useState(null),[a,o]=c.useState(null),{uploadFile:n,url:w,error:g}=q(s),[p,N]=c.useState({}),{user:M}=K(),{mediaData:u,setMediaData:j}=c.useContext(z),{userLocation:A}=J(),k=U=>{if(!p.createdAtLocation.lat)return T.error("Cannot upload without user Gps coordinates.",{position:"top-right"}),null;o(!0),n(d,s.irepsKeyItem,s.data.id,p,"audio")};c.useEffect(()=>((w||g)&&(o(!1),j({...u,activeMediaAction:null})),g&&T.error(`Storage Error : ${g}`,{position:"top-right"}),()=>{b(null)}),[w,g,u,j]);const B=U=>{console.log("discard"),b(null),t(null),S(null)},O=U=>{j({...u,activeMediaAction:null})},E=async()=>{if("MediaRecorder"in window)try{const U=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});m(!0),l(U)}catch(U){alert(U.message)}else alert("The MediaRecorder API is not supported in your browser.")},W=async()=>{i("recording");const U=new MediaRecorder(r,{type:"mime/mp4"});h.current=U,h.current.start();let _=[];h.current.ondataavailable=I=>{typeof I.data>"u"||I.data.size!==0&&_.push(I.data)},S(_)},H=()=>{i("inactive"),h.current.stop(),h.current.onstop=()=>{var I,R;const U=new Blob(y,{type:ne}),_=URL.createObjectURL(U);b(_),t(U),N({erfId:s.data.id,erfNo:s.data.erfNo,mediaType:ne,mediaCategory:"erfAudio",createdByUser:M.displayName,createdByUid:M.uid,createdAtDatetime:Q(new Date,Z.dateFormat2),createdAtLocation:{lat:(I=A==null?void 0:A.coordinates)==null?void 0:I.lat,lng:(R=A==null?void 0:A.coordinates)==null?void 0:R.lng}})}};return e.jsxs("div",{className:"media-action-voice",children:[e.jsxs("div",{className:"recording-status",children:[C&&v!=="recording"&&e.jsx("div",{className:"audio-player",children:e.jsx("audio",{src:C,controls:!0})}),v==="recording"&&e.jsxs(e.Fragment,{children:[e.jsx(re,{color:"#F86F03",loading:a<100,size:20,"aria-label":"Loading Spinner","data-testid":"loader"}),e.jsx(re,{color:"#F86F03",loading:a<100,size:20,"aria-label":"Loading Spinner","data-testid":"loader"})]})]}),e.jsxs("div",{className:"mac mac-control-bar",children:[e.jsxs("div",{className:"maccb maccb-left",children:[!x&&e.jsx(P,{id:"",actionClassname:"",title:"Get PERMISSION to record voice",clickHanderFunction:E,actionIcon:F.ICON_PERMISSION,color:"blue"}),C&&e.jsx(P,{id:"",actionClassname:"",title:"DISCARD recorded voice",clickHanderFunction:B,actionIcon:F.ICON_DELETE,color:"blue"}),!C&&x&&e.jsx(P,{id:"",actionClassname:"",title:"START vocie recording",clickHanderFunction:W,actionIcon:F.ICON_START_RECORDING,color:"blue"}),v==="recording"&&e.jsx(P,{id:"",actionClassname:"",title:"STOP voice recording",clickHanderFunction:H,actionIcon:F.ICON_STOP,color:"blue"})]}),e.jsxs("div",{className:"maccb maccb-right",children:[C&&e.jsx("button",{disabled:!C,className:"mab",type:"button",onClick:k,children:a?e.jsx(X,{color:"#F86F03",loading:a<100,size:20,"aria-label":"Loading Spinner","data-testid":"loader"}):e.jsx(Y,{})}),e.jsx(ee,{handleClose:O})]})]})]})},Me={facingMode:"user"},oe="video/webm",Se=f=>{var U,_;const{data:s}=f,x=c.useRef(null),m=c.useRef(null),[h,v]=c.useState(!1),[i,r]=c.useState([]),[l,y]=c.useState(null),[S,C]=c.useState(null),{uploadFile:b,url:d,error:t}=q(s),[a,o]=c.useState(null),[n,w]=c.useState({}),[g,p]=c.useState(Me),{user:N}=K(),{mediaData:M,setMediaData:u}=c.useContext(z),{userLocation:j}=J(),A=I=>{u({...M,activeMediaAction:null})},k=I=>{if(!n.createdAtLocation.lat)return T.error("Cannot upload without user Gps coordinates.",{position:"top-right"}),null;o(!0),b(S,s.irepsKeyItem,s.data.id,n,"video")};c.useEffect(()=>((d||t)&&(o(!1),y(null),r([]),u({...M,activeMediaAction:null})),t&&T.error(`Storage Error : ${t}`,{position:"top-right"}),()=>{y(null),r([])}),[d,t,M,u]);const B=I=>{y(null),r([])},O=I=>{console.log("e.currentTarget.id",I.currentTarget.id),p({...g,facingMode:I.currentTarget.id==="selfie"?"user":{exact:"environment"}})},E=c.useCallback(({data:I})=>{I.size>0&&r(R=>R.concat(I))},[r]),W=c.useCallback(()=>{var I;v(!0),m.current=new MediaRecorder((I=x==null?void 0:x.current)==null?void 0:I.stream,{mimeType:oe}),m.current.addEventListener("dataavailable",E),m.current.start()},[x,v,m,E]),H=c.useCallback(()=>{var I,R,D;(I=m==null?void 0:m.current)==null||I.stop(),v(!1),w({erfId:s.data.id,erfNo:s.data.erfNo,mediaType:oe,mediaCategory:"erfVideo",createdByUser:N.displayName,createdByUid:N.uid,createdAtDatetime:Q(new Date,Z.dateFormat2),createdAtLocation:{lat:(R=j==null?void 0:j.coordinates)==null?void 0:R.lat,lng:(D=j==null?void 0:j.coordinates)==null?void 0:D.lng}})},[m,v,s.erfNo,s.id,N.displayName,N.uid,(U=j==null?void 0:j.coordinates)==null?void 0:U.lat,(_=j==null?void 0:j.coordinates)==null?void 0:_.lng]);return c.useEffect(()=>{if(i.length>0){const I=new Blob(i,{type:"video/webm"}),R=URL.createObjectURL(I);y(R),C(I)}},[i]),e.jsxs("div",{className:"media-action-camera",children:[l?e.jsx("div",{className:"macpp ",children:e.jsx("video",{controls:!0,src:l,autoplay:!0})}):e.jsx("div",{className:"macpp original",children:e.jsx(le,{className:"webcam",width:400,height:400,ref:x,videoConstraints:g,screenshotFormat:"image/jpeg",video:"true",audio:"true"})}),e.jsxs("div",{className:"mac mac-control-bar",children:[e.jsxs("div",{className:"maccb maccb-left",children:[!h&&!l&&e.jsx(P,{id:"",actionClassname:"",title:"START recording",clickHanderFunction:W,actionIcon:F.ICON_VIDEO_RECORDING2,color:"blue"}),h&&e.jsx(P,{id:"",actionClassname:"",title:"STOP recording",clickHanderFunction:H,actionIcon:F.ICON_STOP,color:"brown"}),!l&&!h&&e.jsxs(e.Fragment,{children:[e.jsx(P,{id:"selfie",actionClassname:"",title:"SELFIE photo",clickHanderFunction:O,actionIcon:F.ICON_CAMERA_SELFIE,color:"green"}),e.jsx(P,{id:"front",actionClassname:"",title:"FRONT photo",clickHanderFunction:O,actionIcon:F.ICON_CAMERA_FRONT2,color:"orange"})]}),l&&e.jsx(P,{id:"discard",actionClassname:"",title:"DISCARD video",clickHanderFunction:B,actionIcon:F.ICON_DELETE,color:"red"})]}),e.jsxs("div",{className:"maccb maccb-right",children:[l&&e.jsx("button",{disabled:!l,className:"mab btn-submit-form",type:"button",onClick:k,children:a?e.jsx(X,{color:"#F86F03",loading:a<100,size:20,"aria-label":"Loading Spinner","data-testid":"loader"}):e.jsx(Y,{})}),e.jsx(ee,{handleClose:A})]})]})]})},se="/assets/place_holder1-BNACb7kD.png",Ce=f=>{const{data:s}=f,x=c.useRef(null),m=c.useRef(null),[h,v]=c.useState("resized"),i=O=>{v(O)},[r,l]=c.useState(null),[y,S]=c.useState(null),[C,b]=c.useState(null),[d,t]=c.useState({}),{uploadFile:a,url:o,error:n}=q(s),{user:w}=K(),{resizeImg:g,getBase64URL:p}=ue(),{mediaData:N,setMediaData:M}=c.useContext(z),{userLocation:u}=J(),j=O=>{var U,_,I,R;const E=O.target.files[0],W=["image/png","image/jpeg"];if(!E)return;if(!((U=u==null?void 0:u.coordinates)!=null&&U.lat)||!((_=u==null?void 0:u.coordinates)!=null&&_.lng)){T.error("User Gps Coordinates required when uploading an image",{position:"top-right"});return}if(!W.includes(E.type)){T.error("File must be of type jpeg or png",{position:"top-right"});return}const H=new FileReader;H.onload=D=>{var G,L;x.current.src=(G=D.target)==null?void 0:G.result,S((L=D.target)==null?void 0:L.result)},H.readAsDataURL(E),t({erfId:s.data.id,erfNo:s.data.erfNo,contentType:E==null?void 0:E.type,mediaType:E==null?void 0:E.type,mediaCategory:"erfPhoto",createdByUser:w.displayName,createdByUid:w.uid,createdAtDatetime:Q(new Date,Z.dateFormat2),createdAtLocation:{lat:(I=u==null?void 0:u.coordinates)==null?void 0:I.lat,lng:(R=u==null?void 0:u.coordinates)==null?void 0:R.lng}})};c.useEffect(()=>{g(y,1200,!0,d).then(O=>{y&&p(O).then(E=>{l(E)})})},[y,p,g,d]);const A=O=>{if(!d.createdAtLocation.lat)return T.error("Cannot upload without user Gps coordinates.",{position:"top-right"}),null;b(!0),a(r,s.irepsKeyItem,s.data.id,d,"image")};c.useEffect(()=>((o||n)&&(b(!1),M({...N,activeMediaAction:null})),n&&T.error(`Storage Error : ${n}`,{position:"top-right"}),()=>{l(null)}),[o,n,N,M]);const k=O=>{M({...N,activeMediaAction:null})},B=O=>{l(null),S(null),x.current.src="",x.current.alt="",m.current.src="",m.current.alt=""};return e.jsxs("div",{className:"media-action-gallery",children:[e.jsx("div",{className:"mag",children:e.jsxs("div",{className:"mag-wrapper",children:[e.jsxs("div",{className:"magw",children:[e.jsxs("div",{className:`magpp original ${h==="original"?"show":"hide"} `,children:[e.jsx("p",{children:"Original Picture"}),e.jsx("img",{className:"img-preview",ref:x,width:150,height:150,src:se,alt:"ireps pic"})]}),e.jsxs("div",{className:`magpp resized ${h==="resized"?"show":"hide"}`,children:[e.jsx("p",{children:"Resized Picture"}),e.jsx("img",{ref:m,className:"img-preview",width:150,height:150,src:r||se,alt:"resizedBase64URL"})]})]}),e.jsxs("div",{className:"mmb-btns",children:[y&&e.jsx(te,{selectWindow:B,mmbIcon:F.ICON_DISCARD,color:"",label:"discard",title:"DISCARD Image / Reset"}),y&&e.jsx(te,{selectWindow:i,mmbIcon:F.ICON_IMAGE1,color:"",label:"original",title:"View Original Image"}),r&&e.jsx(te,{selectWindow:i,mmbIcon:F.ICON_IMAGE2,color:"",label:"resized",title:"View Resized Image"})]})]})}),e.jsxs("div",{className:"mag mac-control-bar",children:[e.jsx("div",{className:"magcb magcb-left",children:e.jsx("form",{children:e.jsx("input",{type:"file",accept:"image/*",onChange:j})})}),e.jsxs("div",{className:"magcb magcb-right",children:[r&&e.jsx(e.Fragment,{children:e.jsx("button",{disabled:!r,className:"mab btn-submit-form",type:"button",onClick:A,children:C?e.jsx(X,{color:"#F86F03",loading:C<100,size:20,"aria-label":"Loading Spinner","data-testid":"loader"}):e.jsx(Y,{})})}),e.jsx(ee,{handleClose:k})]})]})]})},Ne=f=>{const{mediaData:s}=c.useContext(z);return e.jsxs("div",{className:`media-action ${s.activeMediaAction?"showMediaAction":"hideMediaAction"}  `,children:[s.activeMediaAction==="camera"&&e.jsx(xe,{data:f.data}),s.activeMediaAction==="voice"&&e.jsx(je,{data:f.data}),s.activeMediaAction==="video"&&e.jsx(Se,{data:f.data}),s.activeMediaAction==="gallery"&&e.jsx(Ce,{data:f.data})]})};export{Ne as default};
//# sourceMappingURL=MediaAction-DfEWkPSQ.js.map
