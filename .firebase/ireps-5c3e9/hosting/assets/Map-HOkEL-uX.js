import{r as d,E as g,x as N,j as s,M,C,y as v,z as y,S as k,D as L,u as D,a as F}from"./index-DsAPZw0f.js";import{u as _}from"./useAstsMap-ewLpwsRn.js";import{u as I}from"./useErfs-DJZe50Dm.js";import{u as A,A as W}from"./useIrepsMap-DpviD7gl.js";import{M as S}from"./index.esm-BXSQGyMY.js";import O from"./FormErf-CFWkO_aQ.js";import{P as E}from"./PageTitle-CVw1k6F6.js";import"./useTrns-Dq2tKmwC.js";import"./IwTrnsOnAst-CnAzpfah.js";import"./ag-theme-quartz-DQ9Lll7L.js";import"./IrepsInfoWindow-DIQfAo3o.js";import"./za_kzn_umgungundlovu_mpofana_w1-CZ0tBZXl.js";try{let o=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},e=new o.Error().stack;e&&(o._sentryDebugIds=o._sentryDebugIds||{},o._sentryDebugIds[e]="efe6a3d6-8ccc-40b8-9755-acefba2b2965",o._sentryDebugIdIdentifier="sentry-dbid-efe6a3d6-8ccc-40b8-9755-acefba2b2965")}catch{}const R=()=>{const{erfsContext:o,setErfsContext:e}=d.useContext(g),a=N(),{displayLMWardBoundaries:f,state:u,fitWardBoundary:h,displayLmBoundary:b}=A(),{lmWardBoundaries:i,lmBoundary:x}=u;d.useEffect(()=>{a&&f(a)},[f,a]);const l=t=>{var p,c;const n=(p=t.currentTarget)==null?void 0:p.value;try{const r=i==null?void 0:i.find(m=>Number(m==null?void 0:m.ward)===Number(n));a.data.forEach(m=>{a.data.remove(m)}),n==="All Wards"?(b(a),h(a,x),e({...o,ward:null})):(h(a,r==null?void 0:r.wardBoundary,r==null?void 0:r.ward),e({...o,ward:Number(r==null?void 0:r.ward)}),(c=a==null?void 0:a.data)==null||c.loadGeoJson(r==null?void 0:r.erfBoundary))}catch(r){console.log("Error in MapLmWardBoundaries : ",r.message)}};return s.jsx(M,{position:C.TOP_LEFT,style:{margin:"1.6rem"},children:s.jsx("div",{className:"map-lm-ward-boundaries",children:s.jsxs("select",{onChange:l,className:"map-control-select",children:[s.jsx("option",{value:"All Wards",children:"All Wards"},"All Wards"),i&&(i==null?void 0:i.map(t=>s.jsx("option",{value:t==null?void 0:t.ward,children:t==null?void 0:t.ward},t==null?void 0:t.ward)))]})})})},B=()=>{const o=N(),{displayLmBoundary:e,state:a}=A(),{lmBoundary:f}=a;return d.useEffect(()=>{o&&e(o)},[f]),null},P=o=>{var l,t,n,p;const{erf:e,onClick:a,setMarkerRef:f}=o,[u,h]=d.useState(null);d.useEffect(()=>{var c,r;(c=e==null?void 0:e.trns)!=null&&c.length&&h((r=e==null?void 0:e.trns)==null?void 0:r.length)},[]),d.useCallback(()=>a(e),[a,e]);const b=d.useCallback(c=>f(c,e.id),[f,e==null?void 0:e.id]),{asts:i}=e,x=(i==null?void 0:i.length)||"";return s.jsx("div",{className:"erf-marker",children:s.jsxs(v,{position:{lat:(t=(l=e==null?void 0:e.address)==null?void 0:l.gps)==null?void 0:t.latitude,lng:(p=(n=e==null?void 0:e.address)==null?void 0:n.gps)==null?void 0:p.longitude},ref:b,children:[u&&s.jsx("button",{className:"erf-no-access",children:u}),x&&s.jsx("button",{className:"erf-asts",children:x}),s.jsx("button",{className:"erf-no-btn",children:s.jsx("span",{className:"erf-no",children:e==null?void 0:e.erfNo})})]})})},K=()=>{const{erfsContext:o,setErfsContext:e}=d.useContext(g),{erfs:a,ward:f}=d.useMemo(()=>o,[o]),u=a&&(a==null?void 0:a.filter(c=>{var r;return Number((r=c==null?void 0:c.address)==null?void 0:r.ward)===Number(f)})),[h,b]=d.useState({}),[i,x]=d.useState(null),l=d.useMemo(()=>u&&i?u.find(c=>c.id===i):null,[u,i]),t=N(),n=d.useMemo(()=>t?new S({map:t,zoom:10}):null,[t]);d.useEffect(()=>()=>{e({...o,ward:null})},[]),d.useEffect(()=>{if(n)try{n==null||n.clearMarkers(),n==null||n.addMarkers(Object==null?void 0:Object.values(h))}catch(c){console.log("Error in ClusteredErfMarkers: ",c.message)}},[n,h]);const p=d.useCallback((c,r)=>{b(m=>{if(c&&m[r]||!c&&!m[r])return m;if(c)return{...m,[r]:c};{const{[r]:j,...w}=m;return w}})},[]);return s.jsxs("div",{className:"clustered-erf-markers",children:[u.map((c,r)=>s.jsx(P,{erf:c,setMarkerRef:p},c.id)),i&&s.jsx(y,{anchor:h[i],disableAutoPan:!0,headerDisabled:!0,maxWidth:"100vw",children:s.jsx("div",{className:"iw-erf-form",children:s.jsx(O,{data:{data:l}})})})]})},V=o=>{var l,t;const{ast:e,onClick:a,setMarkerRef:f}=o,{lat:u,lng:h}=(l=e==null?void 0:e.location)==null?void 0:l.gps;d.useCallback(()=>a(e),[a,e]);const b=d.useCallback(n=>{if(f)return f(n,e.id)},[f,e.id]),{trns:i}=e,x=(i==null?void 0:i.length)||"";return s.jsxs(v,{position:{lat:Number(u),lng:Number(h)},ref:b,children:[x&&s.jsx("button",{className:"ast-asts",children:x}),s.jsx("button",{className:"ast-no-btn",children:s.jsx("span",{className:"ast-no",children:(t=e==null?void 0:e.astData)==null?void 0:t.astNo})})]})},z=o=>{var c;const{asts:e}=o,{erfsContext:a}=d.useContext(g),{ward:f}=d.useMemo(()=>a,[a]),u=e==null?void 0:e.filter(r=>{var m,j;return Number((j=(m=r==null?void 0:r.erf)==null?void 0:m.address)==null?void 0:j.ward)===Number(f)}),[h,b]=d.useState({}),[i,x]=d.useState(null),l=d.useMemo(()=>u&&i?u.find(r=>r.id===i):null,[u,i]),t=N(),n=d.useMemo(()=>t?new S({map:t,zoom:10}):null,[t]);d.useEffect(()=>{if(n)try{n.clearMarkers(),n.addMarkers(Object.values(h))}catch(r){console.log("Error in ClusteredAstMarkers: ",r.message)}},[n,h]);const p=d.useCallback((r,m)=>{b(j=>{if(r&&j[m]||!r&&!j[m])return j;if(r)return{...j,[m]:r};{const{[m]:w,...T}=j;return T}})},[]);return s.jsxs(s.Fragment,{children:[u==null?void 0:u.map((r,m)=>s.jsx(V,{ast:r,setMarkerRef:p},r.id)),i&&s.jsx(y,{anchor:h[i],onClose:()=>x(null),headerContent:`Meter No: ${(c=l==null?void 0:l.astData)==null?void 0:c.astNo}`,headerDisabled:!0,children:s.jsx("div",{children:s.jsx(W,{data:{data:l}})})})]})},U=o=>{const{asts:e}=o,{erfsContext:a}=d.useContext(g),{ward:f}=d.useMemo(()=>a,[a]),u=e==null?void 0:e.filter(t=>{var n,p;return Number((p=(n=t==null?void 0:t.erf)==null?void 0:n.address)==null?void 0:p.ward)===Number(f)}),h=N(),b=u&&(u==null?void 0:u.map(t=>{var n,p;return{value:(n=t==null?void 0:t.astData)==null?void 0:n.astNo,label:(p=t==null?void 0:t.astData)==null?void 0:p.astNo,data:t}})),i=t=>{var n,p,c,r,m,j;h&&t&&(h.panTo({lat:Number((c=(p=(n=t.data)==null?void 0:n.location)==null?void 0:p.gps)==null?void 0:c.lat),lng:Number((j=(m=(r=t.data)==null?void 0:r.location)==null?void 0:m.gps)==null?void 0:j.lng)}),h.setZoom(20))},x=t=>null,l={control:t=>({...t,backgroundColor:"lightgray",padding:"0.11rem"}),option:(t,n)=>({...t,borderBottom:"1px dotted pink",color:n.isSelected?"white":"black",backgroundColor:n.isSelected?"hotpink":"white"})};return s.jsx(M,{position:C.LEFT_TOP,style:{margin:"1.6rem"},children:s.jsxs("div",{className:"map-ast-filter",children:[s.jsx("div",{className:"maf",children:s.jsx("h2",{children:"Mn"})}),s.jsx(k,{defaultValue:"Meter No",options:b,isClearable:!0,onChange:i,clearValue:x,styles:l})]})})},Z=()=>{const o=N(),{erfsContext:e}=d.useContext(g),{erfs:a,ward:f}=d.useMemo(()=>e,[e]),u=a&&(a==null?void 0:a.filter(l=>{var t;return Number((t=l==null?void 0:l.address)==null?void 0:t.ward)===Number(f)})),h=u&&u.map(l=>({value:l.erfNo,label:l.erfNo,data:l})),b=l=>{var t,n,p,c,r,m;o&&l&&(o.panTo({lat:Number((p=(n=(t=l.data)==null?void 0:t.address)==null?void 0:n.gps)==null?void 0:p.latitude),lng:Number((m=(r=(c=l.data)==null?void 0:c.address)==null?void 0:r.gps)==null?void 0:m.longitude)}),o.setZoom(20))},i=l=>(console.log("clearing selected value",l),null),x={control:l=>({...l,backgroundColor:"lightgray",padding:"0.15rem"}),option:(l,t)=>({...l,borderBottom:"1px dotted pink",color:t.isSelected?"white":"black",backgroundColor:t.isSelected?"hotpink":"white"})};return s.jsx(M,{position:C.LEFT_TOP,style:{margin:"1.6rem"},children:s.jsxs("div",{className:"map-erf-filter",children:[s.jsx("div",{className:"mef",children:s.jsx("h2",{children:"Erf"})}),s.jsx(k,{defaultValue:"Erf No",options:h,isClearable:!0,onChange:b,clearValue:i,styles:x})]})})},$=o=>{const{asts:e,astsTableFields:a}=o,{erfsContext:f}=d.useContext(g),{ward:u}=d.useMemo(()=>f,[f]);return s.jsx("div",{className:"map-main",children:s.jsxs(L,{children:[s.jsx(B,{}),s.jsx(R,{}),s.jsx(z,{asts:e,astsTableFields:a}),s.jsx(K,{}),u?s.jsxs(s.Fragment,{children:[s.jsx(U,{asts:e,astsTableFields:a}),s.jsx(Z,{})]}):""]})})},G=o=>{const{phLl:e}=o,{user:a}=D(),{userFromUsers:f}=F(a==null?void 0:a.uid);return s.jsxs("div",{className:"map-header",children:[s.jsx("div",{className:"ph ph-left",children:s.jsxs("div",{className:"phLl",children:[s.jsx(E,{title:e}),s.jsx(E,{title:f.workbase})]})}),s.jsxs("div",{className:"ph ph-right",children:[s.jsx("div",{className:"phRl"}),s.jsx("div",{className:"phRr"})]})]})},oe=()=>{I();const{asts:o,astsTableFields:e,error:a}=_();return s.jsxs("div",{className:"map",children:[s.jsx(G,{phLl:"Map"}),s.jsx("div",{className:"map-body",children:s.jsx($,{asts:o,astsTableFields:e})})]})};export{oe as default};
//# sourceMappingURL=Map-HOkEL-uX.js.map
