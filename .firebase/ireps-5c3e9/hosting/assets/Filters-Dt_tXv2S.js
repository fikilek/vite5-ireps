import{j as e,r as l,A as w,i as q,u as I,w as S,o as O,q as G,c as K,d as _,e as H,f as z,F as p}from"./index-DTpsEHRa.js";import{e as g,a as h,b as J,c as L,d as Q,F as V}from"./FilterUpdatedAtDatetime-BDFP7tPD.js";import{u as X}from"./useTrns-u3hDq8uc.js";import{a as Y}from"./useAsts-DHV-Igtn.js";import"./TableBtnsPossibleTrnsOnAst-BG1CvRs6.js";const Z=()=>e.jsx("div",{className:"filter-reports",children:e.jsxs("div",{className:"filter-report-body",children:[e.jsx(g,{title:"Meters Per User Stats",name:"users"}),e.jsx(g,{title:"Meters Type Per User Stats",name:"meterType"}),e.jsx(g,{title:"Meters Anomalies Per User Stats",name:"anomalies"})]})});function $(){for(var t="0123456789ABCDEF",s="#",r=0;r<6;r++)s+=t[Math.floor(Math.random()*16)];return s}const ee=t=>{const{astsContext:s,setAstsContext:r}=l.useContext(w),{astsStatsContext:o,setAstsStatsContext:c}=l.useContext(q),[i,y]=l.useState([]),[T,j]=l.useState(""),{getDocument:U}=X("users"),{user:N}=I(),{getAstsUsersStats:M,getMeterTypePerUserStats:P,getAnomalyPerUserStats:B}=Y(),{uid:D}=N;return l.useEffect(()=>{U(D).then(u=>{const{workbase:d}=u==null?void 0:u.doc;y(d),j("")})},[]),{error:T,getAsts:u=>{let d=S("erf.address.lmMetro","==",i);u?d=[d,...u]:d=[O(d,S("astData.astState.state","==","stores"))];const W=G(K(_,t),...d,H("metadata.updatedAtDatetime","desc"));j(""),z(W,m=>{var A;const a=[];m.docs.forEach(n=>{a.push({id:n.id,...n.data()})});const b=M(a),k=P(a),E=B(a),x={};a==null||a.forEach(n=>{x[n.metadata.createdByUid]=1+(x[n.metadata.createdByUid]||0)});const f=[];for(const n in x){const C=a.find(v=>{var F;return((F=v==null?void 0:v.metadata)==null?void 0:F.createdByUid)===n}),R=(x[n]/(a==null?void 0:a.length)*100).toFixed(2);f.push({uid:n,displayName:(A=C==null?void 0:C.metadata)==null?void 0:A.createdByUser,quantity:x[n],percentage:R,fillColor:$()})}r({...s,asts:a,statsCreatedAtDatetimeByUser:f}),c(n=>({...n,statsAstsUsers:b,meterTypePerUserStats:k,anomalyPerUserStats:E}))},m=>{console.log("firestore err",m.message),j(m.message)})}}},te=()=>{const{filtersContext:t,setFiltersContext:s}=l.useContext(p),{geographicArea:r}=t==null?void 0:t.filterCondition,o=!r,c=i=>{console.log("e.currentTarget.value",i.currentTarget.value),s({...t,filterCondition:{...t.filterCondition,geographicArea:i.currentTarget.value}})};return e.jsx("div",{className:"filter-geographic-area",children:e.jsxs("select",{className:"fga-select",onChange:c,children:[e.jsx("option",{selected:o,value:"",children:"Select Filter"}),e.jsx("option",{value:"Ward1",children:"Ward 1"}),e.jsx("option",{value:"Ward2",children:"Ward 2"}),e.jsx("option",{value:"Ward3",children:"Ward 3"}),e.jsx("option",{value:"Ward4",children:"Ward 4"}),e.jsx("option",{value:"Custom Area 1",children:"Custom Area 1"}),e.jsx("option",{value:"Custom Area 2",children:"Custom Area 2"}),e.jsx("option",{value:"Custom Area 3",children:"Custom Area 3"}),e.jsx("option",{value:"Custom Area 4",children:"Custom Area 4"})]})})},se=()=>{const{filtersContext:t,setFiltersContext:s}=l.useContext(p),{astCreation:r}=t==null?void 0:t.filterCondition,o=!r,c=i=>{s({...t,filterCondition:{...t.filterCondition,astCreation:i.currentTarget.value}})};return e.jsx("div",{className:"filter-ast-creation-process",children:e.jsxs("select",{className:"fga-select",onChange:c,children:[e.jsx("option",{selected:o,value:"",children:"Select Filter"}),e.jsx("option",{value:"audit",children:"Audits"}),e.jsx("option",{value:"installation",children:"Installations"})]})})},re=()=>{const{filtersContext:t,setFiltersContext:s}=l.useContext(p),{astState:r}=t==null?void 0:t.filterCondition,o=!r,c=i=>{s({...t,filterCondition:{...t.filterCondition,astState:i.currentTarget.value}})};return e.jsx("div",{className:"filter-ast-state",children:e.jsxs("select",{className:"fas-select",onChange:c,children:[e.jsx("option",{selected:o,value:"",children:"Select Filter"}),e.jsx("option",{value:"stores",children:"Stores"}),e.jsx("option",{value:"checkedOutPending",children:"Checked Out Pending"}),e.jsx("option",{value:"checkedOut",children:"Checked Out"}),e.jsx("option",{value:"field",children:"Field"}),e.jsx("option",{value:"service",children:"Service"}),e.jsx("option",{value:"disconnected",children:"Disconnected"}),e.jsx("option",{value:"decommissioned",children:"Decommissioned"})]})})},ae=()=>{const{filtersContext:t,setFiltersContext:s}=l.useContext(p),{astMeterType:r}=t==null?void 0:t.filterCondition,o=!r,c=i=>{s({...t,filterCondition:{...t.filterCondition,astMeterType:i.currentTarget.value}})};return e.jsx("div",{className:"meter-type",children:e.jsxs("select",{className:"mt-select",onChange:c,children:[e.jsx("option",{selected:o,value:"",children:"Select Filter"}),e.jsx("option",{value:"pre-paid",children:"Pre-paid"}),e.jsx("option",{value:"conventional",children:"Conventional"})]})})},ne=()=>{const{getAsts:t}=ee("asts");return e.jsxs("div",{className:"filter-data-filter",children:[e.jsxs("div",{className:"filter-items",children:[e.jsx(h,{title:"Filter-CreatedAtDatetime",name:"dateRange",value:"created",children:e.jsx(J,{})}),e.jsx(h,{title:"Filter-UpdatedAtDatetime",name:"dateRange",value:"updated",children:e.jsx(L,{})}),e.jsx(h,{title:"Filter-Ast Creation",name:"astCreation",value:"astCreation",children:e.jsx(se,{})}),e.jsx(h,{title:"Filter-Meter Type",name:"astMeterType",value:"astMeterType",children:e.jsx(ae,{})}),e.jsx(h,{title:"Filter-Ast State",name:"astState",value:"astState",children:e.jsx(re,{})}),e.jsx(h,{title:"Filter-Geographic Area",name:"geographicArea",value:"geographicArea",children:e.jsx(te,{})})]}),e.jsx(Q,{getData:t})]})},oe=t=>{const{active:s,irepsKeyItem:r}=t;return e.jsxs("div",{className:"filters-body",children:[s==="reportFilters"?e.jsx(ne,{irepsKeyItem:r}):"",s==="reportStats"?e.jsx(Z,{irepsKeyItem:r}):""]})},xe=t=>{const{irepsKeyItem:s}=t,[r,o]=l.useState("reportFilters");return e.jsxs("div",{className:"filters",children:[e.jsx(V,{active:r,setActive:o,irepsKeyItem:s}),e.jsx(oe,{active:r,setActive:o,irepsKeyItem:s})]})};export{xe as default};
