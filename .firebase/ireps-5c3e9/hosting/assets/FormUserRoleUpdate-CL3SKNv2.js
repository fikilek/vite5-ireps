import{r as l,a5 as N,a7 as E,y as O,j as e,ab as R,ad as M,ae as P,af as G,ah as U,aq as v,aj as q,a8 as B,a9 as H}from"./index-CyIbrq5N.js";const J=[{key:"guest",value:"Guest",roleCode:"GST"},{key:"fieldworker",value:"Fieldworker",roleCode:"FWR"},{key:"supervisor",value:"Supervisor",roleCode:"SPV"},{key:"manager",value:"Manager",roleCode:"MNG"},{key:"superuser",value:"Superuser",roleCode:"SPU"}],T=(n,r)=>{const i=JSON.stringify(n),d=JSON.stringify(r),c=i===d;let t={guest:{old:"",new:"",change:""},fieldworker:{old:"",new:"",change:""},supervisor:{old:"",new:"",change:""},manager:{old:"",new:"",change:""},superuser:{old:"",new:"",change:""}};for(const o in t)t[o].old=r[o],t[o].new=n[o],n[o]===r[o]?t[o].change=!1:t[o].change=!0;return{objectsEqual:c,changeSet:t}},$=n=>{const{formData:r}=n,[i,d]=l.useState(""),{customClaims:c,setCustomClaims:t}=l.useContext(N),o=E(),[j,h]=l.useState(null),[m,g]=l.useState({}),[S,k]=l.useState({}),{closeModal:F}=O();l.useEffect(()=>{var s;g((s=r==null?void 0:r.customClaims)==null?void 0:s.roles)},[]),l.useEffect(()=>{const{changeSet:s}=T(m,c.roles);k(s)},[c.roles,m]);const b=s=>{h(a=>!0),B(o,"updateUserRole")({roles:s,uid:r.uid,changeSet:S}).then(a=>{t(C=>{var f,p,x;return{...C,roles:(x=(p=(f=a==null?void 0:a.data)==null?void 0:f.userRecord)==null?void 0:p.customClaims)==null?void 0:x.roles}}),H(`Roles for user "${r.displayName}", updated succesfully`,{position:"bottom-left",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),F(),h(C=>!a.data.userRecord)}).catch(a=>{console.log("error updating role: ",a.message),d(a.message),h(!1)})},w=s=>{let u={};for(const a in s)if(s[a])return u;return u.roles="User must have at least ONE role",u},y=s=>{g({...m,[s.target.value]:s.target.checked})};return e.jsx("div",{className:"form-wrapper",children:e.jsx("div",{className:"form-container user-role-update ",children:e.jsx(R,{initialValues:r.customClaims.roles,onSubmit:b,validate:w,enableReinitialize:!0,children:s=>e.jsx(e.Fragment,{children:e.jsxs(M,{onChange:y,children:[e.jsx(P,{hl1:"User Role Updater Form",hr1:`${r.displayName}`,children:e.jsx(G,{})}),e.jsxs("div",{className:"user-role-update",children:[e.jsx("div",{className:"uru uru-sub-heading",children:e.jsxs("p",{children:["The user has the existing roles shown below. Click on the checkbox to either add a new role or remove the existig role and submit. Roles rules apply","."]})}),e.jsx("div",{className:"uru check-btns",children:e.jsxs("div",{className:"user-roles",children:[e.jsx(U,{control:"checkbox",label:"",name:"roles",roles:J,claims:r.customClaims.roles}),s.errors.roles&&e.jsx(v,{errorMsg:s.errors.roles}),i&&e.jsx(v,{errorMsg:i})]})})]}),e.jsx(q,{formik:s,signState:{isPending:j}})]})})})})})};export{$ as default};
