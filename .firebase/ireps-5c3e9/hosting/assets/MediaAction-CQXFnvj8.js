import{aD as fe,r as s,aF as $,y as me,z as he,bb as ce,j as e,I as ge,bF as pe,bu as q,u as K,bt as G,Q as J,l as Q,a9 as k,bG as P,bH as F,bI as X,bJ as Y,a1 as Z,bK as te}from"./index-DTpsEHRa.js";var V=function(){return V=Object.assign||function(p){for(var c,x=1,f=arguments.length;x<f;x++){c=arguments[x];for(var m in c)Object.prototype.hasOwnProperty.call(c,m)&&(p[m]=c[m])}return p},V.apply(this,arguments)},ve=function(p,c){var x={};for(var f in p)Object.prototype.hasOwnProperty.call(p,f)&&c.indexOf(f)<0&&(x[f]=p[f]);if(p!=null&&typeof Object.getOwnPropertySymbols=="function")for(var m=0,f=Object.getOwnPropertySymbols(p);m<f.length;m++)c.indexOf(f[m])<0&&Object.prototype.propertyIsEnumerable.call(p,f[m])&&(x[f[m]]=p[f[m]]);return x},be=fe("ScaleLoader","0% {transform: scaley(1.0)} 50% {transform: scaley(0.4)} 100% {transform: scaley(1.0)}","scale");function re(p){var c=p.loading,x=c===void 0?!0:c,f=p.color,m=f===void 0?"#000000":f,v=p.speedMultiplier,i=v===void 0?1:v,r=p.cssOverride,l=r===void 0?{}:r,y=p.height,S=y===void 0?35:y,C=p.width,b=C===void 0?4:C,d=p.radius,t=d===void 0?2:d,a=p.margin,o=a===void 0?2:a,n=ve(p,["loading","color","speedMultiplier","cssOverride","height","width","radius","margin"]),w=V({display:"inherit"},l),h=function(g){return{backgroundColor:m,width:$(b),height:$(S),margin:$(o),borderRadius:$(t),display:"inline-block",animation:"".concat(be," ").concat(1/i,"s ").concat(g*.1,"s infinite cubic-bezier(0.2, 0.68, 0.18, 1.08)"),animationFillMode:"both"}};return x?s.createElement("span",V({style:w},n),s.createElement("span",{style:h(1)}),s.createElement("span",{style:h(2)}),s.createElement("span",{style:h(3)}),s.createElement("span",{style:h(4)}),s.createElement("span",{style:h(5)})):null}var de={exports:{}};(function(p,c){(function(f,m){p.exports=m(s)})(me,function(x){return function(f){var m={};function v(i){if(m[i])return m[i].exports;var r=m[i]={i,l:!1,exports:{}};return f[i].call(r.exports,r,r.exports,v),r.l=!0,r.exports}return v.m=f,v.c=m,v.d=function(i,r,l){v.o(i,r)||Object.defineProperty(i,r,{enumerable:!0,get:l})},v.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},v.t=function(i,r){if(r&1&&(i=v(i)),r&8||r&4&&typeof i=="object"&&i&&i.__esModule)return i;var l=Object.create(null);if(v.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:i}),r&2&&typeof i!="string")for(var y in i)v.d(l,y,(function(S){return i[S]}).bind(null,y));return l},v.n=function(i){var r=i&&i.__esModule?function(){return i.default}:function(){return i};return v.d(r,"a",r),r},v.o=function(i,r){return Object.prototype.hasOwnProperty.call(i,r)},v.p="",v(v.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(f,m,v){v.r(m);var i=v("react"),r=function(){var b=function(d,t){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,o){a.__proto__=o}||function(a,o){for(var n in o)o.hasOwnProperty(n)&&(a[n]=o[n])},b(d,t)};return function(d,t){b(d,t);function a(){this.constructor=d}d.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)}}(),l=function(){return l=Object.assign||function(b){for(var d,t=1,a=arguments.length;t<a;t++){d=arguments[t];for(var o in d)Object.prototype.hasOwnProperty.call(d,o)&&(b[o]=d[o])}return b},l.apply(this,arguments)},y=function(b,d){var t={};for(var a in b)Object.prototype.hasOwnProperty.call(b,a)&&d.indexOf(a)<0&&(t[a]=b[a]);if(b!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,a=Object.getOwnPropertySymbols(b);o<a.length;o++)d.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(b,a[o])&&(t[a[o]]=b[a[o]]);return t};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(d){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t?new Promise(function(a,o){t.call(navigator,d,a,o)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function S(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var C=function(b){r(d,b);function d(t){var a=b.call(this,t)||this;return a.canvas=null,a.ctx=null,a.requestUserMediaId=0,a.unmounted=!1,a.state={hasUserMedia:!1},a}return d.prototype.componentDidMount=function(){var t=this,a=t.state,o=t.props;if(this.unmounted=!1,!S()){o.onUserMediaError("getUserMedia not supported");return}a.hasUserMedia||this.requestUserMedia(),o.children&&typeof o.children!="function"&&console.warn("children must be a function")},d.prototype.componentDidUpdate=function(t){var a=this.props;if(!S()){a.onUserMediaError("getUserMedia not supported");return}var o=JSON.stringify(t.audioConstraints)!==JSON.stringify(a.audioConstraints),n=JSON.stringify(t.videoConstraints)!==JSON.stringify(a.videoConstraints),w=t.minScreenshotWidth!==a.minScreenshotWidth,h=t.minScreenshotHeight!==a.minScreenshotHeight;(n||w||h)&&(this.canvas=null,this.ctx=null),(o||n)&&(this.stopAndCleanup(),this.requestUserMedia())},d.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},d.stopMediaStream=function(t){t&&(t.getVideoTracks&&t.getAudioTracks?(t.getVideoTracks().map(function(a){t.removeTrack(a),a.stop()}),t.getAudioTracks().map(function(a){t.removeTrack(a),a.stop()})):t.stop())},d.prototype.stopAndCleanup=function(){var t=this.state;t.hasUserMedia&&(d.stopMediaStream(this.stream),t.src&&window.URL.revokeObjectURL(t.src))},d.prototype.getScreenshot=function(t){var a=this,o=a.state,n=a.props;if(!o.hasUserMedia)return null;var w=this.getCanvas(t);return w&&w.toDataURL(n.screenshotFormat,n.screenshotQuality)},d.prototype.getCanvas=function(t){var a=this,o=a.state,n=a.props;if(!this.video||!o.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var w=this.video.videoWidth,h=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var g=w/h;w=n.minScreenshotWidth||this.video.clientWidth,h=w/g,n.minScreenshotHeight&&h<n.minScreenshotHeight&&(h=n.minScreenshotHeight,w=h*g)}this.canvas=document.createElement("canvas"),this.canvas.width=(t==null?void 0:t.width)||w,this.canvas.height=(t==null?void 0:t.height)||h,this.ctx=this.canvas.getContext("2d")}var N=this,M=N.ctx,u=N.canvas;return M&&u&&(u.width=(t==null?void 0:t.width)||u.width,u.height=(t==null?void 0:t.height)||u.height,n.mirrored&&(M.translate(u.width,0),M.scale(-1,1)),M.imageSmoothingEnabled=n.imageSmoothing,M.drawImage(this.video,0,0,(t==null?void 0:t.width)||u.width,(t==null?void 0:t.height)||u.height),n.mirrored&&(M.scale(-1,1),M.translate(-u.width,0))),u},d.prototype.requestUserMedia=function(){var t=this,a=this.props,o=function(h,g){var N={video:typeof g<"u"?g:!0};a.audio&&(N.audio=typeof h<"u"?h:!0),t.requestUserMediaId++;var M=t.requestUserMediaId;navigator.mediaDevices.getUserMedia(N).then(function(u){t.unmounted||M!==t.requestUserMediaId?d.stopMediaStream(u):t.handleUserMedia(null,u)}).catch(function(u){t.handleUserMedia(u)})};if("mediaDevices"in navigator)o(a.audioConstraints,a.videoConstraints);else{var n=function(h){return{optional:[{sourceId:h}]}},w=function(h){var g=h.deviceId;return typeof g=="string"?g:Array.isArray(g)&&g.length>0?g[0]:typeof g=="object"&&g.ideal?g.ideal:null};MediaStreamTrack.getSources(function(h){var g=null,N=null;h.forEach(function(j){j.kind==="audio"?g=j.id:j.kind==="video"&&(N=j.id)});var M=w(a.audioConstraints);M&&(g=M);var u=w(a.videoConstraints);u&&(N=u),o(n(g),n(N))})}},d.prototype.handleUserMedia=function(t,a){var o=this.props;if(t||!a){this.setState({hasUserMedia:!1}),o.onUserMediaError(t);return}this.stream=a;try{this.video&&(this.video.srcObject=a),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(a)})}o.onUserMedia(a)},d.prototype.render=function(){var t=this,a=this,o=a.state,n=a.props,w=n.audio;n.forceScreenshotSourceSize;var h=n.disablePictureInPicture;n.onUserMedia,n.onUserMediaError,n.screenshotFormat,n.screenshotQuality,n.minScreenshotWidth,n.minScreenshotHeight,n.audioConstraints,n.videoConstraints,n.imageSmoothing;var g=n.mirrored,N=n.style,M=N===void 0?{}:N,u=n.children,j=y(n,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),E=g?l(l({},M),{transform:(M.transform||"")+" scaleX(-1)"}):M,D={getScreenshot:this.getScreenshot.bind(this)};return i.createElement(i.Fragment,null,i.createElement("video",l({autoPlay:!0,disablePictureInPicture:h,src:o.src,muted:!w,playsInline:!0,ref:function(B){t.video=B},style:E},j)),u&&u(D))},d.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},d}(i.Component);m.default=C},react:function(f,m){f.exports=x}}).default})})(de);var ye=de.exports;const le=he(ye),ue=()=>{function p(i){const r=new Image;return r.src=i,r}function c(i,r){let l=i.split("%2F").pop();return l=`${r}${l}`,`${i.split("%2F").slice(0,-1).join("%2F")}%2F${l}`}function x(i,r){let l=0,y=0,S=500,C=500;return i.naturalWidth>i.naturalHeight?i.naturalWidth>r&&(S=r,C=r*i.naturalHeight/i.naturalWidth):i.naturalHeight>r&&(C=r,S=r*i.naturalWidth/i.naturalHeight),console.log(l,y,S,C),[l,y,S,C]}function f(i,r){let l=0,y=0,S=r,C=r;return i.naturalWidth>i.naturalHeight?(S=r*i.naturalWidth/i.naturalHeight,l=-Math.abs(S-r)/2):(C=r*i.naturalHeight/i.naturalWidth,y=-Math.abs(C-r)/2),[l,y,S,C]}async function m(i){if(!i||!i.type.startsWith("image/"))throw new Error("Only images are accepted (jpeg, gif, png)");const r=new FileReader;return r.readAsDataURL(i),new Promise(l=>{r.onload=y=>{l(y.target.result)}})}function v(i,r,l=!1,y){const{mediaCategory:S,astNo:C,erfNo:b,createdAtDatetime:d,createdByUser:t,createdAtLocation:a}=y,o=document.createElement("canvas"),n=o.getContext("2d"),w=p(i),[h,g,N,M]=l?f(w,r):x(w,r);return o.width=l?r:N,o.height=l?r:M,n.drawImage(w,h,g,N,M),n.fillRect(10,10,420,260),n.fillStyle="white",n.font="30px sans-serif",n.fillText(ce.get(S),10,50),C&&n.fillText(`Ast No: ${C}`,10,250),b&&n.fillText(`Erf No: ${b}`,10,250),n.fillText(d,10,100),n.fillText(t,10,150),n.fillText(`(${Number(a==null?void 0:a.lat).toFixed(6).trim()}/${Number(a==null?void 0:a.lng).toFixed(6).trim()})`,10,200),new Promise(u=>{o.toBlob(j=>{u(j)},"image/jpeg")})}return{resizeImg:v,getBase64URL:m,prefixFileName:c}},ee=p=>{const{handleClose:c,color:x}=p,f=x||"#f2f";return e.jsx("div",{className:"window-close-btn",children:e.jsx("button",{onClick:c,className:"close-btn",children:e.jsx(ge.Provider,{value:{color:f},children:e.jsx(pe,{})})})})},xe=p=>{var I,R;const{data:c}=p,x={facingMode:{exact:"environment"}},{irepsKeyItem:f}=c;let m,v;f==="trns"&&(m="asts",v=c.data.astData.astId),f==="erfs"&&(m="erfs",v=c.data.id);const i=s.useRef(null),{uploadFile:r,url:l,error:y}=q(c),[S,C]=s.useState(null),[b,d]=s.useState(null),[t,a]=s.useState(null),[o,n]=s.useState({}),[w,h]=s.useState(x),{user:g}=K(),N=g==null?void 0:g.claims,{resizeImg:M,getBase64URL:u}=ue(),{mediaData:j,setMediaData:E}=s.useContext(G),{mediaCat:D,trnId:B}=j,{userLocation:O}=J(),A=s.useCallback(T=>{var ae,ie;const z=i.current.getScreenshot();C(we=>z);const L={mediaType:"image/jpeg",mediaCategory:D,createdByUser:g.displayName,createdByUid:g.uid,createdAtDatetime:Q(new Date,Z.dateFormat2),createdAtLocation:{lat:(ae=O==null?void 0:O.coordinates)==null?void 0:ae.lat,lng:(ie=O==null?void 0:O.coordinates)==null?void 0:ie.lng}};f==="erfs"?n({...L,erfId:c.data.id,erfNo:c.data.erfNo}):f==="trns"?n({...L,astId:c.data.astData.astId,astNo:c.data.astData.astNo,trnId:B}):console.log("throw error")},[c.erfNo,c.id,g.displayName,g.uid,(I=O==null?void 0:O.coordinates)==null?void 0:I.lat,(R=O==null?void 0:O.coordinates)==null?void 0:R.lng]),W=T=>{E({...j,activeMediaAction:null})};s.useEffect(()=>{M(S,1200,!0,o).then(T=>{S&&u(T).then(z=>{d(z)})})},[S,j,u,o,M]);const H=T=>{if(!o.createdAtLocation.lat)return k.error("Cannot upload without user Gps coordinates.",{position:"top-right"}),null;a(!0),r(b,m,v,o,"image")};s.useEffect(()=>((l||y)&&(a(!1),C(null),E({...j,activeMediaAction:null})),y&&k.error(`Storage Error : ${y}`,{position:"top-right"}),()=>{d(null)}),[l,y,j,E]);const U=()=>{C(""),d("")};s.useEffect(()=>()=>{h(x)},[]);const _=T=>{h({...w,facingMode:T.currentTarget.id==="front"?"user":{exact:"environment"}})};return e.jsxs("div",{className:"media-action-camera",children:[e.jsx("div",{className:"media-catergory",children:e.jsxs("p",{className:"media-cat",children:["Take ",ce.get(j.mediaCat)," Photo"]})}),b?e.jsx("div",{className:"macpp resized",children:b&&e.jsx(e.Fragment,{children:e.jsx("img",{className:"img-preview",width:150,height:150,src:b,alt:"resizedBase64URL"})})}):e.jsx("div",{className:"macpp original",children:e.jsx(le,{className:"webcam",width:400,height:400,ref:i,videoConstraints:w,screenshotFormat:"image/jpeg"})}),e.jsxs("div",{className:"mac mac-control-bar",children:[e.jsxs("div",{className:"maccb maccb-left",children:[!S&&e.jsx(P,{id:"",actionClassname:"",title:"click to take a photo",clickHanderFunction:A,actionIcon:F.ICON_CAMERA_SHOOT,color:"blue"}),S&&e.jsx(P,{id:"",actionClassname:"",title:"click to discard",clickHanderFunction:U,actionIcon:F.ICON_DELETE,color:"brown"}),e.jsxs(e.Fragment,{children:[e.jsx(P,{id:"selfie",actionClassname:"",title:"SELFIE photo",clickHanderFunction:_,actionIcon:F.ICON_CAMERA_SELFIE,color:"green"}),e.jsx(P,{id:"front",actionClassname:"",title:"FRONT photo",clickHanderFunction:_,actionIcon:F.ICON_CAMERA_FRONT2,color:"red"})]})]}),e.jsxs("div",{className:"maccb maccb-right",children:[b&&e.jsx(e.Fragment,{children:N.guest?"":e.jsx("button",{disabled:!S,className:"mab btn-submit-form",type:"button",onClick:H,children:t?e.jsx(X,{color:"#F86F03",loading:t<100,size:20,"aria-label":"Loading Spinner","data-testid":"loader"}):e.jsx(Y,{})})}),e.jsx(ee,{handleClose:W})]})]})]})},ne="audio/webm",je=p=>{const{data:c}=p,[x,f]=s.useState(!1),m=s.useRef(null),[v,i]=s.useState("inactive"),[r,l]=s.useState(null),[y,S]=s.useState([]),[C,b]=s.useState(null),[d,t]=s.useState(null),[a,o]=s.useState(null),{uploadFile:n,url:w,error:h}=q(c),[g,N]=s.useState({}),{user:M}=K(),{mediaData:u,setMediaData:j}=s.useContext(G),{userLocation:E}=J(),D=U=>{if(!g.createdAtLocation.lat)return k.error("Cannot upload without user Gps coordinates.",{position:"top-right"}),null;o(!0),n(d,c.irepsKeyItem,c.data.id,g,"audio")};s.useEffect(()=>((w||h)&&(o(!1),j({...u,activeMediaAction:null})),h&&k.error(`Storage Error : ${h}`,{position:"top-right"}),()=>{b(null)}),[w,h,u,j]);const B=U=>{console.log("discard"),b(null),t(null),S(null)},O=U=>{j({...u,activeMediaAction:null})},A=async()=>{if("MediaRecorder"in window)try{const U=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});f(!0),l(U)}catch(U){alert(U.message)}else alert("The MediaRecorder API is not supported in your browser.")},W=async()=>{i("recording");const U=new MediaRecorder(r,{type:"mime/mp4"});m.current=U,m.current.start();let _=[];m.current.ondataavailable=I=>{typeof I.data>"u"||I.data.size!==0&&_.push(I.data)},S(_)},H=()=>{i("inactive"),m.current.stop(),m.current.onstop=()=>{var I,R;const U=new Blob(y,{type:ne}),_=URL.createObjectURL(U);b(_),t(U),N({erfId:c.data.id,erfNo:c.data.erfNo,mediaType:ne,mediaCategory:"erfAudio",createdByUser:M.displayName,createdByUid:M.uid,createdAtDatetime:Q(new Date,Z.dateFormat2),createdAtLocation:{lat:(I=E==null?void 0:E.coordinates)==null?void 0:I.lat,lng:(R=E==null?void 0:E.coordinates)==null?void 0:R.lng}})}};return e.jsxs("div",{className:"media-action-voice",children:[e.jsxs("div",{className:"recording-status",children:[C&&v!=="recording"&&e.jsx("div",{className:"audio-player",children:e.jsx("audio",{src:C,controls:!0})}),v==="recording"&&e.jsxs(e.Fragment,{children:[e.jsx(re,{color:"#F86F03",loading:a<100,size:20,"aria-label":"Loading Spinner","data-testid":"loader"}),e.jsx(re,{color:"#F86F03",loading:a<100,size:20,"aria-label":"Loading Spinner","data-testid":"loader"})]})]}),e.jsxs("div",{className:"mac mac-control-bar",children:[e.jsxs("div",{className:"maccb maccb-left",children:[!x&&e.jsx(P,{id:"",actionClassname:"",title:"Get PERMISSION to record voice",clickHanderFunction:A,actionIcon:F.ICON_PERMISSION,color:"blue"}),C&&e.jsx(P,{id:"",actionClassname:"",title:"DISCARD recorded voice",clickHanderFunction:B,actionIcon:F.ICON_DELETE,color:"blue"}),!C&&x&&e.jsx(P,{id:"",actionClassname:"",title:"START vocie recording",clickHanderFunction:W,actionIcon:F.ICON_START_RECORDING,color:"blue"}),v==="recording"&&e.jsx(P,{id:"",actionClassname:"",title:"STOP voice recording",clickHanderFunction:H,actionIcon:F.ICON_STOP,color:"blue"})]}),e.jsxs("div",{className:"maccb maccb-right",children:[C&&e.jsx("button",{disabled:!C,className:"mab",type:"button",onClick:D,children:a?e.jsx(X,{color:"#F86F03",loading:a<100,size:20,"aria-label":"Loading Spinner","data-testid":"loader"}):e.jsx(Y,{})}),e.jsx(ee,{handleClose:O})]})]})]})},Me={facingMode:"user"},oe="video/webm",Se=p=>{var U,_;const{data:c}=p,x=s.useRef(null),f=s.useRef(null),[m,v]=s.useState(!1),[i,r]=s.useState([]),[l,y]=s.useState(null),[S,C]=s.useState(null),{uploadFile:b,url:d,error:t}=q(c),[a,o]=s.useState(null),[n,w]=s.useState({}),[h,g]=s.useState(Me),{user:N}=K(),{mediaData:M,setMediaData:u}=s.useContext(G),{userLocation:j}=J(),E=I=>{u({...M,activeMediaAction:null})},D=I=>{if(!n.createdAtLocation.lat)return k.error("Cannot upload without user Gps coordinates.",{position:"top-right"}),null;o(!0),b(S,c.irepsKeyItem,c.data.id,n,"video")};s.useEffect(()=>((d||t)&&(o(!1),y(null),r([]),u({...M,activeMediaAction:null})),t&&k.error(`Storage Error : ${t}`,{position:"top-right"}),()=>{y(null),r([])}),[d,t,M,u]);const B=I=>{y(null),r([])},O=I=>{console.log("e.currentTarget.id",I.currentTarget.id),g({...h,facingMode:I.currentTarget.id==="selfie"?"user":{exact:"environment"}})},A=s.useCallback(({data:I})=>{I.size>0&&r(R=>R.concat(I))},[r]),W=s.useCallback(()=>{var I;v(!0),f.current=new MediaRecorder((I=x==null?void 0:x.current)==null?void 0:I.stream,{mimeType:oe}),f.current.addEventListener("dataavailable",A),f.current.start()},[x,v,f,A]),H=s.useCallback(()=>{var I,R,T;(I=f==null?void 0:f.current)==null||I.stop(),v(!1),w({erfId:c.data.id,erfNo:c.data.erfNo,mediaType:oe,mediaCategory:"erfVideo",createdByUser:N.displayName,createdByUid:N.uid,createdAtDatetime:Q(new Date,Z.dateFormat2),createdAtLocation:{lat:(R=j==null?void 0:j.coordinates)==null?void 0:R.lat,lng:(T=j==null?void 0:j.coordinates)==null?void 0:T.lng}})},[f,v,c.erfNo,c.id,N.displayName,N.uid,(U=j==null?void 0:j.coordinates)==null?void 0:U.lat,(_=j==null?void 0:j.coordinates)==null?void 0:_.lng]);return s.useEffect(()=>{if(i.length>0){const I=new Blob(i,{type:"video/webm"}),R=URL.createObjectURL(I);y(R),C(I)}},[i]),e.jsxs("div",{className:"media-action-camera",children:[l?e.jsx("div",{className:"macpp ",children:e.jsx("video",{controls:!0,src:l,autoplay:!0})}):e.jsx("div",{className:"macpp original",children:e.jsx(le,{className:"webcam",width:400,height:400,ref:x,videoConstraints:h,screenshotFormat:"image/jpeg",video:"true",audio:"true"})}),e.jsxs("div",{className:"mac mac-control-bar",children:[e.jsxs("div",{className:"maccb maccb-left",children:[!m&&!l&&e.jsx(P,{id:"",actionClassname:"",title:"START recording",clickHanderFunction:W,actionIcon:F.ICON_VIDEO_RECORDING2,color:"blue"}),m&&e.jsx(P,{id:"",actionClassname:"",title:"STOP recording",clickHanderFunction:H,actionIcon:F.ICON_STOP,color:"brown"}),!l&&!m&&e.jsxs(e.Fragment,{children:[e.jsx(P,{id:"selfie",actionClassname:"",title:"SELFIE photo",clickHanderFunction:O,actionIcon:F.ICON_CAMERA_SELFIE,color:"green"}),e.jsx(P,{id:"front",actionClassname:"",title:"FRONT photo",clickHanderFunction:O,actionIcon:F.ICON_CAMERA_FRONT2,color:"orange"})]}),l&&e.jsx(P,{id:"discard",actionClassname:"",title:"DISCARD video",clickHanderFunction:B,actionIcon:F.ICON_DELETE,color:"red"})]}),e.jsxs("div",{className:"maccb maccb-right",children:[l&&e.jsx("button",{disabled:!l,className:"mab btn-submit-form",type:"button",onClick:D,children:a?e.jsx(X,{color:"#F86F03",loading:a<100,size:20,"aria-label":"Loading Spinner","data-testid":"loader"}):e.jsx(Y,{})}),e.jsx(ee,{handleClose:E})]})]})]})},se="/assets/place_holder1-BNACb7kD.png",Ce=p=>{const{data:c}=p,x=s.useRef(null),f=s.useRef(null),[m,v]=s.useState("resized"),i=O=>{v(O)},[r,l]=s.useState(null),[y,S]=s.useState(null),[C,b]=s.useState(null),[d,t]=s.useState({}),{uploadFile:a,url:o,error:n}=q(c),{user:w}=K(),{resizeImg:h,getBase64URL:g}=ue(),{mediaData:N,setMediaData:M}=s.useContext(G),{userLocation:u}=J(),j=O=>{var U,_,I,R;const A=O.target.files[0],W=["image/png","image/jpeg"];if(!A)return;if(!((U=u==null?void 0:u.coordinates)!=null&&U.lat)||!((_=u==null?void 0:u.coordinates)!=null&&_.lng)){k.error("User Gps Coordinates required when uploading an image",{position:"top-right"});return}if(!W.includes(A.type)){k.error("File must be of type jpeg or png",{position:"top-right"});return}const H=new FileReader;H.onload=T=>{var z,L;x.current.src=(z=T.target)==null?void 0:z.result,S((L=T.target)==null?void 0:L.result)},H.readAsDataURL(A),t({erfId:c.data.id,erfNo:c.data.erfNo,contentType:A==null?void 0:A.type,mediaType:A==null?void 0:A.type,mediaCategory:"erfPhoto",createdByUser:w.displayName,createdByUid:w.uid,createdAtDatetime:Q(new Date,Z.dateFormat2),createdAtLocation:{lat:(I=u==null?void 0:u.coordinates)==null?void 0:I.lat,lng:(R=u==null?void 0:u.coordinates)==null?void 0:R.lng}})};s.useEffect(()=>{h(y,1200,!0,d).then(O=>{y&&g(O).then(A=>{l(A)})})},[y,g,h,d]);const E=O=>{if(!d.createdAtLocation.lat)return k.error("Cannot upload without user Gps coordinates.",{position:"top-right"}),null;b(!0),a(r,c.irepsKeyItem,c.data.id,d,"image")};s.useEffect(()=>((o||n)&&(b(!1),M({...N,activeMediaAction:null})),n&&k.error(`Storage Error : ${n}`,{position:"top-right"}),()=>{l(null)}),[o,n,N,M]);const D=O=>{M({...N,activeMediaAction:null})},B=O=>{l(null),S(null),x.current.src="",x.current.alt="",f.current.src="",f.current.alt=""};return e.jsxs("div",{className:"media-action-gallery",children:[e.jsx("div",{className:"mag",children:e.jsxs("div",{className:"mag-wrapper",children:[e.jsxs("div",{className:"magw",children:[e.jsxs("div",{className:`magpp original ${m==="original"?"show":"hide"} `,children:[e.jsx("p",{children:"Original Picture"}),e.jsx("img",{className:"img-preview",ref:x,width:150,height:150,src:se,alt:"ireps pic"})]}),e.jsxs("div",{className:`magpp resized ${m==="resized"?"show":"hide"}`,children:[e.jsx("p",{children:"Resized Picture"}),e.jsx("img",{ref:f,className:"img-preview",width:150,height:150,src:r||se,alt:"resizedBase64URL"})]})]}),e.jsxs("div",{className:"mmb-btns",children:[y&&e.jsx(te,{selectWindow:B,mmbIcon:F.ICON_DISCARD,color:"",label:"discard",title:"DISCARD Image / Reset"}),y&&e.jsx(te,{selectWindow:i,mmbIcon:F.ICON_IMAGE1,color:"",label:"original",title:"View Original Image"}),r&&e.jsx(te,{selectWindow:i,mmbIcon:F.ICON_IMAGE2,color:"",label:"resized",title:"View Resized Image"})]})]})}),e.jsxs("div",{className:"mag mac-control-bar",children:[e.jsx("div",{className:"magcb magcb-left",children:e.jsx("form",{children:e.jsx("input",{type:"file",accept:"image/*",onChange:j})})}),e.jsxs("div",{className:"magcb magcb-right",children:[r&&e.jsx(e.Fragment,{children:e.jsx("button",{disabled:!r,className:"mab btn-submit-form",type:"button",onClick:E,children:C?e.jsx(X,{color:"#F86F03",loading:C<100,size:20,"aria-label":"Loading Spinner","data-testid":"loader"}):e.jsx(Y,{})})}),e.jsx(ee,{handleClose:D})]})]})]})},Ne=p=>{const{mediaData:c}=s.useContext(G);return e.jsxs("div",{className:`media-action ${c.activeMediaAction?"showMediaAction":"hideMediaAction"}  `,children:[c.activeMediaAction==="camera"&&e.jsx(xe,{data:p.data}),c.activeMediaAction==="voice"&&e.jsx(je,{data:p.data}),c.activeMediaAction==="video"&&e.jsx(Se,{data:p.data}),c.activeMediaAction==="gallery"&&e.jsx(Ce,{data:p.data})]})};export{Ne as default};
