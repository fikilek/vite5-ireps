import{r as p,u as L,j as e,F as V,A as W,p as U,a5 as k,i as T,g as S}from"./index-DsAPZw0f.js";import{M as N,C as A,A as I,T as X}from"./ag-theme-quartz-DQ9Lll7L.js";import{l as Y}from"./useErfs-DJZe50Dm.js";import{A as O,T as z,C as $,a as B,S as M,R}from"./Report-Csq5VTzY.js";import"./useTrns-Dq2tKmwC.js";try{let a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new a.Error().stack;t&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[t]="5f77e0a5-ac0d-46a0-8906-479d00cb698d",a._sentryDebugIdIdentifier="sentry-dbid-5f77e0a5-ac0d-46a0-8906-479d00cb698d")}catch{}N.registerModules([A]);const Z=a=>{const{rowData:t,colDefs:r,tableRef:c}=a,i=p.useRef(),{user:s}=L(),m=s==null?void 0:s.email,u=s==null?void 0:s.displayName,d=p.useMemo(()=>({sortable:!0,filter:!0,resizable:!0,floatingFilter:!0,suppressMovable:!0}),[]),y=o=>o.data.id,n=async o=>{i.current=o.api},l=()=>{m==="fikilekentane@gmail.com"||m==="zamo@rsteutilities.com"||m==="sbu@isandisoipe.co.za"||i.current.setColumnFilterModel("metadata.createdByUser",{filterType:"text",type:"contains",filter:u}),i.current.onFilterChanged()},x={"delete-pending":o=>{var h;return((h=o==null?void 0:o.data)==null?void 0:h.deleteAst)==="deletePending"}};return e.jsx("div",{className:"ag-theme-quartz table table-asts",children:e.jsx(I,{rowData:t,columnDefs:r,defaultColDef:d,pagination:!0,noRowsOverlayComponent:X,getRowId:y,reactiveCustomComponents:!0,onGridReady:n,onFirstDataRendered:l,ref:c,rowClassRules:x})})},ee=({asts:a,astsTableFields:t,tableRef:r})=>e.jsx("div",{className:"asts-table table",children:e.jsx(Z,{rowData:a,colDefs:t,tableRef:r})}),K=a=>{var h,b,j,D,w,E;const t=a==null?void 0:a.stats,r=t==null?void 0:t.total,{filtersContext:c}=p.useContext(V),{createdAtDatetimeRange:i,updatedAtDatetimeRange:s,filterCondition:m}=c,{astsContext:u}=p.useContext(W),d=!(i[0]==null||i[0]==null||i[1]==null||i[1]==null),y=!(s[0]==null||s[0]==null||s[1]==null||s[1]==null);let n=[];if(d||y)d&&(n=i),y&&(n=s);else{const v=u==null?void 0:u.asts;if(!v)return;(b=(h=v==null?void 0:v[0])==null?void 0:h.metadata)==null||b.createdAtDatetime;const f=Y.cloneDeep(v);f==null||f.sort((_,H)=>{var F,G,q,P;const Q=(G=(F=_.metadata)==null?void 0:F.createdAtDatetime)==null?void 0:G.toMillis(),J=(P=(q=H.metadata)==null?void 0:q.createdAtDatetime)==null?void 0:P.toMillis();return Q-J});const C=(D=(j=f==null?void 0:f[0])==null?void 0:j.metadata)==null?void 0:D.createdAtDatetime,g=(E=(w=f==null?void 0:f[(f==null?void 0:f.length)-1])==null?void 0:w.metadata)==null?void 0:E.createdAtDatetime;n=[C==null?void 0:C.toDate(),g==null?void 0:g.toDate()]}const l=n==null?void 0:n[0],x=n==null?void 0:n[1];U(new Date(l||0),k.dateFormat3),U(new Date(x||0),k.dateFormat3);const{title:o}=a;return e.jsxs("div",{className:"report-heading",children:[e.jsxs("div",{className:"rh rh-left",children:[e.jsx("p",{className:"rhl rh-element rhll",children:o}),e.jsx("p",{className:"rhr rh-element rhlr"})]}),e.jsxs("div",{className:"rh rh-right",children:[e.jsx("p",{className:"rhr rh-element rhrl"}),e.jsxs("p",{className:"rhr rh-element rhrr",children:["Total: ",r]})]})]})};N.registerModules([A]);const te=a=>{const{rowData:t,colDefs:r}=a;return e.jsx("div",{className:"ag-theme-quartz table table-trns",children:e.jsx(I,{rowData:t,columnDefs:r})})},ae=a=>{const{data:t}=a,r=[{field:"uid",headerName:"System Id",hide:!0},{field:"displayName",headerName:"User Name",flex:.5},{field:"quantity",headerName:"Quantities",flex:.3},{field:"percentage",headerName:"%",flex:.2}];return e.jsx("div",{className:"report-asts-users-table",children:e.jsx(te,{rowData:t,colDefs:r})})},se=a=>{const{data:t}=a,[r,c]=p.useState({data:t,series:[{type:"bar",xKey:"displayName",yKey:"quantity",itemStyler:i=>({fill:i.datum.fillColor})}],title:{text:"Meters Created Per Fieldworker"}});return p.useEffect(()=>{c({...r,data:t})},[t]),e.jsx("div",{className:"report-asts-users-barchart",children:e.jsx(O,{options:r})})},re=()=>{const{astsStatsContext:a}=p.useContext(T),t=a==null?void 0:a.statsAstsUsers;return e.jsxs("div",{className:"report-asts-users",children:[e.jsx(K,{title:"Users Stats",stats:t}),e.jsxs("div",{className:"rau-body",children:[e.jsx(ae,{data:t==null?void 0:t.stats}),e.jsx(se,{data:t==null?void 0:t.stats})]})]})},le=a=>{const{stats:t,tableRef:r}=a;let c=[{field:"anomalyName",headerName:"Anomaly - Anomaly Detail",width:"220"}],i=[];return t==null||t.forEach(s=>{const m=s.anomalyDetailStatsArray;m==null||m.forEach(u=>{const d=u.updatedUserStats,y=`${s.anomalyName}-${u.anomalyDetailName}`;let n={};d==null||d.forEach(l=>{n[l.uid]={user:l},c.some(o=>{var h;return((h=o==null?void 0:o.valueGetterParam)==null?void 0:h.uid)===l.uid})||c.push({field:`userObj.${l.uid}.user.quantity`,headerName:S(l.displayName),width:"58",headerTooltip:l.displayName,valueGetter:o=>{var b,j,D;const h=(D=(j=(b=o.data)==null?void 0:b.userObj[l==null?void 0:l.uid])==null?void 0:j.user)==null?void 0:D.quantity;return h||0},valueGetterParams:{uid:l.uid}})}),i.push({anomalyName:y,anomalyDetailStats:u.anomalyDetailStats,userObj:n})})}),c.push({field:"anomalyDetailStats",headerName:"Total",width:"100",cellRenderer:s=>s.value?s.value:0}),e.jsx("div",{className:"stats-combo-table-anomalies",children:e.jsx(z,{rowData:i,colDefs:c,tableRef:r})})};N.registerModules([A]);N.registerModules([$]);const ne=()=>{const{astsStatsContext:a}=p.useContext(T),t=p.useRef(),{anomalyPerUserStats:r}=a,c=m=>{t.current.api.exportDataAsCsv()},i="Anomaly Summary",s={hl1:"hl1",hl2:"",hr1:" ",hr2:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:c,className:"stats-btn stats-btn-export",children:"Export"})," ",e.jsx("button",{className:"stats-btn stats-btn-pdf",children:"Pdf"})]})};return e.jsxs("div",{className:"report-asts-anomalies",children:[e.jsx(K,{title:"Meters Anomalies Per User Stats",stats:r}),e.jsx("div",{className:"raa-body",children:e.jsx(B,{statsName:"Anomaly Summary",children:e.jsx(M,{statsName:i,stats:r,headerData:s,children:e.jsx(le,{stats:r==null?void 0:r.stats,tableRef:t})})})})]})},oe=a=>{const{stats:t,tableRef:r}=a;let c=[{field:"meterTypeName",headerName:"Meter Type",width:"110"}],i=[];return t==null||t.forEach(s=>{var u;let m={};(u=s==null?void 0:s.stats)==null||u.forEach(d=>{const y=c.some(n=>{var l;return((l=n==null?void 0:n.valueGetterParam)==null?void 0:l.uid)===d.uid});m[d.uid]={user:d},y||c.push({field:`users.${d.uid}.user.quantity`,headerName:S(d.displayName),width:"58",headerTooltip:d.displayName,valueGetter:n=>{var x,o,h;const l=(h=(o=(x=n.data)==null?void 0:x.users[d==null?void 0:d.uid])==null?void 0:o.user)==null?void 0:h.quantity;return l||0},valueGetterParam:{uid:d.uid}})}),i.push({meterTypeName:s.meterTypeName,total:s.total,users:m})}),c.push({field:"total",headerName:"Total",width:"100",cellRenderer:s=>s.value?s.value:0}),e.jsx("div",{className:"stats-combo-table-meter-type",children:e.jsx(z,{rowData:i,colDefs:c,tableRef:r})})},ie=a=>{const{userData:t,barChartSeries:r}=a==null?void 0:a.stats,c={title:{text:"Meter Type Per User"},subtitle:{text:"Pre-paid/Conventional"},data:t,series:r};return e.jsx("div",{className:"stats-combo-bar-chart",children:e.jsx(O,{options:c})})};N.registerModules([A]);N.registerModules([$]);const de=()=>{const{astsStatsContext:a}=p.useContext(T),t=p.useRef(),{meterTypePerUserStats:r,anomaliesStats:c}=a,i=[];let s=[];r==null||r.forEach(n=>{var x;let l={meterTypeName:n.meterTypeName};(x=n==null?void 0:n.stats)==null||x.forEach(o=>{if(!i.some(b=>b.uid===o.uid)){const b={type:"bar",xKey:"meterTypeName",yKey:o.uid,yName:S(o.displayName),uid:o.uid};i.push(b)}l={...l,[o.uid]:o.quantity}}),s.push(l)});const m={userData:s,barChartSeries:i},u="Meter Type Summary",d=n=>{var l,x;(x=(l=t.current)==null?void 0:l.api)==null||x.exportDataAsCsv()},y={hl1:"hl1",hl2:"",hr1:" ",hr2:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:d,className:"stats-btn stats-btn-export",children:"Export"})," ",e.jsx("button",{className:"stats-btn stats-btn-pdf",children:"Pdf"})]})};return e.jsx("div",{className:"report-asts-meter-type",children:e.jsx("div",{className:"ramt-body",children:e.jsxs(B,{statsName:"Meter Type Summary",children:[e.jsx(M,{statsName:`${u}`,stats:m,headerData:y,children:e.jsx(oe,{stats:r,tableRef:t})}),e.jsx(M,{statsName:`${u} Bar Chart`,stats:m,headerData:y,children:e.jsx(ie,{stats:m})})]})})})},fe=({asts:a,astsTableFields:t,tableRef:r})=>e.jsxs("div",{className:"asts-main",children:[e.jsx(ee,{asts:a,astsTableFields:t,tableRef:r}),e.jsx(R,{reportName:"users",children:e.jsx(re,{})}),e.jsx(R,{reportName:"anomalies",children:e.jsx(ne,{})}),e.jsx(R,{reportName:"meterType",children:e.jsx(de,{})})]});export{fe as default};
//# sourceMappingURL=AstsMain-DVfqy-sN.js.map
