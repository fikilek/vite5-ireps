import{h as H,r as G,A as de,i as ne,u as se,w as ee,q as re,e as oe,o as le,c as ie,d as ce,f as me,j as g,k as O,l as te,m as ae,n as k,I as ue,p as he}from"./index-CTrsszhs.js";import{u as fe}from"./useTrns-B_NpY6rq.js";import{T as ye}from"./useErfs-Do9Wfvlc.js";try{let y=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},M=new y.Error().stack;M&&(y._sentryDebugIds=y._sentryDebugIds||{},y._sentryDebugIds[M]="3c57492f-221f-459c-a6af-4495c3739b06",y._sentryDebugIdIdentifier="sentry-dbid-3c57492f-221f-459c-a6af-4495c3739b06")}catch{}const pe=()=>({getAstsUsersStats:t=>{var r;const d={};t==null||t.forEach(a=>{d[a.metadata.createdByUid]=1+(d[a.metadata.createdByUid]||0)});const e=[];for(const a in d){const n=t==null?void 0:t.find(l=>{var m;return((m=l==null?void 0:l.metadata)==null?void 0:m.createdByUid)===a}),u=(d[a]/(t==null?void 0:t.length)*100).toFixed(2);e.push({uid:a,displayName:(r=n==null?void 0:n.metadata)==null?void 0:r.createdByUser,quantity:d[a],percentage:u,fillColor:H()})}return{stats:e,total:t==null?void 0:t.length}},getMeterTypePerUserStats:t=>{var l,m;const d=t.filter(o=>o.astData.meter.type==="pre-paid"),e={};d==null||d.forEach(o=>{e[o.metadata.createdByUid]=1+(e[o.metadata.createdByUid]||0)});const r=[];for(const o in e){const p=d==null?void 0:d.find(s=>{var c;return((c=s==null?void 0:s.metadata)==null?void 0:c.createdByUid)===o}),i=(e[o]/(d==null?void 0:d.length)*100).toFixed(2);r.push({uid:o,displayName:(l=p==null?void 0:p.metadata)==null?void 0:l.createdByUser,quantity:e[o],percentage:i,fillColor:H()})}const a=t.filter(o=>o.astData.meter.type==="conventional"),n={};a==null||a.forEach(o=>{n[o.metadata.createdByUid]=1+(n[o.metadata.createdByUid]||0)});const u=[];for(const o in n){const p=a==null?void 0:a.find(s=>{var c;return((c=s==null?void 0:s.metadata)==null?void 0:c.createdByUid)===o}),i=(n[o]/(a==null?void 0:a.length)*100).toFixed(2);u.push({uid:o,displayName:(m=p==null?void 0:p.metadata)==null?void 0:m.createdByUser,quantity:n[o],percentage:i,fillColor:H()})}return[{meterTypeName:"pre-paid",stats:r,total:d==null?void 0:d.length},{meterTypeName:"conventional",stats:u,total:a.length}]},getAnomalyPerUserStats:t=>{const d={};t==null||t.forEach(a=>{var n,u;d[(n=a==null?void 0:a.anomalies)==null?void 0:n.anomaly]=1+(d[(u=a==null?void 0:a.anomalies)==null?void 0:u.anomaly]||0)});const e=Object.entries(d);let r=[];return e==null||e.forEach(a=>{var p;const n=a[0],u=a[1],l=t==null?void 0:t.filter(i=>{var s;return((s=i==null?void 0:i.anomalies)==null?void 0:s.anomaly)===n}),m={};l==null||l.forEach(i=>{var s,c;m[(s=i==null?void 0:i.anomalies)==null?void 0:s.anomalyDetail]=1+(m[(c=i==null?void 0:i.anomalies)==null?void 0:c.anomalyDetail]||0)});const o=[];for(const i in m){const s=t==null?void 0:t.filter(h=>{var f;return((f=h==null?void 0:h.anomalies)==null?void 0:f.anomalyDetail)===i}),c={};s==null||s.forEach(h=>{c[h.metadata.createdByUid]=1+(c[h.metadata.createdByUid]||0)});const N=[];for(const h in c){const f=s==null?void 0:s.find(D=>{var U;return((U=D==null?void 0:D.metadata)==null?void 0:U.createdByUid)===h}),S=(c[h]/(t==null?void 0:t.length)*100).toFixed(2);N.push({uid:h,displayName:(p=f==null?void 0:f.metadata)==null?void 0:p.createdByUser,quantity:c[h],percentage:S,fillColor:H()})}o.push({anomalyDetailName:i,anomalyDetailStats:s.length,updatedUserStats:N})}r.push({anomalyName:n,anomalyStats:u,anomalyDetailStatsArray:o})}),{stats:r,total:t.length}}}),Se=y=>{const{astsContext:M,setAstsContext:B}=G.useContext(de),{astsStatsContext:t,setAstsStatsContext:d}=G.useContext(ne),[e,r]=G.useState([]),[a,n]=G.useState(""),{getDocument:u}=fe("users"),{user:l}=se(),{getAstsUsersStats:m,getMeterTypePerUserStats:o,getAnomalyPerUserStats:p}=pe(),i=l==null?void 0:l.uid;return G.useEffect(()=>{u(i).then(s=>{const{workbase:c}=s==null?void 0:s.doc,N=ee("erf.address.lmMetro","==",c);if(!N)return;const h=re(ie(ce,y),le(N,ee("astData.astState.state","==","stores")),oe("metadata.updatedAtDatetime","desc"));n("");try{me(h,f=>{const S=[];f.docs.forEach(C=>{S.push({id:C.id,...C.data()})}),r(S);const D=m(S),U=o(S),b=p(S);B({...M,asts:S}),d(C=>({...C,statsAstsUsers:D,meterTypePerUserStats:U,anomalyPerUserStats:b}))},f=>{console.log("firestore err",f.message),n(f.message)}),n("")}catch(f){console.log("Error on useGetAstsCollection - getDocument",f.message)}})},[]),{asts:e,error:a}},Ne=y=>{const M=B=>{console.log("e",B)};return g.jsx("div",{className:"table-delete-ast-btn",children:g.jsx("button",{className:"tdab-btn",onClick:M,style:{},title:"Delete Ast",disabled:!1,children:g.jsx("p",{children:"X"})})})},x=(y,M)=>{const B=y==null?void 0:y.find(d=>(d==null?void 0:d.mediaCategory)===M);return B==null?void 0:B.url},Ue=()=>{G.useContext(de);const{error:y}=Se("asts");return{astsTableFields:[{field:"id",headerName:"System Id",width:200,hide:!0},{headerName:"Created",children:[{field:"metadata.createdByUser",columnGroupShow:"open",headerName:"Created By",width:150,hide:!1},{field:"metadata.createdByUser",columnGroupShow:"closed",headerName:"Created By",width:150,hide:!1},{field:"metadata.createdAtDatetime",columnGroupShow:"open",headerName:"Date Created",width:160,cellRenderer:t=>{var r,a;const d=new O((r=t==null?void 0:t.value)==null?void 0:r.seconds,(a=t==null?void 0:t.value)==null?void 0:a.nanoseconds),e=d==null?void 0:d.toDate();return g.jsx(ae,{date:e,dateFormat:"yyyy-MMM-dd HH:mm"})},valueGetter:t=>{var d,e;return(e=(d=t.data)==null?void 0:d.metadata)==null?void 0:e.createdAtDatetime},hide:!1}]},{headerName:"Last Updated",children:[{field:"metadata.updatedByUser",columnGroupShow:"open",headerName:"Updated By",width:150,hide:!1},{field:"metadata.updatedByUser",columnGroupShow:"closed",headerName:"Updated By",width:150,hide:!1},{field:"metadata.updatedAtDatetime",columnGroupShow:"open",headerName:"Date Updated",width:160,cellRenderer:t=>{const e=new O(t.value.seconds,t.value.nanoseconds).toDate();return g.jsx(ae,{date:e,dateFormat:"yyyy-MMM-dd HH:mm"})},valueGetter:t=>t.data.metadata.updatedAtDatetime,hide:!1},{field:"",columnGroupShow:"open",headerName:"Delete",width:100,cellRenderer:t=>g.jsx(Ne,{data:t})}]},{field:"erf.erfNo",headerName:"Erf No",width:100,tooltipField:"Erf the ast belong to",hide:!1},{field:"erf.address.ward",headerName:"Ward",width:100},{headerName:"Meter Description",children:[{field:"astData.astNo",headerName:"Meter No",width:170,columnGroupShow:"closed",cellRenderer:t=>g.jsx(k,{data:t,children:t.value}),cellRendererParams:{modalName:"meterReport",width:"8rem",irepsKeyItem:"asts",displayMode:"modal"},hide:!1},{field:"astData.astCatergory",headerName:"Category",columnGroupShow:"closed",width:150,hide:!0},{field:"astData.astManufacturer",headerName:"Manufacturer (Brand)",columnGroupShow:"closed",width:200,hide:!1},{field:"astData.astName",headerName:"Model Name",columnGroupShow:"closed",width:150,hide:!1}]},{field:"",headerName:"Meter Media",width:150,cellRenderer:t=>g.jsx(k,{data:t,children:t.value}),cellRendererParams:{modalName:"mediaMobileAsts",width:"4rem",irepsKeyItem:"asts",displayMode:"modal"},valueGetter:t=>{var e,r,a,n;return(r=(e=t==null?void 0:t.data)==null?void 0:e.media)!=null&&r.length?(n=(a=t==null?void 0:t.data)==null?void 0:a.media)==null?void 0:n.length:0}},{field:"trns",headerName:"Trns On Meter",width:130,cellRenderer:ye,cellRendererParams:{columnName:"tidTrn"},hide:!1,valueGetter:t=>t.data,filter:!1},{field:"location.gps",columnGroupShow:"closed",headerName:"Meter on Map",cellRenderer:t=>g.jsx(k,{data:t,children:g.jsx(ue.Provider,{value:{color:"blue",fontSize:"1rem"},children:g.jsx(he,{})})}),cellRendererParams:{modalName:"showAstOnMap",width:"3rem"},valueGetter:t=>{var r,a,n,u,l,m;const d=Number((n=(a=(r=t.data)==null?void 0:r.location)==null?void 0:a.gps)==null?void 0:n.lat),e=Number((m=(l=(u=t.data)==null?void 0:u.location)==null?void 0:l.gps)==null?void 0:m.lng);return`${d.toFixed(3)} / ${e.toFixed(3)}`},width:140,filter:!1},{field:"astData.astState.state",headerName:"Meter State",width:250,valueGetter:t=>{var e,r,a,n,u,l,m,o,p,i,s,c,N,h,f,S,D,U,b,C,T,v,R,A,E,j,F,I,$,P;let d="";return((e=t.data)==null?void 0:e.astData.astState.state)==="stores"&&(d=`${(n=(a=(r=t.data)==null?void 0:r.astData)==null?void 0:a.astState)==null?void 0:n.state} : ${(m=(l=(u=t.data)==null?void 0:u.astData)==null?void 0:l.astState)==null?void 0:m.location}`),((o=t.data)==null?void 0:o.astData.astState.state)==="service"&&(d=`service : ${(s=(i=(p=t.data)==null?void 0:p.erf)==null?void 0:i.address)==null?void 0:s.lmMetro} - ${(c=t.data)==null?void 0:c.erf.erfNo}`),((f=(h=(N=t.data)==null?void 0:N.astData)==null?void 0:h.astState)==null?void 0:f.state)==="temper"&&(d=`temper : ${(S=t.data)==null?void 0:S.erf.address.lmMetro} - ${(D=t.data)==null?void 0:D.erf.erfNo}`),(((C=(b=(U=t.data)==null?void 0:U.astData)==null?void 0:b.astState)==null?void 0:C.state)==""||((R=(v=(T=t.data)==null?void 0:T.astData)==null?void 0:v.astState)==null?void 0:R.state)==null||((j=(E=(A=t.data)==null?void 0:A.astData)==null?void 0:E.astState)==null?void 0:j.state)==null)&&(d=`service : ${($=(I=(F=t.data)==null?void 0:F.erf)==null?void 0:I.address)==null?void 0:$.lmMetro} - ${(P=t.data)==null?void 0:P.erf.erfNo}`),d}},{field:"metadata.createdThrough.creatorTrnName",headerName:"Meter Creator",width:140},{headerName:"Meter Specific Data",children:[{field:"astData.meter.type",headerName:"Meter Type",width:150,hide:!1},{field:"astData.meter.phase",headerName:"Meter Phase",width:150,hide:!1}]},{headerName:"Anomalies",children:[{field:"anomalies.anomaly",headerName:"Anomaly",width:200},{field:"anomalies.anomalyDetail",columnGroupShow:"open",headerName:"Anomaly Detail",width:300}]},{headerName:"Meter Location",children:[{field:"location.address",columnGroupShow:"closed",headerName:"Ast Address",width:450},{field:"location.placement",columnGroupShow:"closed",headerName:"Placement",width:190}]},{headerName:"Circuit Breaker (CB)",children:[{field:"astData.meter.cb.size",columnGroupShow:"open",headerName:"CB (Amps)",width:150},{field:"astData.meter.cb.comment",columnGroupShow:"open",headerName:"CB Comment",width:300}]},{headerName:"Seal",children:[{field:"astData.meter.seal.sealNo",columnGroupShow:"open",headerName:"Seal No",width:150},{field:"astData.meter.seal.comment",columnGroupShow:"open",headerName:"Seal Comment",width:300}]},{field:"serviceConnection.configuration",headerName:"Service Connection",width:300},{field:"serviceConnection.offGridSupply",headerName:"Off Grid Supply",width:300},{field:"tid.status",headerName:"Tid Status",width:300},{field:"tid.statusComment",headerName:"Tid Status Comment",width:300}],createExportRowData:t=>(t==null?void 0:t.length)<1?void 0:t&&(t==null?void 0:t.map(e=>{var i,s,c,N,h,f,S,D,U,b,C,T,v,R,A,E,j,F,I,$,P,q,_,z,L,K,W,X,J,Q,V,Y,Z,w;const r=e==null?void 0:e.media,a=e.metadata.createdAtDatetime,n=new O(a==null?void 0:a.seconds,a==null?void 0:a.nanoseconds),u=n==null?void 0:n.toDate(),l=e.metadata.updatedAtDatetime,m=new O(l==null?void 0:l.seconds,l==null?void 0:l.nanoseconds),o=m==null?void 0:m.toDate();return{id:e.id,"Created By":e.metadata.createdByUser,"Created At":te(u,"yy-MM-dd HH:mm"),"Last Updated By":e.metadata.updatedByUser,"Last Updated At Datetime":te(o,"yy-MM-dd HH:mm"),"Meter No":(i=e==null?void 0:e.astData)==null?void 0:i.astNo,"Meter No picture":x(r,"astNo"),"Meter Manufacturer":(s=e==null?void 0:e.astData)==null?void 0:s.astManufacturer,"Meter Name":(c=e==null?void 0:e.astData)==null?void 0:c.astName,"Meter Type":(h=(N=e==null?void 0:e.astData)==null?void 0:N.meter)==null?void 0:h.type,"Meter Phase":(S=(f=e==null?void 0:e.astData)==null?void 0:f.meter)==null?void 0:S.phase,"CB Size":(b=(U=(D=e==null?void 0:e.astData)==null?void 0:D.meter)==null?void 0:U.cb)==null?void 0:b.size,"CB picture":x(r,"cb"),"CB Comment":(v=(T=(C=e==null?void 0:e.astData)==null?void 0:C.meter)==null?void 0:T.cb)==null?void 0:v.comment,"Seal Number":(E=(A=(R=e==null?void 0:e.astData)==null?void 0:R.meter)==null?void 0:A.seal)==null?void 0:E.sealNo,"Seal Number picture":x(r,"seal"),"Seal Comment":(I=(F=(j=e==null?void 0:e.astData)==null?void 0:j.meter)==null?void 0:F.seal)==null?void 0:I.comment,Anomaly:($=e==null?void 0:e.anomalies)==null?void 0:$.anomaly,"Anomaly picture":x(r,"anomaly"),"Anomaly Detail":(P=e==null?void 0:e.anomalies)==null?void 0:P.anomalyDetail,"Erf No":(q=e==null?void 0:e.erf)==null?void 0:q.erfNo,"Street Adr":(_=e==null?void 0:e.erf)==null?void 0:_.street,"Property Type":(L=(z=e==null?void 0:e.erf)==null?void 0:z.propertyType)==null?void 0:L.type,"Unit Name":(W=(K=e==null?void 0:e.erf)==null?void 0:K.propertyType)==null?void 0:W.unitName,"Unit No":(J=(X=e==null?void 0:e.erf)==null?void 0:X.propertyType)==null?void 0:J.unitNo,"Meter Placement":(Q=e==null?void 0:e.location)==null?void 0:Q.placement,"Meter Placement picture":x(r,"insideBox"),"Meter Address":(V=e==null?void 0:e.location)==null?void 0:V.address,"Service Connection Status":(Y=e==null?void 0:e.serviceConnection)==null?void 0:Y.configuration,"Off Grid Supply":(Z=e==null?void 0:e.serviceConnection)==null?void 0:Z.offGridSupply,"Off Grid picture":x(r,"offGridPhoto"),"TID Status":(w=e==null?void 0:e.tidStatus)==null?void 0:w.status,"TID Status picture":x(r,"tidStatus")}})),error:y}};export{pe as a,Ue as u};
//# sourceMappingURL=useAsts-DDg7CYFw.js.map
