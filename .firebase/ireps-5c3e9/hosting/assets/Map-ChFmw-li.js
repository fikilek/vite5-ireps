import{r as c,E as g,s as N,j as s,M,C,t as E,v as y,S as k,x as L,u as F,a as D}from"./index-Ckqn-BEY.js";import{u as _}from"./useAstsMap-j8_131Uu.js";import{u as I}from"./useErfs-CWJ7uqn_.js";import{u as A,A as W}from"./useIrepsMap-DM3tHOVB.js";import{M as S}from"./index.esm-DZZOlSqG.js";import O from"./FormErf-BTmYaQYJ.js";import{P as v}from"./PageTitle-BOFThCd0.js";import"./useTrns-D6XIZ3Cr.js";import"./IwTrnsOnAst-v70oFSxL.js";import"./ag-theme-quartz-usV9DtiJ.js";import"./IrepsInfoWindow-Bbqu2tGZ.js";import"./za_kzn_umgungundlovu_mpofana_w1-CZ0tBZXl.js";try{let o=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},e=new o.Error().stack;e&&(o._sentryDebugIds=o._sentryDebugIds||{},o._sentryDebugIds[e]="e99f6c67-9e77-4b5d-a34f-be84b531f432",o._sentryDebugIdIdentifier="sentry-dbid-e99f6c67-9e77-4b5d-a34f-be84b531f432")}catch{}const R=()=>{const{erfsContext:o,setErfsContext:e}=c.useContext(g),a=N(),{displayLMWardBoundaries:f,state:u,fitWardBoundary:h,displayLmBoundary:b}=A(),{lmWardBoundaries:i,lmBoundary:x}=u;c.useEffect(()=>{a&&f(a)},[f,a]);const l=t=>{var p,d;const n=(p=t.currentTarget)==null?void 0:p.value;try{const r=i==null?void 0:i.find(m=>Number(m==null?void 0:m.ward)===Number(n));a.data.forEach(m=>{a.data.remove(m)}),n==="All Wards"?(b(a),h(a,x),e({...o,ward:null})):(h(a,r==null?void 0:r.wardBoundary,r==null?void 0:r.ward),e({...o,ward:Number(r==null?void 0:r.ward)}),(d=a==null?void 0:a.data)==null||d.loadGeoJson(r==null?void 0:r.erfBoundary))}catch(r){console.log("Error in MapLmWardBoundaries : ",r.message)}};return s.jsx(M,{position:C.TOP_LEFT,style:{margin:"1.6rem"},children:s.jsx("div",{className:"map-lm-ward-boundaries",children:s.jsxs("select",{onChange:l,className:"map-control-select",children:[s.jsx("option",{value:"All Wards",children:"All Wards"},"All Wards"),i&&(i==null?void 0:i.map(t=>s.jsx("option",{value:t==null?void 0:t.ward,children:t==null?void 0:t.ward},t==null?void 0:t.ward)))]})})})},B=()=>{const o=N(),{displayLmBoundary:e,state:a}=A(),{lmBoundary:f}=a;return c.useEffect(()=>{o&&e(o)},[f]),null},P=o=>{var l,t,n,p;const{erf:e,onClick:a,setMarkerRef:f}=o,[u,h]=c.useState(null);c.useEffect(()=>{var d,r;(d=e==null?void 0:e.trns)!=null&&d.length&&h((r=e==null?void 0:e.trns)==null?void 0:r.length)},[]),c.useCallback(()=>a(e),[a,e]);const b=c.useCallback(d=>f(d,e.id),[f,e==null?void 0:e.id]),{asts:i}=e,x=(i==null?void 0:i.length)||"";return s.jsx("div",{className:"erf-marker",children:s.jsxs(E,{position:{lat:(t=(l=e==null?void 0:e.address)==null?void 0:l.gps)==null?void 0:t.latitude,lng:(p=(n=e==null?void 0:e.address)==null?void 0:n.gps)==null?void 0:p.longitude},ref:b,children:[u&&s.jsx("button",{className:"erf-no-access",children:u}),x&&s.jsx("button",{className:"erf-asts",children:x}),s.jsx("button",{className:"erf-no-btn",children:s.jsx("span",{className:"erf-no",children:e==null?void 0:e.erfNo})})]})})},K=()=>{const{erfsContext:o,setErfsContext:e}=c.useContext(g),{erfs:a,ward:f}=c.useMemo(()=>o,[o]),u=a&&(a==null?void 0:a.filter(d=>{var r;return Number((r=d==null?void 0:d.address)==null?void 0:r.ward)===Number(f)})),[h,b]=c.useState({}),[i,x]=c.useState(null),l=c.useMemo(()=>u&&i?u.find(d=>d.id===i):null,[u,i]),t=N(),n=c.useMemo(()=>t?new S({map:t,zoom:10}):null,[t]);c.useEffect(()=>()=>{e({...o,ward:null})},[]),c.useEffect(()=>{if(n)try{n==null||n.clearMarkers(),n==null||n.addMarkers(Object==null?void 0:Object.values(h))}catch(d){console.log("Error in ClusteredErfMarkers: ",d.message)}},[n,h]);const p=c.useCallback((d,r)=>{b(m=>{if(d&&m[r]||!d&&!m[r])return m;if(d)return{...m,[r]:d};{const{[r]:j,...w}=m;return w}})},[]);return s.jsxs("div",{className:"clustered-erf-markers",children:[u.map((d,r)=>s.jsx(P,{erf:d,setMarkerRef:p},d.id)),i&&s.jsx(y,{anchor:h[i],disableAutoPan:!0,headerDisabled:!0,maxWidth:"100vw",children:s.jsx("div",{className:"iw-erf-form",children:s.jsx(O,{data:{data:l}})})})]})},V=o=>{var l,t;const{ast:e,onClick:a,setMarkerRef:f}=o,{lat:u,lng:h}=(l=e==null?void 0:e.location)==null?void 0:l.gps;c.useCallback(()=>a(e),[a,e]);const b=c.useCallback(n=>{if(f)return f(n,e.id)},[f,e.id]),{trns:i}=e,x=(i==null?void 0:i.length)||"";return s.jsxs(E,{position:{lat:Number(u),lng:Number(h)},ref:b,children:[x&&s.jsx("button",{className:"ast-asts",children:x}),s.jsx("button",{className:"ast-no-btn",children:s.jsx("span",{className:"ast-no",children:(t=e==null?void 0:e.astData)==null?void 0:t.astNo})})]})},z=o=>{var d;const{asts:e}=o,{erfsContext:a}=c.useContext(g),{ward:f}=c.useMemo(()=>a,[a]),u=e==null?void 0:e.filter(r=>{var m,j;return Number((j=(m=r==null?void 0:r.erf)==null?void 0:m.address)==null?void 0:j.ward)===Number(f)}),[h,b]=c.useState({}),[i,x]=c.useState(null),l=c.useMemo(()=>u&&i?u.find(r=>r.id===i):null,[u,i]),t=N(),n=c.useMemo(()=>t?new S({map:t,zoom:10}):null,[t]);c.useEffect(()=>{if(n)try{n.clearMarkers(),n.addMarkers(Object.values(h))}catch(r){console.log("Error in ClusteredAstMarkers: ",r.message)}},[n,h]);const p=c.useCallback((r,m)=>{b(j=>{if(r&&j[m]||!r&&!j[m])return j;if(r)return{...j,[m]:r};{const{[m]:w,...T}=j;return T}})},[]);return s.jsxs(s.Fragment,{children:[u==null?void 0:u.map((r,m)=>s.jsx(V,{ast:r,setMarkerRef:p},r.id)),i&&s.jsx(y,{anchor:h[i],onClose:()=>x(null),headerContent:`Meter No: ${(d=l==null?void 0:l.astData)==null?void 0:d.astNo}`,headerDisabled:!0,children:s.jsx("div",{children:s.jsx(W,{data:{data:l}})})})]})},U=o=>{const{asts:e}=o,{erfsContext:a}=c.useContext(g),{ward:f}=c.useMemo(()=>a,[a]),u=e==null?void 0:e.filter(t=>{var n,p;return Number((p=(n=t==null?void 0:t.erf)==null?void 0:n.address)==null?void 0:p.ward)===Number(f)}),h=N(),b=u&&(u==null?void 0:u.map(t=>{var n,p;return{value:(n=t==null?void 0:t.astData)==null?void 0:n.astNo,label:(p=t==null?void 0:t.astData)==null?void 0:p.astNo,data:t}})),i=t=>{var n,p,d,r,m,j;h&&t&&(h.panTo({lat:Number((d=(p=(n=t.data)==null?void 0:n.location)==null?void 0:p.gps)==null?void 0:d.lat),lng:Number((j=(m=(r=t.data)==null?void 0:r.location)==null?void 0:m.gps)==null?void 0:j.lng)}),h.setZoom(20))},x=t=>null,l={control:t=>({...t,backgroundColor:"lightgray",padding:"0.11rem"}),option:(t,n)=>({...t,borderBottom:"1px dotted pink",color:n.isSelected?"white":"black",backgroundColor:n.isSelected?"hotpink":"white"})};return s.jsx(M,{position:C.LEFT_TOP,style:{margin:"1.6rem"},children:s.jsxs("div",{className:"map-ast-filter",children:[s.jsx("div",{className:"maf",children:s.jsx("h2",{children:"Mn"})}),s.jsx(k,{defaultValue:"Meter No",options:b,isClearable:!0,onChange:i,clearValue:x,styles:l})]})})},Z=()=>{const o=N(),{erfsContext:e}=c.useContext(g),{erfs:a,ward:f}=c.useMemo(()=>e,[e]),u=a&&(a==null?void 0:a.filter(l=>{var t;return Number((t=l==null?void 0:l.address)==null?void 0:t.ward)===Number(f)})),h=u&&u.map(l=>({value:l.erfNo,label:l.erfNo,data:l})),b=l=>{var t,n,p,d,r,m;o&&l&&(o.panTo({lat:Number((p=(n=(t=l.data)==null?void 0:t.address)==null?void 0:n.gps)==null?void 0:p.latitude),lng:Number((m=(r=(d=l.data)==null?void 0:d.address)==null?void 0:r.gps)==null?void 0:m.longitude)}),o.setZoom(20))},i=l=>(console.log("clearing selected value",l),null),x={control:l=>({...l,backgroundColor:"lightgray",padding:"0.15rem"}),option:(l,t)=>({...l,borderBottom:"1px dotted pink",color:t.isSelected?"white":"black",backgroundColor:t.isSelected?"hotpink":"white"})};return s.jsx(M,{position:C.LEFT_TOP,style:{margin:"1.6rem"},children:s.jsxs("div",{className:"map-erf-filter",children:[s.jsx("div",{className:"mef",children:s.jsx("h2",{children:"Erf"})}),s.jsx(k,{defaultValue:"Erf No",options:h,isClearable:!0,onChange:b,clearValue:i,styles:x})]})})},$=o=>{const{asts:e,astsTableFields:a}=o,{erfsContext:f}=c.useContext(g),{ward:u}=c.useMemo(()=>f,[f]);return s.jsx("div",{className:"map-main",children:s.jsxs(L,{children:[s.jsx(B,{}),s.jsx(R,{}),s.jsx(z,{asts:e,astsTableFields:a}),s.jsx(K,{}),u?s.jsxs(s.Fragment,{children:[s.jsx(U,{asts:e,astsTableFields:a}),s.jsx(Z,{})]}):""]})})},G=o=>{const{phLl:e}=o,{user:a}=F(),{userFromUsers:f}=D(a==null?void 0:a.uid);return s.jsxs("div",{className:"map-header",children:[s.jsx("div",{className:"ph ph-left",children:s.jsxs("div",{className:"phLl",children:[s.jsx(v,{title:e}),s.jsx(v,{title:f.workbase})]})}),s.jsxs("div",{className:"ph ph-right",children:[s.jsx("div",{className:"phRl"}),s.jsx("div",{className:"phRr"})]})]})},oe=()=>{I();const{asts:o,astsTableFields:e,error:a}=_();return s.jsxs("div",{className:"map",children:[s.jsx(G,{phLl:"Map"}),s.jsx("div",{className:"map-body",children:s.jsx($,{asts:o,astsTableFields:e})})]})};export{oe as default};
//# sourceMappingURL=Map-ChFmw-li.js.map
