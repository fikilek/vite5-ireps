import{r as f,u as V,j as t,F as W,A as X,l as P,a1 as k,i as S,g as T}from"./index-BjVKhCAv.js";import{M as b,C as A,A as O,T as Y}from"./ag-theme-quartz-C9odMXne.js";import{l as Z}from"./TableBtnsPossibleTrnsOnAst-D-hfg8IA.js";import{A as z,T as $,C as B,a as K,S as M,R as g}from"./Report-By7D_OBX.js";import"./useTrns-BiXDnjMc.js";b.registerModules([A]);const _=a=>{const{rowData:e,colDefs:r,tableRef:d}=a,n=f.useRef(),{user:s}=V(),c=s==null?void 0:s.email;console.log("email",c);const u=s==null?void 0:s.displayName,i=f.useMemo(()=>({sortable:!0,filter:!0,resizable:!0,floatingFilter:!0,suppressMovable:!0}),[]),N=h=>h.data.id,o=async h=>{n.current=h.api},l=()=>{c==="fikilekentane@gmail.com"||c==="zamo@rsteutilities.com"||c==="sbu@isandisoipe.co.za"||n.current.setColumnFilterModel("metadata.createdByUser",{filterType:"text",type:"contains",filter:u}),n.current.onFilterChanged()};return t.jsx("div",{className:"ag-theme-quartz table table-asts",children:t.jsx(O,{rowData:e,columnDefs:r,defaultColDef:i,pagination:!0,noRowsOverlayComponent:Y,getRowId:N,reactiveCustomComponents:!0,onGridReady:o,onFirstDataRendered:l,ref:d})})},tt=({asts:a,astsTableFields:e,tableRef:r})=>t.jsx("div",{className:"asts-table table",children:t.jsx(_,{rowData:a,colDefs:e,tableRef:r})}),I=a=>{var x,y,j,D,E,F;const e=a==null?void 0:a.stats,r=e==null?void 0:e.total,{filtersContext:d}=f.useContext(W),{createdAtDatetimeRange:n,updatedAtDatetimeRange:s,filterCondition:c}=d,{astsContext:u}=f.useContext(X),i=!(n[0]==null||n[0]==null||n[1]==null||n[1]==null),N=!(s[0]==null||s[0]==null||s[1]==null||s[1]==null);let o=[];if(i||N)i&&(o=n),N&&(o=s);else{const v=u==null?void 0:u.asts;if(!v)return;(y=(x=v==null?void 0:v[0])==null?void 0:x.metadata)==null||y.createdAtDatetime;const p=Z.cloneDeep(v);p==null||p.sort((H,Q)=>{var w,G,q,U;const J=(G=(w=H.metadata)==null?void 0:w.createdAtDatetime)==null?void 0:G.toMillis(),L=(U=(q=Q.metadata)==null?void 0:q.createdAtDatetime)==null?void 0:U.toMillis();return J-L});const C=(D=(j=p==null?void 0:p[0])==null?void 0:j.metadata)==null?void 0:D.createdAtDatetime,R=(F=(E=p==null?void 0:p[(p==null?void 0:p.length)-1])==null?void 0:E.metadata)==null?void 0:F.createdAtDatetime;o=[C==null?void 0:C.toDate(),R==null?void 0:R.toDate()]}const l=o==null?void 0:o[0],h=o==null?void 0:o[1];P(new Date(l||0),k.dateFormat3),P(new Date(h||0),k.dateFormat3);const{title:m}=a;return t.jsxs("div",{className:"report-heading",children:[t.jsxs("div",{className:"rh rh-left",children:[t.jsx("p",{className:"rhl rh-element rhll",children:m}),t.jsx("p",{className:"rhr rh-element rhlr"})]}),t.jsxs("div",{className:"rh rh-right",children:[t.jsx("p",{className:"rhr rh-element rhrl"}),t.jsxs("p",{className:"rhr rh-element rhrr",children:["Total: ",r]})]})]})};b.registerModules([A]);const et=a=>{const{rowData:e,colDefs:r}=a;return t.jsx("div",{className:"ag-theme-quartz table table-trns",children:t.jsx(O,{rowData:e,columnDefs:r})})},at=a=>{const{data:e}=a,r=[{field:"uid",headerName:"System Id",hide:!0},{field:"displayName",headerName:"User Name",flex:.5},{field:"quantity",headerName:"Quantities",flex:.3},{field:"percentage",headerName:"%",flex:.2}];return t.jsx("div",{className:"report-asts-users-table",children:t.jsx(et,{rowData:e,colDefs:r})})},st=a=>{const{data:e}=a,[r,d]=f.useState({data:e,series:[{type:"bar",xKey:"displayName",yKey:"quantity",itemStyler:n=>({fill:n.datum.fillColor})}],title:{text:"Meters Created Per Fieldworker"}});return f.useEffect(()=>{d({...r,data:e})},[e]),t.jsx("div",{className:"report-asts-users-barchart",children:t.jsx(z,{options:r})})},rt=()=>{const{astsStatsContext:a}=f.useContext(S),e=a==null?void 0:a.statsAstsUsers;return t.jsxs("div",{className:"report-asts-users",children:[t.jsx(I,{title:"Users Stats",stats:e}),t.jsxs("div",{className:"rau-body",children:[t.jsx(at,{data:e==null?void 0:e.stats}),t.jsx(st,{data:e==null?void 0:e.stats})]})]})},lt=a=>{const{stats:e,tableRef:r}=a;let d=[{field:"anomalyName",headerName:"Anomaly - Anomaly Detail",width:"220"}],n=[];return e==null||e.forEach(s=>{const c=s.anomalyDetailStatsArray;c==null||c.forEach(u=>{const i=u.updatedUserStats,N=`${s.anomalyName}-${u.anomalyDetailName}`;let o={};i==null||i.forEach(l=>{o[l.uid]={user:l},d.some(m=>{var x;return((x=m==null?void 0:m.valueGetterParam)==null?void 0:x.uid)===l.uid})||d.push({field:`userObj.${l.uid}.user.quantity`,headerName:T(l.displayName),width:"58",headerTooltip:l.displayName,valueGetter:m=>{var y,j,D;const x=(D=(j=(y=m.data)==null?void 0:y.userObj[l==null?void 0:l.uid])==null?void 0:j.user)==null?void 0:D.quantity;return x||0},valueGetterParams:{uid:l.uid}})}),n.push({anomalyName:N,anomalyDetailStats:u.anomalyDetailStats,userObj:o})})}),d.push({field:"anomalyDetailStats",headerName:"Total",width:"100",cellRenderer:s=>s.value?s.value:0}),t.jsx("div",{className:"stats-combo-table-anomalies",children:t.jsx($,{rowData:n,colDefs:d,tableRef:r})})};b.registerModules([A]);b.registerModules([B]);const ot=()=>{const{astsStatsContext:a}=f.useContext(S),e=f.useRef(),{anomalyPerUserStats:r}=a,d=c=>{e.current.api.exportDataAsCsv()},n="Anomaly Summary",s={hl1:"hl1",hl2:"",hr1:" ",hr2:t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:d,className:"stats-btn stats-btn-export",children:"Export"})," ",t.jsx("button",{className:"stats-btn stats-btn-pdf",children:"Pdf"})]})};return t.jsxs("div",{className:"report-asts-anomalies",children:[t.jsx(I,{title:"Meters Anomalies Per User Stats",stats:r}),t.jsx("div",{className:"raa-body",children:t.jsx(K,{statsName:"Anomaly Summary",children:t.jsx(M,{statsName:n,stats:r,headerData:s,children:t.jsx(lt,{stats:r==null?void 0:r.stats,tableRef:e})})})})]})},nt=a=>{const{stats:e,tableRef:r}=a;let d=[{field:"meterTypeName",headerName:"Meter Type",width:"110"}],n=[];return e==null||e.forEach(s=>{var u;let c={};(u=s==null?void 0:s.stats)==null||u.forEach(i=>{const N=d.some(o=>{var l;return((l=o==null?void 0:o.valueGetterParam)==null?void 0:l.uid)===i.uid});c[i.uid]={user:i},N||d.push({field:`users.${i.uid}.user.quantity`,headerName:T(i.displayName),width:"58",headerTooltip:i.displayName,valueGetter:o=>{var h,m,x;const l=(x=(m=(h=o.data)==null?void 0:h.users[i==null?void 0:i.uid])==null?void 0:m.user)==null?void 0:x.quantity;return l||0},valueGetterParam:{uid:i.uid}})}),n.push({meterTypeName:s.meterTypeName,total:s.total,users:c})}),d.push({field:"total",headerName:"Total",width:"100",cellRenderer:s=>s.value?s.value:0}),t.jsx("div",{className:"stats-combo-table-meter-type",children:t.jsx($,{rowData:n,colDefs:d,tableRef:r})})},it=a=>{const{userData:e,barChartSeries:r}=a==null?void 0:a.stats,d={title:{text:"Meter Type Per User"},subtitle:{text:"Pre-paid/Conventional"},data:e,series:r};return t.jsx("div",{className:"stats-combo-bar-chart",children:t.jsx(z,{options:d})})};b.registerModules([A]);b.registerModules([B]);const dt=()=>{const{astsStatsContext:a}=f.useContext(S),e=f.useRef(),{meterTypePerUserStats:r,anomaliesStats:d}=a,n=[];let s=[];r==null||r.forEach(o=>{var h;let l={meterTypeName:o.meterTypeName};(h=o==null?void 0:o.stats)==null||h.forEach(m=>{if(!n.some(y=>y.uid===m.uid)){const y={type:"bar",xKey:"meterTypeName",yKey:m.uid,yName:T(m.displayName),uid:m.uid};n.push(y)}l={...l,[m.uid]:m.quantity}}),s.push(l)});const c={userData:s,barChartSeries:n},u="Meter Type Summary",i=o=>{var l,h;(h=(l=e.current)==null?void 0:l.api)==null||h.exportDataAsCsv()},N={hl1:"hl1",hl2:"",hr1:" ",hr2:t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:i,className:"stats-btn stats-btn-export",children:"Export"})," ",t.jsx("button",{className:"stats-btn stats-btn-pdf",children:"Pdf"})]})};return t.jsx("div",{className:"report-asts-meter-type",children:t.jsx("div",{className:"ramt-body",children:t.jsxs(K,{statsName:"Meter Type Summary",children:[t.jsx(M,{statsName:`${u}`,stats:c,headerData:N,children:t.jsx(nt,{stats:r,tableRef:e})}),t.jsx(M,{statsName:`${u} Bar Chart`,stats:c,headerData:N,children:t.jsx(it,{stats:c})})]})})})},pt=({asts:a,astsTableFields:e,tableRef:r})=>t.jsxs("div",{className:"asts-main",children:[t.jsx(tt,{asts:a,astsTableFields:e,tableRef:r}),t.jsx(g,{reportName:"users",children:t.jsx(rt,{})}),t.jsx(g,{reportName:"anomalies",children:t.jsx(ot,{})}),t.jsx(g,{reportName:"meterType",children:t.jsx(dt,{})})]});export{pt as default};
