import{r as b,j as o,a5 as y,D as R,u as C,a6 as w,a7 as g,a8 as x,a9 as v,Y as D,n as E,m as N}from"./index-DTpsEHRa.js";import{M,C as j,A as U,T}from"./ag-theme-quartz-DEqtEQe6.js";M.registerModules([j]);const S=a=>{const{rowData:m,colDefs:s}=a,i=b.useMemo(()=>({sortable:!0,filter:!0,resizable:!0,floatingFilter:!0,suppressMovable:!0}),[]),t=d=>d.data.id,n={"row-disabled":d=>{var l;return(l=d==null?void 0:d.data)==null?void 0:l.disabled}};return o.jsx("div",{className:"ag-theme-quartz table table-users",children:o.jsx(U,{rowData:m,columnDefs:s,defaultColDef:i,pagination:!0,noRowsOverlayComponent:T,getRowId:t,rowClassRules:n,reactiveCustomComponents:!0})})},p=a=>{var h;const{roles:m}=(h=a==null?void 0:a.data)==null?void 0:h.customClaims,{customClaims:s,setCustomClaims:i}=b.useContext(y),[t,n]=b.useState({}),{uid:d}=a==null?void 0:a.data,l=s==null?void 0:s.uid;b.useEffect(()=>{d===l&&s.roles?n(s.roles):n(m)},[s]);const{openModal:e}=R(),{user:r}=C();d===r.uid||a.data.disabled;const c=u=>{i({uid:d,roles:t}),e({modalName:"editUserRoles",payload:a.data})};return o.jsx("div",{className:"table-users-roles",children:w&&w.map(u=>{console.log("role",u);const f=t[u.key]?"hasRole":"";return o.jsx("button",{className:`table-btn ${f}`,title:u.name,onClick:c,children:u.abbreviation},u.name)})})},A=a=>{const{value:m,options:s,onValueChange:i}=a,t=g(),n=x(t,"disableUserAcc"),d=l=>{i(l.target.value),a.api.redrawRows(),n({uid:a.data.uid,action:l.target.value==="disabled"}).then(e=>{v.success(`User acc [${a.data.displayName}] succesfully ${l.target.value==="disabled"?"DISABLED":"ENABLED"}  `,{position:"bottom-left"})}).catch(e=>{console.log("Error:",e.message)})};return o.jsx("div",{className:"table-user-acc-disable-select",children:o.jsx("select",{value:m,className:"table-btn",onChange:d,children:s&&s.map(l=>o.jsx("option",{value:l,children:l},l))})})},k=a=>{const[m,s]=b.useState([]),{user:i}=C(),{data:t}=D("users",null),n=g(),d=x(n,"listAllUsers");return b.useEffect(()=>{i&&d().then(e=>{var c;let r=[];(c=e==null?void 0:e.data)==null||c.forEach(h=>{const u=t.find(f=>h.uid===f.id);u&&r.push({...h,companyName:u.companyName,workbase:u.workbase,phoneNumber:u.phoneNumber})}),s(r)})},[t,i]),{usersTableFields:[{field:"uid",headerName:"users Id",width:250,hide:!0},{field:"disabled",headerName:"Acc Status?",width:150,editable:!0,cellEditor:A,cellEditorParams:{options:["enabled","disabled"]},valueGetter:e=>e.data.disabled?"disabled":"enabled",valueSetter:e=>(e.data.disabled=e.newValue==="disabled",!0),cellStyle:e=>{const{uid:r}=e.data;return r===i.uid?{color:"grey",fontWeight:"700",pointerEvents:"none",cursor:"none",borderLeft:"0.3rem solid grey"}:""}},{field:"workbase",headerName:"Workbase",width:180,cellRenderer:e=>o.jsx(E,{data:e,children:e.value}),cellRendererParams:{modalName:"workbases",width:"8rem"}},{field:"metadata.creationTime",headerName:"Date Created",width:180,cellRenderer:e=>{var c;const r=new Date((c=e.data.metadata)==null?void 0:c.creationTime);return o.jsx(N,{date:r,dateFormat:"yyyy-MMM-dd HH:mm"})}},{field:"metadata.lastSignInTime",headerName:"Last Signin",width:180,cellRenderer:e=>{var c;const r=new Date((c=e.data.metadata)==null?void 0:c.lastSignInTime);return o.jsx(N,{date:r,dateFormat:"yyyy-MMM-dd HH:mm"})}},{field:"displayName",headerName:"Display Name",width:170},{field:"email",headerName:"Email Adr",width:200},{field:"emailVerified",headerName:"Email Verified",width:150,cellRenderer:e=>o.jsx("p",{children:e.data.emailVerified?"Yes":"No"})},{field:"customClaims.roles",headerName:"Roles",width:220,cellRenderer:p,valueGetter:e=>e.value},{field:"phoneNumber",headerName:"Phone Number",width:150},{field:"companyName",headerName:"Company Name",width:170}],users:m}},V=()=>{const{usersTableFields:a,users:m}=k(),[s,i]=b.useState([]),{customClaims:t}=b.useContext(y);return b.useEffect(()=>{i(m)},[m]),b.useEffect(()=>{if(!t)return;const n=s.find(r=>r.uid===(t==null?void 0:t.uid)),d={...n,customClaims:{...n==null?void 0:n.customClaims,roles:t==null?void 0:t.roles}},l=s.findIndex(r=>r.uid===(t==null?void 0:t.uid));if(l===-1)return;const e=s==null?void 0:s.with(l,d);i(e)},[t]),o.jsx("div",{className:"table",children:o.jsx(S,{rowData:s,colDefs:a})})};export{V as default};
