import{aD as ue,r as s,aF as $,y as fe,z as me,bb as se,j as e,I as he,bF as ge,bu as q,u as K,bt as G,Q as J,l as Q,a9 as k,bG as T,bH as F,bI as X,bJ as Y,a1 as Z,bK as te}from"./index-BjVKhCAv.js";var V=function(){return V=Object.assign||function(g){for(var c,x=1,f=arguments.length;x<f;x++){c=arguments[x];for(var m in c)Object.prototype.hasOwnProperty.call(c,m)&&(g[m]=c[m])}return g},V.apply(this,arguments)},pe=function(g,c){var x={};for(var f in g)Object.prototype.hasOwnProperty.call(g,f)&&c.indexOf(f)<0&&(x[f]=g[f]);if(g!=null&&typeof Object.getOwnPropertySymbols=="function")for(var m=0,f=Object.getOwnPropertySymbols(g);m<f.length;m++)c.indexOf(f[m])<0&&Object.prototype.propertyIsEnumerable.call(g,f[m])&&(x[f[m]]=g[f[m]]);return x},ve=ue("ScaleLoader","0% {transform: scaley(1.0)} 50% {transform: scaley(0.4)} 100% {transform: scaley(1.0)}","scale");function ie(g){var c=g.loading,x=c===void 0?!0:c,f=g.color,m=f===void 0?"#000000":f,p=g.speedMultiplier,i=p===void 0?1:p,r=g.cssOverride,u=r===void 0?{}:r,y=g.height,M=y===void 0?35:y,S=g.width,v=S===void 0?4:S,l=g.radius,t=l===void 0?2:l,a=g.margin,o=a===void 0?2:a,n=pe(g,["loading","color","speedMultiplier","cssOverride","height","width","radius","margin"]),C=V({display:"inherit"},u),h=function(b){return{backgroundColor:m,width:$(v),height:$(M),margin:$(o),borderRadius:$(t),display:"inline-block",animation:"".concat(ve," ").concat(1/i,"s ").concat(b*.1,"s infinite cubic-bezier(0.2, 0.68, 0.18, 1.08)"),animationFillMode:"both"}};return x?s.createElement("span",V({style:C},n),s.createElement("span",{style:h(1)}),s.createElement("span",{style:h(2)}),s.createElement("span",{style:h(3)}),s.createElement("span",{style:h(4)}),s.createElement("span",{style:h(5)})):null}var ce={exports:{}};(function(g,c){(function(f,m){g.exports=m(s)})(fe,function(x){return function(f){var m={};function p(i){if(m[i])return m[i].exports;var r=m[i]={i,l:!1,exports:{}};return f[i].call(r.exports,r,r.exports,p),r.l=!0,r.exports}return p.m=f,p.c=m,p.d=function(i,r,u){p.o(i,r)||Object.defineProperty(i,r,{enumerable:!0,get:u})},p.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},p.t=function(i,r){if(r&1&&(i=p(i)),r&8||r&4&&typeof i=="object"&&i&&i.__esModule)return i;var u=Object.create(null);if(p.r(u),Object.defineProperty(u,"default",{enumerable:!0,value:i}),r&2&&typeof i!="string")for(var y in i)p.d(u,y,(function(M){return i[M]}).bind(null,y));return u},p.n=function(i){var r=i&&i.__esModule?function(){return i.default}:function(){return i};return p.d(r,"a",r),r},p.o=function(i,r){return Object.prototype.hasOwnProperty.call(i,r)},p.p="",p(p.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(f,m,p){p.r(m);var i=p("react"),r=function(){var v=function(l,t){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,o){a.__proto__=o}||function(a,o){for(var n in o)o.hasOwnProperty(n)&&(a[n]=o[n])},v(l,t)};return function(l,t){v(l,t);function a(){this.constructor=l}l.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)}}(),u=function(){return u=Object.assign||function(v){for(var l,t=1,a=arguments.length;t<a;t++){l=arguments[t];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(v[o]=l[o])}return v},u.apply(this,arguments)},y=function(v,l){var t={};for(var a in v)Object.prototype.hasOwnProperty.call(v,a)&&l.indexOf(a)<0&&(t[a]=v[a]);if(v!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,a=Object.getOwnPropertySymbols(v);o<a.length;o++)l.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(v,a[o])&&(t[a[o]]=v[a[o]]);return t};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(l){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t?new Promise(function(a,o){t.call(navigator,l,a,o)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function M(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var S=function(v){r(l,v);function l(t){var a=v.call(this,t)||this;return a.canvas=null,a.ctx=null,a.requestUserMediaId=0,a.unmounted=!1,a.state={hasUserMedia:!1},a}return l.prototype.componentDidMount=function(){var t=this,a=t.state,o=t.props;if(this.unmounted=!1,!M()){o.onUserMediaError("getUserMedia not supported");return}a.hasUserMedia||this.requestUserMedia(),o.children&&typeof o.children!="function"&&console.warn("children must be a function")},l.prototype.componentDidUpdate=function(t){var a=this.props;if(!M()){a.onUserMediaError("getUserMedia not supported");return}var o=JSON.stringify(t.audioConstraints)!==JSON.stringify(a.audioConstraints),n=JSON.stringify(t.videoConstraints)!==JSON.stringify(a.videoConstraints),C=t.minScreenshotWidth!==a.minScreenshotWidth,h=t.minScreenshotHeight!==a.minScreenshotHeight;(n||C||h)&&(this.canvas=null,this.ctx=null),(o||n)&&(this.stopAndCleanup(),this.requestUserMedia())},l.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},l.stopMediaStream=function(t){t&&(t.getVideoTracks&&t.getAudioTracks?(t.getVideoTracks().map(function(a){t.removeTrack(a),a.stop()}),t.getAudioTracks().map(function(a){t.removeTrack(a),a.stop()})):t.stop())},l.prototype.stopAndCleanup=function(){var t=this.state;t.hasUserMedia&&(l.stopMediaStream(this.stream),t.src&&window.URL.revokeObjectURL(t.src))},l.prototype.getScreenshot=function(t){var a=this,o=a.state,n=a.props;if(!o.hasUserMedia)return null;var C=this.getCanvas(t);return C&&C.toDataURL(n.screenshotFormat,n.screenshotQuality)},l.prototype.getCanvas=function(t){var a=this,o=a.state,n=a.props;if(!this.video||!o.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var C=this.video.videoWidth,h=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var b=C/h;C=n.minScreenshotWidth||this.video.clientWidth,h=C/b,n.minScreenshotHeight&&h<n.minScreenshotHeight&&(h=n.minScreenshotHeight,C=h*b)}this.canvas=document.createElement("canvas"),this.canvas.width=(t==null?void 0:t.width)||C,this.canvas.height=(t==null?void 0:t.height)||h,this.ctx=this.canvas.getContext("2d")}var N=this,j=N.ctx,d=N.canvas;return j&&d&&(d.width=(t==null?void 0:t.width)||d.width,d.height=(t==null?void 0:t.height)||d.height,n.mirrored&&(j.translate(d.width,0),j.scale(-1,1)),j.imageSmoothingEnabled=n.imageSmoothing,j.drawImage(this.video,0,0,(t==null?void 0:t.width)||d.width,(t==null?void 0:t.height)||d.height),n.mirrored&&(j.scale(-1,1),j.translate(-d.width,0))),d},l.prototype.requestUserMedia=function(){var t=this,a=this.props,o=function(h,b){var N={video:typeof b<"u"?b:!0};a.audio&&(N.audio=typeof h<"u"?h:!0),t.requestUserMediaId++;var j=t.requestUserMediaId;navigator.mediaDevices.getUserMedia(N).then(function(d){t.unmounted||j!==t.requestUserMediaId?l.stopMediaStream(d):t.handleUserMedia(null,d)}).catch(function(d){t.handleUserMedia(d)})};if("mediaDevices"in navigator)o(a.audioConstraints,a.videoConstraints);else{var n=function(h){return{optional:[{sourceId:h}]}},C=function(h){var b=h.deviceId;return typeof b=="string"?b:Array.isArray(b)&&b.length>0?b[0]:typeof b=="object"&&b.ideal?b.ideal:null};MediaStreamTrack.getSources(function(h){var b=null,N=null;h.forEach(function(w){w.kind==="audio"?b=w.id:w.kind==="video"&&(N=w.id)});var j=C(a.audioConstraints);j&&(b=j);var d=C(a.videoConstraints);d&&(N=d),o(n(b),n(N))})}},l.prototype.handleUserMedia=function(t,a){var o=this.props;if(t||!a){this.setState({hasUserMedia:!1}),o.onUserMediaError(t);return}this.stream=a;try{this.video&&(this.video.srcObject=a),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(a)})}o.onUserMedia(a)},l.prototype.render=function(){var t=this,a=this,o=a.state,n=a.props,C=n.audio;n.forceScreenshotSourceSize;var h=n.disablePictureInPicture;n.onUserMedia,n.onUserMediaError,n.screenshotFormat,n.screenshotQuality,n.minScreenshotWidth,n.minScreenshotHeight,n.audioConstraints,n.videoConstraints,n.imageSmoothing;var b=n.mirrored,N=n.style,j=N===void 0?{}:N,d=n.children,w=y(n,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),_=b?u(u({},j),{transform:(j.transform||"")+" scaleX(-1)"}):j,D={getScreenshot:this.getScreenshot.bind(this)};return i.createElement(i.Fragment,null,i.createElement("video",u({autoPlay:!0,disablePictureInPicture:h,src:o.src,muted:!C,playsInline:!0,ref:function(O){t.video=O},style:_},w)),d&&d(D))},l.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},l}(i.Component);m.default=S},react:function(f,m){f.exports=x}}).default})})(ce);var be=ce.exports;const de=me(be),le=()=>{function g(i){const r=new Image;return r.src=i,r}function c(i,r){let u=i.split("%2F").pop();return u=`${r}${u}`,`${i.split("%2F").slice(0,-1).join("%2F")}%2F${u}`}function x(i,r){let u=0,y=0,M=500,S=500;return i.naturalWidth>i.naturalHeight?i.naturalWidth>r&&(M=r,S=r*i.naturalHeight/i.naturalWidth):i.naturalHeight>r&&(S=r,M=r*i.naturalWidth/i.naturalHeight),console.log(u,y,M,S),[u,y,M,S]}function f(i,r){let u=0,y=0,M=r,S=r;return i.naturalWidth>i.naturalHeight?(M=r*i.naturalWidth/i.naturalHeight,u=-Math.abs(M-r)/2):(S=r*i.naturalHeight/i.naturalWidth,y=-Math.abs(S-r)/2),[u,y,M,S]}async function m(i){if(!i||!i.type.startsWith("image/"))throw new Error("Only images are accepted (jpeg, gif, png)");const r=new FileReader;return r.readAsDataURL(i),new Promise(u=>{r.onload=y=>{u(y.target.result)}})}function p(i,r,u=!1,y){const{mediaCategory:M,astNo:S,erfNo:v,createdAtDatetime:l,createdByUser:t,createdAtLocation:a}=y,o=document.createElement("canvas"),n=o.getContext("2d"),C=g(i),[h,b,N,j]=u?f(C,r):x(C,r);return o.width=u?r:N,o.height=u?r:j,n.drawImage(C,h,b,N,j),n.fillRect(10,10,420,260),n.fillStyle="white",n.font="30px sans-serif",n.fillText(se.get(M),10,50),S&&n.fillText(`Ast No: ${S}`,10,250),v&&n.fillText(`Erf No: ${v}`,10,250),n.fillText(l,10,100),n.fillText(t,10,150),n.fillText(`(${Number(a==null?void 0:a.lat).toFixed(6).trim()}/${Number(a==null?void 0:a.lng).toFixed(6).trim()})`,10,200),new Promise(d=>{o.toBlob(w=>{d(w)},"image/jpeg")})}return{resizeImg:p,getBase64URL:m,prefixFileName:c}},ee=g=>{const{handleClose:c,color:x}=g,f=x||"#f2f";return e.jsx("div",{className:"window-close-btn",children:e.jsx("button",{onClick:c,className:"close-btn",children:e.jsx(he.Provider,{value:{color:f},children:e.jsx(ge,{})})})})},ye=g=>{var P,I;const{data:c}=g,x={facingMode:{exact:"environment"}},{irepsKeyItem:f}=c;let m,p;f==="trns"&&(m="asts",p=c.data.astData.astId),f==="erfs"&&(m="erfs",p=c.data.id);const i=s.useRef(null),{uploadFile:r,url:u,error:y}=q(c),[M,S]=s.useState(null),[v,l]=s.useState(null),[t,a]=s.useState(null),[o,n]=s.useState({}),[C,h]=s.useState(x),{user:b}=K(),{resizeImg:N,getBase64URL:j}=le(),{mediaData:d,setMediaData:w}=s.useContext(G),{mediaCat:_,trnId:D}=d,{userLocation:O}=J(),R=s.useCallback(A=>{var L,ae;const B=i.current.getScreenshot();S(Ce=>B);const z={mediaType:"image/jpeg",mediaCategory:_,createdByUser:b.displayName,createdByUid:b.uid,createdAtDatetime:Q(new Date,Z.dateFormat2),createdAtLocation:{lat:(L=O==null?void 0:O.coordinates)==null?void 0:L.lat,lng:(ae=O==null?void 0:O.coordinates)==null?void 0:ae.lng}};f==="erfs"?n({...z,erfId:c.data.id,erfNo:c.data.erfNo}):f==="trns"?n({...z,astId:c.data.astData.astId,astNo:c.data.astData.astNo,trnId:D}):console.log("throw error")},[c.erfNo,c.id,b.displayName,b.uid,(P=O==null?void 0:O.coordinates)==null?void 0:P.lat,(I=O==null?void 0:O.coordinates)==null?void 0:I.lng]),E=A=>{w({...d,activeMediaAction:null})};s.useEffect(()=>{N(M,1200,!0,o).then(A=>{M&&j(A).then(B=>{l(B)})})},[M,d,j,o,N]);const W=A=>{if(!o.createdAtLocation.lat)return k.error("Cannot upload without user Gps coordinates.",{position:"top-right"}),null;a(!0),r(v,m,p,o,"image")};s.useEffect(()=>((u||y)&&(a(!1),S(null),w({...d,activeMediaAction:null})),y&&k.error(`Storage Error : ${y}`,{position:"top-right"}),()=>{l(null)}),[u,y,d,w]);const H=()=>{S(""),l("")};s.useEffect(()=>()=>{h(x)},[]);const U=A=>{h({...C,facingMode:A.currentTarget.id==="front"?"user":{exact:"environment"}})};return e.jsxs("div",{className:"media-action-camera",children:[e.jsx("div",{className:"media-catergory",children:e.jsxs("p",{className:"media-cat",children:["Take ",se.get(d.mediaCat)," Photo"]})}),v?e.jsx("div",{className:"macpp resized",children:v&&e.jsx(e.Fragment,{children:e.jsx("img",{className:"img-preview",width:150,height:150,src:v,alt:"resizedBase64URL"})})}):e.jsx("div",{className:"macpp original",children:e.jsx(de,{className:"webcam",width:400,height:400,ref:i,videoConstraints:C,screenshotFormat:"image/jpeg"})}),e.jsxs("div",{className:"mac mac-control-bar",children:[e.jsxs("div",{className:"maccb maccb-left",children:[!M&&e.jsx(T,{id:"",actionClassname:"",title:"click to take a photo",clickHanderFunction:R,actionIcon:F.ICON_CAMERA_SHOOT,color:"blue"}),M&&e.jsx(T,{id:"",actionClassname:"",title:"click to discard",clickHanderFunction:H,actionIcon:F.ICON_DELETE,color:"brown"}),e.jsxs(e.Fragment,{children:[e.jsx(T,{id:"selfie",actionClassname:"",title:"SELFIE photo",clickHanderFunction:U,actionIcon:F.ICON_CAMERA_SELFIE,color:"green"}),e.jsx(T,{id:"front",actionClassname:"",title:"FRONT photo",clickHanderFunction:U,actionIcon:F.ICON_CAMERA_FRONT2,color:"red"})]})]}),e.jsxs("div",{className:"maccb maccb-right",children:[v&&e.jsx(e.Fragment,{children:e.jsx("button",{disabled:!M,className:"mab btn-submit-form",type:"button",onClick:W,children:t?e.jsx(X,{color:"#F86F03",loading:t<100,size:20,"aria-label":"Loading Spinner","data-testid":"loader"}):e.jsx(Y,{})})}),e.jsx(ee,{handleClose:E})]})]})]})},re="audio/webm",xe=g=>{const{data:c}=g,[x,f]=s.useState(!1),m=s.useRef(null),[p,i]=s.useState("inactive"),[r,u]=s.useState(null),[y,M]=s.useState([]),[S,v]=s.useState(null),[l,t]=s.useState(null),[a,o]=s.useState(null),{uploadFile:n,url:C,error:h}=q(c),[b,N]=s.useState({}),{user:j}=K(),{mediaData:d,setMediaData:w}=s.useContext(G),{userLocation:_}=J(),D=U=>{if(!b.createdAtLocation.lat)return k.error("Cannot upload without user Gps coordinates.",{position:"top-right"}),null;o(!0),n(l,c.irepsKeyItem,c.data.id,b,"audio")};s.useEffect(()=>((C||h)&&(o(!1),w({...d,activeMediaAction:null})),h&&k.error(`Storage Error : ${h}`,{position:"top-right"}),()=>{v(null)}),[C,h,d,w]);const O=U=>{console.log("discard"),v(null),t(null),M(null)},R=U=>{w({...d,activeMediaAction:null})},E=async()=>{if("MediaRecorder"in window)try{const U=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});f(!0),u(U)}catch(U){alert(U.message)}else alert("The MediaRecorder API is not supported in your browser.")},W=async()=>{i("recording");const U=new MediaRecorder(r,{type:"mime/mp4"});m.current=U,m.current.start();let P=[];m.current.ondataavailable=I=>{typeof I.data>"u"||I.data.size!==0&&P.push(I.data)},M(P)},H=()=>{i("inactive"),m.current.stop(),m.current.onstop=()=>{var I,A;const U=new Blob(y,{type:re}),P=URL.createObjectURL(U);v(P),t(U),N({erfId:c.data.id,erfNo:c.data.erfNo,mediaType:re,mediaCategory:"erfAudio",createdByUser:j.displayName,createdByUid:j.uid,createdAtDatetime:Q(new Date,Z.dateFormat2),createdAtLocation:{lat:(I=_==null?void 0:_.coordinates)==null?void 0:I.lat,lng:(A=_==null?void 0:_.coordinates)==null?void 0:A.lng}})}};return e.jsxs("div",{className:"media-action-voice",children:[e.jsxs("div",{className:"recording-status",children:[S&&p!=="recording"&&e.jsx("div",{className:"audio-player",children:e.jsx("audio",{src:S,controls:!0})}),p==="recording"&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{color:"#F86F03",loading:a<100,size:20,"aria-label":"Loading Spinner","data-testid":"loader"}),e.jsx(ie,{color:"#F86F03",loading:a<100,size:20,"aria-label":"Loading Spinner","data-testid":"loader"})]})]}),e.jsxs("div",{className:"mac mac-control-bar",children:[e.jsxs("div",{className:"maccb maccb-left",children:[!x&&e.jsx(T,{id:"",actionClassname:"",title:"Get PERMISSION to record voice",clickHanderFunction:E,actionIcon:F.ICON_PERMISSION,color:"blue"}),S&&e.jsx(T,{id:"",actionClassname:"",title:"DISCARD recorded voice",clickHanderFunction:O,actionIcon:F.ICON_DELETE,color:"blue"}),!S&&x&&e.jsx(T,{id:"",actionClassname:"",title:"START vocie recording",clickHanderFunction:W,actionIcon:F.ICON_START_RECORDING,color:"blue"}),p==="recording"&&e.jsx(T,{id:"",actionClassname:"",title:"STOP voice recording",clickHanderFunction:H,actionIcon:F.ICON_STOP,color:"blue"})]}),e.jsxs("div",{className:"maccb maccb-right",children:[S&&e.jsx("button",{disabled:!S,className:"mab",type:"button",onClick:D,children:a?e.jsx(X,{color:"#F86F03",loading:a<100,size:20,"aria-label":"Loading Spinner","data-testid":"loader"}):e.jsx(Y,{})}),e.jsx(ee,{handleClose:R})]})]})]})},je={facingMode:"user"},ne="video/webm",Me=g=>{var U,P;const{data:c}=g,x=s.useRef(null),f=s.useRef(null),[m,p]=s.useState(!1),[i,r]=s.useState([]),[u,y]=s.useState(null),[M,S]=s.useState(null),{uploadFile:v,url:l,error:t}=q(c),[a,o]=s.useState(null),[n,C]=s.useState({}),[h,b]=s.useState(je),{user:N}=K(),{mediaData:j,setMediaData:d}=s.useContext(G),{userLocation:w}=J(),_=I=>{d({...j,activeMediaAction:null})},D=I=>{if(!n.createdAtLocation.lat)return k.error("Cannot upload without user Gps coordinates.",{position:"top-right"}),null;o(!0),v(M,c.irepsKeyItem,c.data.id,n,"video")};s.useEffect(()=>((l||t)&&(o(!1),y(null),r([]),d({...j,activeMediaAction:null})),t&&k.error(`Storage Error : ${t}`,{position:"top-right"}),()=>{y(null),r([])}),[l,t,j,d]);const O=I=>{y(null),r([])},R=I=>{console.log("e.currentTarget.id",I.currentTarget.id),b({...h,facingMode:I.currentTarget.id==="selfie"?"user":{exact:"environment"}})},E=s.useCallback(({data:I})=>{I.size>0&&r(A=>A.concat(I))},[r]),W=s.useCallback(()=>{var I;p(!0),f.current=new MediaRecorder((I=x==null?void 0:x.current)==null?void 0:I.stream,{mimeType:ne}),f.current.addEventListener("dataavailable",E),f.current.start()},[x,p,f,E]),H=s.useCallback(()=>{var I,A,B;(I=f==null?void 0:f.current)==null||I.stop(),p(!1),C({erfId:c.data.id,erfNo:c.data.erfNo,mediaType:ne,mediaCategory:"erfVideo",createdByUser:N.displayName,createdByUid:N.uid,createdAtDatetime:Q(new Date,Z.dateFormat2),createdAtLocation:{lat:(A=w==null?void 0:w.coordinates)==null?void 0:A.lat,lng:(B=w==null?void 0:w.coordinates)==null?void 0:B.lng}})},[f,p,c.erfNo,c.id,N.displayName,N.uid,(U=w==null?void 0:w.coordinates)==null?void 0:U.lat,(P=w==null?void 0:w.coordinates)==null?void 0:P.lng]);return s.useEffect(()=>{if(i.length>0){const I=new Blob(i,{type:"video/webm"}),A=URL.createObjectURL(I);y(A),S(I)}},[i]),e.jsxs("div",{className:"media-action-camera",children:[u?e.jsx("div",{className:"macpp ",children:e.jsx("video",{controls:!0,src:u,autoplay:!0})}):e.jsx("div",{className:"macpp original",children:e.jsx(de,{className:"webcam",width:400,height:400,ref:x,videoConstraints:h,screenshotFormat:"image/jpeg",video:"true",audio:"true"})}),e.jsxs("div",{className:"mac mac-control-bar",children:[e.jsxs("div",{className:"maccb maccb-left",children:[!m&&!u&&e.jsx(T,{id:"",actionClassname:"",title:"START recording",clickHanderFunction:W,actionIcon:F.ICON_VIDEO_RECORDING2,color:"blue"}),m&&e.jsx(T,{id:"",actionClassname:"",title:"STOP recording",clickHanderFunction:H,actionIcon:F.ICON_STOP,color:"brown"}),!u&&!m&&e.jsxs(e.Fragment,{children:[e.jsx(T,{id:"selfie",actionClassname:"",title:"SELFIE photo",clickHanderFunction:R,actionIcon:F.ICON_CAMERA_SELFIE,color:"green"}),e.jsx(T,{id:"front",actionClassname:"",title:"FRONT photo",clickHanderFunction:R,actionIcon:F.ICON_CAMERA_FRONT2,color:"orange"})]}),u&&e.jsx(T,{id:"discard",actionClassname:"",title:"DISCARD video",clickHanderFunction:O,actionIcon:F.ICON_DELETE,color:"red"})]}),e.jsxs("div",{className:"maccb maccb-right",children:[u&&e.jsx("button",{disabled:!u,className:"mab btn-submit-form",type:"button",onClick:D,children:a?e.jsx(X,{color:"#F86F03",loading:a<100,size:20,"aria-label":"Loading Spinner","data-testid":"loader"}):e.jsx(Y,{})}),e.jsx(ee,{handleClose:_})]})]})]})},oe="/assets/place_holder1-BNACb7kD.png",Se=g=>{const{data:c}=g,x=s.useRef(null),f=s.useRef(null),[m,p]=s.useState("resized"),i=R=>{p(R)},[r,u]=s.useState(null),[y,M]=s.useState(null),[S,v]=s.useState(null),[l,t]=s.useState({}),{uploadFile:a,url:o,error:n}=q(c),{user:C}=K(),{resizeImg:h,getBase64URL:b}=le(),{mediaData:N,setMediaData:j}=s.useContext(G),{userLocation:d}=J(),w=R=>{var U,P,I,A;const E=R.target.files[0],W=["image/png","image/jpeg"];if(!E)return;if(!((U=d==null?void 0:d.coordinates)!=null&&U.lat)||!((P=d==null?void 0:d.coordinates)!=null&&P.lng)){k.error("User Gps Coordinates required when uploading an image",{position:"top-right"});return}if(!W.includes(E.type)){k.error("File must be of type jpeg or png",{position:"top-right"});return}const H=new FileReader;H.onload=B=>{var z,L;x.current.src=(z=B.target)==null?void 0:z.result,M((L=B.target)==null?void 0:L.result)},H.readAsDataURL(E),t({erfId:c.data.id,erfNo:c.data.erfNo,contentType:E==null?void 0:E.type,mediaType:E==null?void 0:E.type,mediaCategory:"erfPhoto",createdByUser:C.displayName,createdByUid:C.uid,createdAtDatetime:Q(new Date,Z.dateFormat2),createdAtLocation:{lat:(I=d==null?void 0:d.coordinates)==null?void 0:I.lat,lng:(A=d==null?void 0:d.coordinates)==null?void 0:A.lng}})};s.useEffect(()=>{h(y,1200,!0,l).then(R=>{y&&b(R).then(E=>{u(E)})})},[y,b,h,l]);const _=R=>{if(!l.createdAtLocation.lat)return k.error("Cannot upload without user Gps coordinates.",{position:"top-right"}),null;v(!0),a(r,c.irepsKeyItem,c.data.id,l,"image")};s.useEffect(()=>((o||n)&&(v(!1),j({...N,activeMediaAction:null})),n&&k.error(`Storage Error : ${n}`,{position:"top-right"}),()=>{u(null)}),[o,n,N,j]);const D=R=>{j({...N,activeMediaAction:null})},O=R=>{u(null),M(null),x.current.src="",x.current.alt="",f.current.src="",f.current.alt=""};return e.jsxs("div",{className:"media-action-gallery",children:[e.jsx("div",{className:"mag",children:e.jsxs("div",{className:"mag-wrapper",children:[e.jsxs("div",{className:"magw",children:[e.jsxs("div",{className:`magpp original ${m==="original"?"show":"hide"} `,children:[e.jsx("p",{children:"Original Picture"}),e.jsx("img",{className:"img-preview",ref:x,width:150,height:150,src:oe,alt:"ireps pic"})]}),e.jsxs("div",{className:`magpp resized ${m==="resized"?"show":"hide"}`,children:[e.jsx("p",{children:"Resized Picture"}),e.jsx("img",{ref:f,className:"img-preview",width:150,height:150,src:r||oe,alt:"resizedBase64URL"})]})]}),e.jsxs("div",{className:"mmb-btns",children:[y&&e.jsx(te,{selectWindow:O,mmbIcon:F.ICON_DISCARD,color:"",label:"discard",title:"DISCARD Image / Reset"}),y&&e.jsx(te,{selectWindow:i,mmbIcon:F.ICON_IMAGE1,color:"",label:"original",title:"View Original Image"}),r&&e.jsx(te,{selectWindow:i,mmbIcon:F.ICON_IMAGE2,color:"",label:"resized",title:"View Resized Image"})]})]})}),e.jsxs("div",{className:"mag mac-control-bar",children:[e.jsx("div",{className:"magcb magcb-left",children:e.jsx("form",{children:e.jsx("input",{type:"file",accept:"image/*",onChange:w})})}),e.jsxs("div",{className:"magcb magcb-right",children:[r&&e.jsx(e.Fragment,{children:e.jsx("button",{disabled:!r,className:"mab btn-submit-form",type:"button",onClick:_,children:S?e.jsx(X,{color:"#F86F03",loading:S<100,size:20,"aria-label":"Loading Spinner","data-testid":"loader"}):e.jsx(Y,{})})}),e.jsx(ee,{handleClose:D})]})]})]})},Ie=g=>{const{mediaData:c}=s.useContext(G);return e.jsxs("div",{className:`media-action ${c.activeMediaAction?"showMediaAction":"hideMediaAction"}  `,children:[c.activeMediaAction==="camera"&&e.jsx(ye,{data:g.data}),c.activeMediaAction==="voice"&&e.jsx(xe,{data:g.data}),c.activeMediaAction==="video"&&e.jsx(Me,{data:g.data}),c.activeMediaAction==="gallery"&&e.jsx(Se,{data:g.data})]})};export{Ie as default};
